<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no" />
  <title>Election Visualizations</title>

  <link rel="stylesheet" href="https://js.arcgis.com/4.27/esri/themes/light/main.css" />

  <style>
    html,
    body,
    #viewDiv {
      padding: 0;
      margin: 0;
      height: 100%;
      width: 100%;
    }

    #infoDiv {
      display: none;
      position: fixed;
      top: 15px;
      right: 15px;
      background-color: #fff;
      padding: 10px;
      margin: 5px;
      z-index: 99;
      font-family: "Avenir Next", sans-serif;
      font-size: 18px;
      box-shadow: 0px 1px 3px rgba(0, 0, 0, 0.2);
    }
  </style>

  <script src="https://js.arcgis.com/4.27/"></script>

  <script>
    require([
      "esri/WebMap",
      "esri/views/MapView",
      "esri/layers/FeatureLayer",
      "esri/layers/GroupLayer",
      "esri/symbols/SimpleFillSymbol",
      "esri/renderers/SimpleRenderer",
      "esri/symbols/SimpleMarkerSymbol",
      "esri/renderers/ClassBreaksRenderer",
      "esri/renderers/DotDensityRenderer",
      "esri/renderers/PieChartRenderer",
      "esri/widgets/Legend",
      "esri/widgets/LayerList",
      "esri/core/promiseUtils",
      "esri/widgets/Expand",
      "esri/PopupTemplate",
      "esri/widgets/Popup",
      "esri/widgets/Search"
    ], function (
      WebMap,
      MapView,
      FeatureLayer,
      GroupLayer,
      SimpleFillSymbol,
      SimpleRenderer,
      SimpleMarkerSymbol,
      ClassBreaksRenderer,
      DotDensityRenderer,
      PieChartRenderer,
      Legend,
      LayerList,
      promiseUtils,
      Expand,
      PopupTemplate,
      Popup,
      Search
    ) {
      
      const map = new WebMap({
        portalItem: {
          id: "3582b744bba84668b52a16b0b6942544"
        }
      });

      const view = new MapView({
        container: "viewDiv",
        zoom: 4,
        center: [-98.554210, 37.813620],
        map: map,
        highlightOptions: {
          fillOpacity: 0,
          color: [50, 50, 50]
        },
        constraints: {
	  minScale: 80000000,
          maxScale: 300
        }
      });
      
      let currentPrecinctID = null;  // Initialize currentPrecinctID
      let currentCountyID = null;
      let currentPrecinctID16 = null;
      let currentCountyID16 = null;
      let currentStateID = null;
      let currentStateID16 = null;

      let PrecinctLayerView = null;
      let CountyLayerView = null;
      let PrecinctLayerView16 = null;
      let CountyLayerView16 = null;
      let StateLayerView = null;
      let StateLayerView16 = null;

      view.when().then(function () {

	const dotLayer16 = new FeatureLayer({
          url: "https://services2.arcgis.com/VNo0ht0YPXJoI4oE/arcgis/rest/services/2016_Election_Final_Prec_Results/FeatureServer",
          minScale: 80000000,
          maxScale: 300,
          title: "2016",
          outFields: ["*"]  // Removed Precinct_Name
        }); 

	const dotLayer = new FeatureLayer({
          url: "https://services2.arcgis.com/VNo0ht0YPXJoI4oE/arcgis/rest/services/2020_Election_Final_Prec_Results/FeatureServer",
          minScale: 80000000,
          maxScale: 300,
          title: "2020",
          outFields: ["*"]  // Removed Precinct_Name
        });

	const dotGroupLayer = new GroupLayer({
          title: "Dot Density Layer",
          visible: false,
          visibilityMode: "exclusive",
          layers: [dotLayer16, dotLayer],
          listMode: "show"
        });        

       const pieStateLayer16 = new FeatureLayer({
          url: "https://services2.arcgis.com/VNo0ht0YPXJoI4oE/arcgis/rest/services/2020_2016_Election_Final_State_Results/FeatureServer/0",
          minScale: 80000000,
          maxScale: 20000000,
          title: "Results Breakdown",
          outFields: ["*"]
        });
       
	const pieCountyLayer16 = new FeatureLayer({
          url: "https://services2.arcgis.com/VNo0ht0YPXJoI4oE/arcgis/rest/services/2016_Election_Final_County_Results/FeatureServer",
          minScale: 20000000,
          maxScale: 2500000,
          title: "Results Breakdown",
          outFields: ["*"]
        }); 

        const piePrecinctLayer16 = new FeatureLayer({
          url: "https://services2.arcgis.com/VNo0ht0YPXJoI4oE/arcgis/rest/services/2016_Election_Final_Prec_Results/FeatureServer",
          minScale: 2500000,
          maxScale: 300,
          title: "Results Breakdown",
          outFields: ["*"]
        });
	
	const pieGroupLayer16 = new GroupLayer({
          title: "2016",
          visible: true,
          visibilityMode: "inherited",
          layers: [pieStateLayer16, pieCountyLayer16, piePrecinctLayer16],
          listMode: "hide-children"
        });
        
        const pieStateLayer = new FeatureLayer({
          url: "https://services2.arcgis.com/VNo0ht0YPXJoI4oE/arcgis/rest/services/2020_2016_Election_Final_State_Results/FeatureServer/0",
          minScale: 80000000,
          maxScale: 20000000,
          title: "Results Breakdown",
          outFields: ["*"]
        });

	const pieCountyLayer = new FeatureLayer({
          url: "https://services2.arcgis.com/VNo0ht0YPXJoI4oE/arcgis/rest/services/2020_Election_Final_County_Results/FeatureServer/0",
          minScale: 20000000,
          maxScale: 2500000,
          title: "Results Breakdown",
          outFields: ["*"]
        }); 

        const piePrecinctLayer = new FeatureLayer({
          url: "https://services2.arcgis.com/VNo0ht0YPXJoI4oE/arcgis/rest/services/2020_Election_Final_Prec_Results/FeatureServer",
          minScale: 2500000,
          maxScale: 300,
          title: "Results Breakdown",
          outFields: ["*"]
        });
	
	const pieGroupLayer = new GroupLayer({
          title: "2020",
          visible: true,
          visibilityMode: "inherited",
          layers: [pieStateLayer, pieCountyLayer, piePrecinctLayer],
          listMode: "hide-children"
        });

	const allpieGroupLayer = new GroupLayer({
          title: "Pie Chart Layer",
          visible: false,
          visibilityMode: "exclusive",
          layers: [pieGroupLayer16, pieGroupLayer],
          listMode: "show"
        });

        const bubbleStateLayer162 = new FeatureLayer({
          url: "https://services2.arcgis.com/VNo0ht0YPXJoI4oE/arcgis/rest/services/2020_2016_Election_Final_State_Results/FeatureServer/0",
          minScale: 80000000,
          maxScale: 20000000,
          title: "Net Vote Margin by State",
          outFields: ["*"]
        });
       
	const bubbleCountyLayer162 = new FeatureLayer({
          url: "https://services2.arcgis.com/VNo0ht0YPXJoI4oE/arcgis/rest/services/2016_Election_Final_County_Results/FeatureServer",
          minScale: 20000000,
          maxScale: 2500000,
          title: "Net Vote Margin by County",
          outFields: ["*"]
        }); 

        const bubblePrecinctLayer162 = new FeatureLayer({
          url: "https://services2.arcgis.com/VNo0ht0YPXJoI4oE/arcgis/rest/services/2016_Election_Final_Prec_Results/FeatureServer",
          minScale: 2500000,
          maxScale: 300,
          title: "Net Vote Margin by Precinct",
          outFields: ["*"]
        });

	const stateColLayer162 = new FeatureLayer({
          url: "https://services2.arcgis.com/VNo0ht0YPXJoI4oE/arcgis/rest/services/2020_2016_Election_Final_State_Results/FeatureServer/0",
          minScale: 80000000,
          maxScale: 20000000,
          title: "US Presidential Election Results by State",
          outFields: ["*"]
        });

	const countColLayer162 = new FeatureLayer({
          url: "https://services2.arcgis.com/VNo0ht0YPXJoI4oE/arcgis/rest/services/2016_Election_Final_County_Results/FeatureServer",
          minScale: 20000000,
          maxScale: 2500000,
          title: "US Presidential Election Results by County",
          outFields: ["*"]  
        });

	const precColLayer162 = new FeatureLayer({
          url: "https://services2.arcgis.com/VNo0ht0YPXJoI4oE/arcgis/rest/services/2016_Election_Final_Prec_Results/FeatureServer",
          minScale: 2500000,
          maxScale: 300,
          title: "US Presidential Election Results by Voting Precinct",
          outFields: ["*"]  
        });

	const colbubGroupLayer16 = new GroupLayer({
          title: "2016",
          visible: true,
          visibilityMode: "inherited",
          layers: [stateColLayer162, bubbleStateLayer162, countColLayer162, bubbleCountyLayer162, precColLayer162, bubblePrecinctLayer162],
          listMode: "hide-children"
        });      
	      
        const bubbleStateLayer2 = new FeatureLayer({
          url: "https://services2.arcgis.com/VNo0ht0YPXJoI4oE/arcgis/rest/services/2020_2016_Election_Final_State_Results/FeatureServer/0",
          minScale: 80000000,
          maxScale: 20000000,
          title: "Net Vote Margin by State",
          outFields: ["*"]
        });

	const bubbleCountyLayer2 = new FeatureLayer({
          url: "https://services2.arcgis.com/VNo0ht0YPXJoI4oE/arcgis/rest/services/2020_Election_Final_County_Results/FeatureServer/0",
          minScale: 20000000,
          maxScale: 2500000,
          title: "Net Vote Margin by County",
          outFields: ["*"]
        }); 

        const bubblePrecinctLayer2 = new FeatureLayer({
          url: "https://services2.arcgis.com/VNo0ht0YPXJoI4oE/arcgis/rest/services/2020_Election_Final_Prec_Results/FeatureServer",
          minScale: 2500000,
          maxScale: 300,
          title: "Net Vote Margin by Precinct",
          outFields: ["*"]
        });

	const stateColLayer2 = new FeatureLayer({
          url: "https://services2.arcgis.com/VNo0ht0YPXJoI4oE/arcgis/rest/services/2020_2016_Election_Final_State_Results/FeatureServer/0",
          minScale: 80000000,
          maxScale: 20000000,
          title: "US Presidential Election Results by State",
          outFields: ["*"]
        });

	const countColLayer2 = new FeatureLayer({
          url: "https://services2.arcgis.com/VNo0ht0YPXJoI4oE/arcgis/rest/services/2020_Election_Final_County_Results/FeatureServer/0",
          minScale: 20000000,
          maxScale: 2500000,
          title: "US Presidential Election Results by County",
          outFields: ["*"]  
        });

	const precColLayer2 = new FeatureLayer({
          url: "https://services2.arcgis.com/VNo0ht0YPXJoI4oE/arcgis/rest/services/2020_Election_Final_Prec_Results/FeatureServer",
          minScale: 2500000,
          maxScale: 300,
          title: "US Presidential Election Results by Voting Precinct",
          outFields: ["*"]  
        });
	
	const colbubGroupLayer = new GroupLayer({
          title: "2020",
          visible: true,
          visibilityMode: "inherited",
          layers: [stateColLayer2, bubbleStateLayer2, countColLayer2, bubbleCountyLayer2, precColLayer2, bubblePrecinctLayer2],
          listMode: "hide-children"
        });

	const colbuballGroupLayer = new GroupLayer({
          title: "Choropleth + Bubble Layer",
          visible: true,
          visibilityMode: "exclusive",
          layers: [colbubGroupLayer16, colbubGroupLayer],
          listMode: "show"
        });      
	      
        const bubbleStateLayer16 = new FeatureLayer({
          url: "https://services2.arcgis.com/VNo0ht0YPXJoI4oE/arcgis/rest/services/2020_2016_Election_Final_State_Results/FeatureServer/0",
          minScale: 80000000,
          maxScale: 20000000,
          title: "Net Vote Margin by State",
          outFields: ["*"]
        });
       
	const bubbleCountyLayer16 = new FeatureLayer({
          url: "https://services2.arcgis.com/VNo0ht0YPXJoI4oE/arcgis/rest/services/2016_Election_Final_County_Results/FeatureServer",
          minScale: 20000000,
          maxScale: 2500000,
          title: "Net Vote Margin by County",
          outFields: ["*"]
        }); 

        const bubblePrecinctLayer16 = new FeatureLayer({
          url: "https://services2.arcgis.com/VNo0ht0YPXJoI4oE/arcgis/rest/services/2016_Election_Final_Prec_Results/FeatureServer",
          minScale: 2500000,
          maxScale: 300,
          title: "Net Vote Margin by Precinct",
          outFields: ["*"]
        });
	
	const bubbleGroupLayer16 = new GroupLayer({
          title: "2016",
          visible: true,
          visibilityMode: "inherited",
          layers: [bubbleStateLayer16, bubbleCountyLayer16, bubblePrecinctLayer16],
          listMode: "hide-children"
        });
        
        const bubbleStateLayer = new FeatureLayer({
          url: "https://services2.arcgis.com/VNo0ht0YPXJoI4oE/arcgis/rest/services/2020_2016_Election_Final_State_Results/FeatureServer/0",
          minScale: 80000000,
          maxScale: 20000000,
          title: "Net Vote Margin by State",
          outFields: ["*"]
        });

	const bubbleCountyLayer = new FeatureLayer({
          url: "https://services2.arcgis.com/VNo0ht0YPXJoI4oE/arcgis/rest/services/2020_Election_Final_County_Results/FeatureServer/0",
          minScale: 20000000,
          maxScale: 2500000,
          title: "Net Vote Margin by County",
          outFields: ["*"]
        }); 

        const bubblePrecinctLayer = new FeatureLayer({
          url: "https://services2.arcgis.com/VNo0ht0YPXJoI4oE/arcgis/rest/services/2020_Election_Final_Prec_Results/FeatureServer",
          minScale: 2500000,
          maxScale: 300,
          title: "Net Vote Margin by Precinct",
          outFields: ["*"]
        });
	
	const bubbleGroupLayer = new GroupLayer({
          title: "2020",
          visible: true,
          visibilityMode: "inherited",
          layers: [bubbleStateLayer, bubbleCountyLayer, bubblePrecinctLayer],
          listMode: "hide-children"
        });

	const bubGroupLayer = new GroupLayer({
          title: "Bubble Layer",
          visible: false,
          visibilityMode: "exclusive",
          layers: [bubbleGroupLayer16, bubbleGroupLayer],
          listMode: "show"
        });

        const stateColLayer16 = new FeatureLayer({
          url: "https://services2.arcgis.com/VNo0ht0YPXJoI4oE/arcgis/rest/services/2020_2016_Election_Final_State_Results/FeatureServer/0",
          minScale: 80000000,
          maxScale: 20000000,
          title: "US Presidential Election Results by State",
          outFields: ["*"]
        });

	const countColLayer16 = new FeatureLayer({
          url: "https://services2.arcgis.com/VNo0ht0YPXJoI4oE/arcgis/rest/services/2016_Election_Final_County_Results/FeatureServer",
          minScale: 20000000,
          maxScale: 9000000,
          title: "US Presidential Election Results by County",
          outFields: ["*"]  
        });

	const precColLayer16 = new FeatureLayer({
          url: "https://services2.arcgis.com/VNo0ht0YPXJoI4oE/arcgis/rest/services/2016_Election_Final_Prec_Results/FeatureServer",
          minScale: 9000000,
          maxScale: 300,
          title: "US Presidential Election Results by Voting Precinct",
          outFields: ["*"]  
        });

	const colGroupLayer16 = new GroupLayer({
          title: "2016",
          visible: true,
          visibilityMode: "inherited",
          layers: [stateColLayer16, countColLayer16, precColLayer16],
          listMode: "hide-children"
        });

        const stateColLayer = new FeatureLayer({
          url: "https://services2.arcgis.com/VNo0ht0YPXJoI4oE/arcgis/rest/services/2020_2016_Election_Final_State_Results/FeatureServer/0",
          minScale: 80000000,
          maxScale: 20000000,
          title: "US Presidential Election Results by State",
          outFields: ["*"]
        });

	const countColLayer = new FeatureLayer({
          url: "https://services2.arcgis.com/VNo0ht0YPXJoI4oE/arcgis/rest/services/2020_Election_Final_County_Results/FeatureServer/0",
          minScale: 20000000,
          maxScale: 9000000,
          title: "US Presidential Election Results by County",
          outFields: ["*"]  
        });

	const precColLayer = new FeatureLayer({
          url: "https://services2.arcgis.com/VNo0ht0YPXJoI4oE/arcgis/rest/services/2020_Election_Final_Prec_Results/FeatureServer",
          minScale: 9000000,
          maxScale: 300,
          title: "US Presidential Election Results by Voting Precinct",
          outFields: ["*"]  
        });
	
	const colGroupLayer = new GroupLayer({
          title: "2020",
          visible: true,
          visibilityMode: "inherited",
          layers: [stateColLayer, countColLayer, precColLayer],
          listMode: "hide-children"
        });

	const chorGroupLayer = new GroupLayer({
          title: "Choropleth Layer",
          visible: true,
          visibilityMode: "exclusive",
          layers: [colGroupLayer16, colGroupLayer],
          listMode: "show"
        });

	const mastGroupLayer = new GroupLayer({
          title: "Layers",
          visible: true,
          visibilityMode: "exclusive",
          layers: [dotGroupLayer, allpieGroupLayer, colbuballGroupLayer, bubGroupLayer, chorGroupLayer],
          listMode: "show"
        });
	
	map.add(mastGroupLayer);
	
	const stateLayer16 = new FeatureLayer({
          url: "https://services2.arcgis.com/VNo0ht0YPXJoI4oE/arcgis/rest/services/2020_2016_Election_Final_State_Results/FeatureServer/0",
         minScale: 80000000,
         maxScale: 20000000,
         legendEnabled: false,
         listMode: "hide", 
         title: "",
         outFields: ["*"]
       });
	
	const countyLayer16 = new FeatureLayer({
          url: "https://services2.arcgis.com/VNo0ht0YPXJoI4oE/arcgis/rest/services/2016_Election_Final_County_Results/FeatureServer",
          minScale: 20000000,
          maxScale: 4500000,
          legendEnabled: false,
	  listMode: "hide",
          title: "",
          outFields: ["*"]
        });

	const precinctLayer16 = new FeatureLayer({
          url: "https://services2.arcgis.com/VNo0ht0YPXJoI4oE/arcgis/rest/services/2016_Election_Final_Prec_Results/FeatureServer",
          minScale: 4500000,
          maxScale: 300,
	  legendEnabled: false,
	  listMode: "hide",
          title: "",
          outFields: ["*"]  
        });

	const high16 = new GroupLayer({
	  title: "2016",
          visible: true,
          visibilityMode: "inherited",
          layers: [stateLayer16, precinctLayer16, countyLayer16],
          listMode: "hide"
	});
	
	const stateLayer = new FeatureLayer({
          url: "https://services2.arcgis.com/VNo0ht0YPXJoI4oE/arcgis/rest/services/2020_2016_Election_Final_State_Results/FeatureServer/0",
         minScale: 80000000,
         maxScale: 20000000,
         legendEnabled: false,
         listMode: "hide",
         title: "",
         outFields: ["*"]
       });

	const countyLayer = new FeatureLayer({
          url: "https://services2.arcgis.com/VNo0ht0YPXJoI4oE/arcgis/rest/services/2020_Election_Final_County_Results/FeatureServer/0",
          minScale: 20000000,
          maxScale: 4500000,
          legendEnabled: false,
	  listMode: "hide",
          title: "",
          outFields: ["*"]
        });
	
	const precinctLayer = new FeatureLayer({
          url: "https://services2.arcgis.com/VNo0ht0YPXJoI4oE/arcgis/rest/services/2020_Election_Final_Prec_Results/FeatureServer",
          minScale: 4500000,
          maxScale: 300,
	  legendEnabled: false,
	  listMode: "hide",
          title: "",
          outFields: ["*"]  
        });

	const high20 = new GroupLayer({
	  title: "2020",
          visible: true,
          visibilityMode: "inherited",
          layers: [stateLayer, precinctLayer, countyLayer],
          listMode: "hide"
	});

	const masthigh = new GroupLayer({
	  title: "Pop-Up Layers",
	  visible: true,
	  visibilityMode: "exclusive",
	  layers: [high16, high20],
	  listMode: "hide"
	});

	map.add(masthigh);

	view.whenLayerView(stateLayer16).then(function(layerView) {
	   StateLayerView16 = layerView;
        });

	view.whenLayerView(countyLayer16).then(function (layerView) {
           CountyLayerView16 = layerView;
        });

	view.whenLayerView(precinctLayer16).then(function (layerView) {
           PrecinctLayerView16 = layerView;
        });
        
	view.whenLayerView(stateLayer).then(function(layerView) {
	   StateLayerView = layerView;
	});

	view.whenLayerView(countyLayer).then(function (layerView) {
           CountyLayerView = layerView;
        });

	view.whenLayerView(precinctLayer).then(function (layerView) {
           PrecinctLayerView = layerView;
        });

	view.ui.add(
         [
           new Expand({
             view: view,
             content: new LayerList({ view: view, listItemCreatedFunction: defineActions }),
             group: "bottom-right",
             expanded: true
           })
         ],
         "bottom-right"
       );

    function defineActions(event) {
      const item = event.item;

      if (item.layer.type === "group") {
        item.open = true;
      }

    item.layer.watch("visible", function(newValue, oldValue, property, object) {
        // Logic for individual layers within the group layers
        updateHighlightLayer(item.layer);
      });
    }

    // A function to update the highlight layer based on the selected year in the main group layer
    function updateHighlightLayer(layer) {
      if (layer === colGroupLayer16 && chorGroupLayer.visible) {
        high16.visible = true;
        high20.visible = false;
      } else if (layer === colGroupLayer && chorGroupLayer.visible) {
        high20.visible = true;
        high16.visible = false;
      } else if (layer === dotLayer16 && dotGroupLayer.visible) {
        high16.visible = true;
        high20.visible = false;
      } else if (layer === dotLayer && dotGroupLayer.visible) {
        high20.visible = true;
        high16.visible = false;
      } else if (layer === pieGroupLayer16 && allpieGroupLayer.visible) {
        high16.visible = true;
        high20.visible = false;
      } else if (layer === pieGroupLayer && allpieGroupLayer.visible) {
        high20.visible = true;
        high16.visible = false;
      } else if (layer === colbubGroupLayer16 && colbuballGroupLayer.visible) {
        high16.visible = true;
        high20.visible = false;
      } else if (layer === colbubGroupLayer && colbuballGroupLayer.visible) {
        high20.visible = true;
        high16.visible = false;
      } else if (layer === bubbleGroupLayer16 && bubGroupLayer.visible) {
        high16.visible = true;
        high20.visible = false;
      } else if (layer === bubbleGroupLayer && bubGroupLayer.visible) {
        high20.visible = true;
        high16.visible = false;
      }
    }

    // Watch the visibility property of the main group layers
    [chorGroupLayer, dotGroupLayer, allpieGroupLayer, colbuballGroupLayer, bubGroupLayer].forEach(groupLayer => {
      groupLayer.watch("visible", function(newValue, oldValue, property, object) {
        if (newValue === true) {
            // When a main group layer becomes visible, check its child layers and update the highlight layer
            groupLayer.layers.forEach(childLayer => {
                if (childLayer.visible) {
                    updateHighlightLayer(childLayer);
                }
            });
        }
      });
    });


        // Highlight layers renderer
        const stateRenderer16 = new SimpleRenderer({
             //type: "simple",
             symbol: {
               type: "simple-fill",
               style: "none",
               outline: null
             }
          }); 
    
	  const countRenderer16 = new SimpleRenderer({
              //type: "simple",
              symbol: {
                type: "simple-fill",
                style: "none",
                outline: null
              }
          }); 

	  const precRenderer16 = new SimpleRenderer({
              //type: "simple",
              symbol: {
                type: "simple-fill",
                style: "none",
                outline: null
              }
          }); 

	  const voteMarginSymbol16 = new SimpleMarkerSymbol({
            outline: {
              color: "rgba(0, 0, 0, 0)",
              width: 0
            }
          });        

	  // Bubble Renderer
	const stateBubbleRenderer16 = new SimpleRenderer({
              symbol: voteMarginSymbol16,
              visualVariables: [
                {
                  type: "size",
                  field: "CLI_TRU",
                  stops: [
                    { value: 2000, size: 3 },
		    { value: 500000, size: 20 },
		    { value: 5500000, size: 76 },
                    { value: -2000, size: 3 },
		    { value: -500000, size: 20 },
		    { value: -5500000, size: 76 },
                  ],
                  legendOptions: {
                    title: "Number of Clinton (D) Votes minus Number of Trump (R) Votes"
                  }
                },
                {
                  type: "color",
                  field: "CLI_TRU",
                  legendOptions: {
                    showLegend: false
                  },
                  stops: [
                    { value: -1, color: [204, 10, 18, 0.60] },
                    { value: 1, color: [37, 66, 143, 0.60] }
                  ]
                }
              ]
            });

	 
	  const countyBubbleRenderer16 = new SimpleRenderer({
              symbol: voteMarginSymbol16,
              visualVariables: [
                {
                  type: "size",
                  field: "CLI_TRU",
                  stops: [
                    { value: 1, size: 1 },
		    { value: 100000, size: 23 },
		    { value: 2000000, size: 92 },
                    { value: -1, size: 1 },
		    { value: -100000, size: 23 },
		    { value: -2000000, size: 92 },
                  ],
                  legendOptions: {
                    title: "Number of Clinton (D) Votes minus Number of Trump (R) Votes"
                  }
                },
                {
                  type: "color",
                  field: "CLI_TRU",
                  legendOptions: {
                    showLegend: false
                  },
                  stops: [
                    { value: -1, color: [204, 10, 18, 0.60] },
                    { value: 1, color: [37, 66, 143, 0.60] }
                  ]
                }
              ]
            });

            const precinctBubbleRenderer16 = new SimpleRenderer({
              symbol: voteMarginSymbol16,
              visualVariables: [
                {
                  type: "size",
                  field: "CLI_TRU",
                  stops: [
                    { value: 1, size: 1 },
                    { value: 700, size: 8 },
                    { value: 13000, size: 27 },
                    { value: -1, size: 1 },
                    { value: -700, size: 8 },
                    { value: -13000, size: 27 },
                  ],
                  legendOptions: {
                    title: "Number of Clinton (D) Votes minus Number of Trump (R) Votes"
                  }
                },
                {
                  type: "color",
                  field: "CLI_TRU",
                  legendOptions: {
                    showLegend: false
                  },
                  stops: [
                    { value: -1, color: [204, 10, 18, 0.35] },
                    { value: 1, color: [37, 66, 143, 0.35] }
                  ]
                }
              ]
            });

	    // Pie Chart Renderer
            const statePieRenderer16 = new PieChartRenderer({
              size: 10,
              attributes: [
              {
                field: "Trump_16",
                color: "#e30022",
                label: "Trump (R)"
              },
              {
                color: "#0000ff",
                label: "Clinton (D)",
                field: "Clinton"
              },
              {
                field: "Other_16",
                color: "#a9a9a9",
                label: "Other"
              }
            ],
            backgroundFillSymbol: {
              // polygon fill behind pie chart
              color: [127, 127, 127, 0.2],
              outline: {
                width: 1,
                color: [255, 255, 255, 0.3]
              }
            },		    
            outline: {
              width: 1.1,
              color: "grey"
            },
            visualVariables: [
            {
              type: "size", // size visual variable based on total votes represented in each pie
              valueExpression: "$feature.Tot_16",
	      valueExpressionTitle: "Total Number of Votes",
              minDataValue: 200000,
              maxDataValue: 18000000,
              minSize: 14,
              maxSize: 58
            }
          ]
    
        });
            
        const countyPieRenderer16 = new PieChartRenderer({
              size: 10,
              attributes: [
              {
                field: "votes_gop",
                color: "#e30022",
                label: "Trump (R)"
              },
              {
                color: "#0000ff",
                label: "Clinton (D)",
                field: "votes_dem"
              },
              {
                field: "Total_Othe",
                color: "#a9a9a9",
                label: "Other"
              }
            ],
            backgroundFillSymbol: {
              // polygon fill behind pie chart
              color: [127, 127, 127, 0.2],
              outline: {
                width: 1,
                color: [255, 255, 255, 0.3]
              }
            },		    
            outline: {
              width: 1.1,
              color: "grey"
            },
            visualVariables: [
            {
              type: "size", // size visual variable based on total votes represented in each pie
              valueExpression: "$feature.total_vote",
	      valueExpressionTitle: "Total Number of Votes",
              minDataValue: 15000,
              maxDataValue: 1500000,
              minSize: 10,
              maxSize: 54
            }
          ]
    
        });

	const precinctPieRenderer16 = new PieChartRenderer({
              size: 10,
              attributes: [
              {
                field: "G16PRERTRU",
                color: "#e30022",
                label: "Trump (R)"
              },
              {
                color: "#0000ff",
                label: "Clinton (D)",
                field: "G16PREDCLI"
              },
              {
                field: "Total_Othe",
                color: "#a9a9a9",
                label: "Other"
              }
            ],
            backgroundFillSymbol: {
              // polygon fill behind pie chart
              color: [127, 127, 127, 0.2],
              outline: {
                width: 1,
                color: [255, 255, 255, 0.3]
              }
            },		    
            outline: {
              width: 1.1,
              color: "grey"
            },
            visualVariables: [
            {
              type: "size", // size visual variable based on total votes represented in each pie
              valueExpression: "$feature.Total_Vote",
	      valueExpressionTitle: "Total Number of Votes",
              minDataValue: 100,
              maxDataValue: 10000,
              minSize: 8,
              maxSize: 28
            }
          ]
    
        });

	    // Dot density renderer
	    const dotDensityRenderer16 = new DotDensityRenderer({
              dotValue: 1,
              outline: null,
              dotBlendingEnabled: true,
              referenceScale: 100000,
              legendOptions: {
                unit: "Vote(s)"
              },
              attributes: [
                {
                  field: "G16PREDCLI",
                  color: "#00b6f1",
                  label: "Clinton (D)"
                },
                {
                  field: "G16PRERTRU",
                  color: "#f23c3f",
                  label: "Trump (R)"
                }, 
                {
                  field: "Total_Othe",
                  color: "#bf00ff",
                  label: "Other"
	        }
              ]
            });

	    // Class breaks renderer
            const stateColRenderer162 = new ClassBreaksRenderer({
              valueExpression: `
                var dem_votes = $feature.Clinton;
                var gop_votes = $feature.Trump_16;
                var total_votes = $feature.Tot_16;

                if (total_votes == 0) {
                    return 100002;  // For no votes
                } else if (dem_votes == gop_votes) {
                    return -100002;  // For exact ties
                } else if (dem_votes > gop_votes) {
                    return (dem_votes / total_votes) * 100;  // Clinton won
                } else {
                    return -((gop_votes / total_votes) * 100);  // Trump won
                }
              `,
              classBreakInfos: [
                  { minValue: 100002, maxValue: 100002, label: "No Votes", symbol: { type: "simple-fill", color: [215, 219, 221, 0.6], outline: null }},
		  { minValue: -100, maxValue: -95, label: "≤100% Trump (R)", symbol: { type: "simple-fill", color: [213, 25, 25, 0.6], outline: null }},
                  { minValue: -95, maxValue: -90, label: "≤95% Trump (R)", symbol: { type: "simple-fill", color: [229, 33, 33, 0.6], outline: null }},
                  { minValue: -90, maxValue: -85, label: "≤90% Trump (R)", symbol: { type: "simple-fill", color: [232, 55, 55, 0.6], outline: null }},
                  { minValue: -85, maxValue: -80, label: "≤85% Trump (R)", symbol: { type: "simple-fill", color: [235, 77, 77, 0.6], outline: null }},
		  { minValue: -80, maxValue: -75, label: "≤80% Trump (R)", symbol: { type: "simple-fill", color: [237, 100, 100, 0.6], outline: null }},
		  { minValue: -75, maxValue: -70, label: "≤75% Trump (R)", symbol: { type: "simple-fill", color: [240, 122, 122, 0.6], outline: null }}, 
		  { minValue: -70, maxValue: -65, label: "≤70% Trump (R)", symbol: { type: "simple-fill", color: [242, 144, 144, 0.6], outline: null }},
		  { minValue: -65, maxValue: -60, label: "≤65% Trump (R)", symbol: { type: "simple-fill", color: [245, 166, 166, 0.6], outline: null }},
		  { minValue: -60, maxValue: -55, label: "≤60% Trump (R)", symbol: { type: "simple-fill", color: [247, 188, 188, 0.6], outline: null }},
		  { minValue: -55, maxValue: -50, label: "≤55% Trump (R)", symbol: { type: "simple-fill", color: [250, 211, 211, 0.6], outline: null }},
		  { minValue: -50, maxValue: 0, label: "≤50% Trump (R)", symbol: { type: "simple-fill", color: [252, 233, 233, 0.6], outline: null }},
		  { minValue: -100002, maxValue: -100002, label: "Tie", symbol: { type: "simple-fill", color: [255, 255, 255, 0.6], outline: null }},
                  { minValue: 0, maxValue: 50, label: "≤50% Clinton (D)", symbol: { type: "simple-fill", color: [222, 238, 250, 0.6], outline: null }},
                  { minValue: 50, maxValue: 55, label: "≤55% Clinton (D)", symbol: { type: "simple-fill", color: [190, 220, 245, 0.6], outline: null }},
		  { minValue: 55, maxValue: 60, label: "≤60% Clinton (D)", symbol: { type: "simple-fill", color: [157, 203, 241, 0.6], outline: null }},
                  { minValue: 60, maxValue: 65, label: "≤65% Clinton (D)", symbol: { type: "simple-fill", color: [125, 185, 236, 0.6], outline: null }},
                  { minValue: 65, maxValue: 70, label: "≤70% Clinton (D)", symbol: { type: "simple-fill", color: [92, 168, 231, 0.6], outline: null }},
                  { minValue: 70, maxValue: 75, label: "≤75% Clinton (D)", symbol: { type: "simple-fill", color: [60, 150, 226, 0.6], outline: null }},
                  { minValue: 75, maxValue: 80, label: "≤80% Clinton (D)", symbol: { type: "simple-fill", color: [32, 132, 217, 0.6], outline: null }},
                  { minValue: 80, maxValue: 85, label: "≤85% Clinton (D)", symbol: { type: "simple-fill", color: [27, 112, 184, 0.6], outline: null }},
                  { minValue: 85, maxValue: 90, label: "≤90% Clinton (D)", symbol: { type: "simple-fill", color: [22, 93, 152, 0.6], outline: null }},
                  { minValue: 90, maxValue: 95, label: "≤95% Clinton (D)", symbol: { type: "simple-fill", color: [18, 73, 119, 0.6], outline: null }},
                  { minValue: 95, maxValue: 100, label: "≤100% Clinton (D)", symbol: { type: "simple-fill", color: [13, 53, 87, 0.6], outline: null }},
              ]
          });

            const countColRenderer162 = new ClassBreaksRenderer({
              valueExpression: `
                var dem_votes = $feature.votes_dem;
                var gop_votes = $feature.votes_gop;
                var total_votes = $feature.total_vote;

                if (total_votes == 0) {
                    return 100002;  // For no votes
                } else if (dem_votes == gop_votes) {
                    return -100002;  // For exact ties
                } else if (dem_votes > gop_votes) {
                    return (dem_votes / total_votes) * 100;  // Clinton won
                } else {
                    return -((gop_votes / total_votes) * 100);  // Trump won
                }
              `,
              classBreakInfos: [
                  { minValue: 100002, maxValue: 100002, label: "No Votes", symbol: { type: "simple-fill", color: [215, 219, 221, 0.6], outline: null }},
		  { minValue: -100, maxValue: -95, label: "≤100% Trump (R)", symbol: { type: "simple-fill", color: [213, 25, 25, 0.6], outline: null }},
                  { minValue: -95, maxValue: -90, label: "≤95% Trump (R)", symbol: { type: "simple-fill", color: [229, 33, 33, 0.6], outline: null }},
                  { minValue: -90, maxValue: -85, label: "≤90% Trump (R)", symbol: { type: "simple-fill", color: [232, 55, 55, 0.6], outline: null }},
                  { minValue: -85, maxValue: -80, label: "≤85% Trump (R)", symbol: { type: "simple-fill", color: [235, 77, 77, 0.6], outline: null }},
		  { minValue: -80, maxValue: -75, label: "≤80% Trump (R)", symbol: { type: "simple-fill", color: [237, 100, 100, 0.6], outline: null }},
		  { minValue: -75, maxValue: -70, label: "≤75% Trump (R)", symbol: { type: "simple-fill", color: [240, 122, 122, 0.6], outline: null }}, 
		  { minValue: -70, maxValue: -65, label: "≤70% Trump (R)", symbol: { type: "simple-fill", color: [242, 144, 144, 0.6], outline: null }},
		  { minValue: -65, maxValue: -60, label: "≤65% Trump (R)", symbol: { type: "simple-fill", color: [245, 166, 166, 0.6], outline: null }},
		  { minValue: -60, maxValue: -55, label: "≤60% Trump (R)", symbol: { type: "simple-fill", color: [247, 188, 188, 0.6], outline: null }},
		  { minValue: -55, maxValue: -50, label: "≤55% Trump (R)", symbol: { type: "simple-fill", color: [250, 211, 211, 0.6], outline: null }},
		  { minValue: -50, maxValue: 0, label: "≤50% Trump (R)", symbol: { type: "simple-fill", color: [252, 233, 233, 0.6], outline: null }},
		  { minValue: -100002, maxValue: -100002, label: "Tie", symbol: { type: "simple-fill", color: [255, 255, 255, 0.6], outline: null }},
                  { minValue: 0, maxValue: 50, label: "≤50% Clinton (D)", symbol: { type: "simple-fill", color: [222, 238, 250, 0.6], outline: null }},
                  { minValue: 50, maxValue: 55, label: "≤55% Clinton (D)", symbol: { type: "simple-fill", color: [190, 220, 245, 0.6], outline: null }},
		  { minValue: 55, maxValue: 60, label: "≤60% Clinton (D)", symbol: { type: "simple-fill", color: [157, 203, 241, 0.6], outline: null }},
                  { minValue: 60, maxValue: 65, label: "≤65% Clinton (D)", symbol: { type: "simple-fill", color: [125, 185, 236, 0.6], outline: null }},
                  { minValue: 65, maxValue: 70, label: "≤70% Clinton (D)", symbol: { type: "simple-fill", color: [92, 168, 231, 0.6], outline: null }},
                  { minValue: 70, maxValue: 75, label: "≤75% Clinton (D)", symbol: { type: "simple-fill", color: [60, 150, 226, 0.6], outline: null }},
                  { minValue: 75, maxValue: 80, label: "≤80% Clinton (D)", symbol: { type: "simple-fill", color: [32, 132, 217, 0.6], outline: null }},
                  { minValue: 80, maxValue: 85, label: "≤85% Clinton (D)", symbol: { type: "simple-fill", color: [27, 112, 184, 0.6], outline: null }},
                  { minValue: 85, maxValue: 90, label: "≤90% Clinton (D)", symbol: { type: "simple-fill", color: [22, 93, 152, 0.6], outline: null }},
                  { minValue: 90, maxValue: 95, label: "≤95% Clinton (D)", symbol: { type: "simple-fill", color: [18, 73, 119, 0.6], outline: null }},
                  { minValue: 95, maxValue: 100, label: "≤100% Clinton (D)", symbol: { type: "simple-fill", color: [13, 53, 87, 0.6], outline: null }},
              ]
          });

	  const precColRenderer162 = new ClassBreaksRenderer({
              valueExpression: `
                var dem_votes = $feature.G16PREDCLI;
                var gop_votes = $feature.G16PRERTRU;
	        var other_votes = $feature.Total_Othe;
                var total_votes = $feature.Total_Vote;

                if (total_votes == 0) {
                    return 100002;  // For no votes
	        } else if (other_votes > dem_votes && other_votes > gop_votes) {
       		    if (gop_votes > dem_votes || gop_votes < dem_votes) {
                    return (other_votes / total_votes) * 100001; // McMullin or other won
		    }
                } else if (dem_votes == gop_votes && dem_votes > other_votes) {
                    return -100002;  // For exact ties
                } else if (other_votes == gop_votes && other_votes > dem_votes) {
                    return -100002;  // For exact ties
                } else if (dem_votes == other_votes && dem_votes > gop_votes) {
                    return -100002;  // For exact ties
                } else if (dem_votes > gop_votes) {
                    return (dem_votes / total_votes) * 100;  // Clinton won
                } else {
                    return -((gop_votes / total_votes) * 100);  // Trump won
                }
              `,
              classBreakInfos: [
	          { minValue: 95000, maxValue: 100000, label: "≤100% Other", symbol: { type: "simple-fill", color: [53, 9, 109, 0.35], outline: null }},
		  { minValue: 90000, maxValue: 95000, label: "≤95% Other", symbol: { type: "simple-fill", color: [69, 11, 142, 0.35], outline: null }},
		  { minValue: 85000, maxValue: 90000, label: "≤90% Other", symbol: { type: "simple-fill", color: [85, 14, 175, 0.35], outline: null }},
		  { minValue: 80000, maxValue: 85000, label: "≤85% Other", symbol: { type: "simple-fill", color: [101, 16, 208, 0.35], outline: null }},
		  { minValue: 75000, maxValue: 80000, label: "≤80% Other", symbol: { type: "simple-fill", color: [118, 24, 237, 0.35], outline: null }},    
		  { minValue: 70000, maxValue: 75000, label: "≤75% Other", symbol: { type: "simple-fill", color: [138, 57, 239, 0.35], outline: null }},
		  { minValue: 65000, maxValue: 70000, label: "≤70% Other", symbol: { type: "simple-fill", color: [157, 90, 242, 0.35], outline: null }},
		  { minValue: 60000, maxValue: 65000, label: "≤65% Other", symbol: { type: "simple-fill", color: [177, 123, 245, 0.35], outline: null }},
		  { minValue: 55000, maxValue: 60000, label: "≤60% Other", symbol: { type: "simple-fill", color: [196, 156, 247, 0.35], outline: null }},
		  { minValue: 50000, maxValue: 55000, label: "≤55% Other", symbol: { type: "simple-fill", color: [216, 189, 250, 0.35], outline: null }},
		  { minValue: 100, maxValue: 50000, label: "≤50% Other", symbol: { type: "simple-fill", color: [235, 222, 252, 0.35], outline: null }},
		  { minValue: 100002, maxValue: 100002, label: "No Votes", symbol: { type: "simple-fill", color: [215, 219, 221, 0.35], outline: null }},
		  { minValue: -100, maxValue: -95, label: "≤100% Trump (R)", symbol: { type: "simple-fill", color: [213, 25, 25, 0.35], outline: null }},
                  { minValue: -95, maxValue: -90, label: "≤95% Trump (R)", symbol: { type: "simple-fill", color: [229, 33, 33, 0.35], outline: null }},
                  { minValue: -90, maxValue: -85, label: "≤90% Trump (R)", symbol: { type: "simple-fill", color: [232, 55, 55, 0.35], outline: null }},
                  { minValue: -85, maxValue: -80, label: "≤85% Trump (R)", symbol: { type: "simple-fill", color: [235, 77, 77, 0.35], outline: null }},
		  { minValue: -80, maxValue: -75, label: "≤80% Trump (R)", symbol: { type: "simple-fill", color: [237, 100, 100, 0.35], outline: null }},
		  { minValue: -75, maxValue: -70, label: "≤75% Trump (R)", symbol: { type: "simple-fill", color: [240, 122, 122, 0.35], outline: null }}, 
		  { minValue: -70, maxValue: -65, label: "≤70% Trump (R)", symbol: { type: "simple-fill", color: [242, 144, 144, 0.35], outline: null }},
		  { minValue: -65, maxValue: -60, label: "≤65% Trump (R)", symbol: { type: "simple-fill", color: [245, 166, 166, 0.35], outline: null }},
		  { minValue: -60, maxValue: -55, label: "≤60% Trump (R)", symbol: { type: "simple-fill", color: [247, 188, 188, 0.35], outline: null }},
		  { minValue: -55, maxValue: -50, label: "≤55% Trump (R)", symbol: { type: "simple-fill", color: [250, 211, 211, 0.35], outline: null }},
		  { minValue: -50, maxValue: 0, label: "≤50% Trump (R)", symbol: { type: "simple-fill", color: [252, 233, 233, 0.35], outline: null }},
		  { minValue: -100002, maxValue: -100002, label: "Tie", symbol: { type: "simple-fill", color: [255, 255, 255, 0.35], outline: null }},
                  { minValue: 0, maxValue: 50, label: "≤50% Clinton (D)", symbol: { type: "simple-fill", color: [222, 238, 250, 0.35], outline: null }},
                  { minValue: 50, maxValue: 55, label: "≤55% Clinton (D)", symbol: { type: "simple-fill", color: [190, 220, 245, 0.35], outline: null }},
		  { minValue: 55, maxValue: 60, label: "≤60% Clinton (D)", symbol: { type: "simple-fill", color: [157, 203, 241, 0.35], outline: null }},
                  { minValue: 60, maxValue: 65, label: "≤65% Clinton (D)", symbol: { type: "simple-fill", color: [125, 185, 236, 0.35], outline: null }},
                  { minValue: 65, maxValue: 70, label: "≤70% Clinton (D)", symbol: { type: "simple-fill", color: [92, 168, 231, 0.35], outline: null }},
                  { minValue: 70, maxValue: 75, label: "≤75% Clinton (D)", symbol: { type: "simple-fill", color: [60, 150, 226, 0.35], outline: null }},
                  { minValue: 75, maxValue: 80, label: "≤80% Clinton (D)", symbol: { type: "simple-fill", color: [32, 132, 217, 0.35], outline: null }},
                  { minValue: 80, maxValue: 85, label: "≤85% Clinton (D)", symbol: { type: "simple-fill", color: [27, 112, 184, 0.35], outline: null }},
                  { minValue: 85, maxValue: 90, label: "≤90% Clinton (D)", symbol: { type: "simple-fill", color: [22, 93, 152, 0.35], outline: null }},
                  { minValue: 90, maxValue: 95, label: "≤95% Clinton (D)", symbol: { type: "simple-fill", color: [18, 73, 119, 0.35], outline: null }},
                  { minValue: 95, maxValue: 100, label: "≤100% Clinton (D)", symbol: { type: "simple-fill", color: [13, 53, 87, 0.35], outline: null }},
              ]
          });
	      
	    const stateColRenderer16 = new ClassBreaksRenderer({
              valueExpression: `
                var dem_votes = $feature.Clinton;
                var gop_votes = $feature.Trump_16;
                var total_votes = $feature.Tot_16;

                if (total_votes == 0) {
                    return 100002;  // For no votes
                } else if (dem_votes == gop_votes) {
                    return -100002;  // For exact ties
                } else if (dem_votes > gop_votes) {
                    return (dem_votes / total_votes) * 100;  // Clinton won
                } else {
                    return -((gop_votes / total_votes) * 100);  // Trump won
                }
              `,
              classBreakInfos: [
                  { minValue: 100002, maxValue: 100002, label: "No Votes", symbol: { type: "simple-fill", color: [215, 219, 221, 0.8], outline: null }},
		  { minValue: -100, maxValue: -95, label: "≤100% Trump (R)", symbol: { type: "simple-fill", color: [213, 25, 25, 0.8], outline: null }},
                  { minValue: -95, maxValue: -90, label: "≤95% Trump (R)", symbol: { type: "simple-fill", color: [229, 33, 33, 0.8], outline: null }},
                  { minValue: -90, maxValue: -85, label: "≤90% Trump (R)", symbol: { type: "simple-fill", color: [232, 55, 55, 0.8], outline: null }},
                  { minValue: -85, maxValue: -80, label: "≤85% Trump (R)", symbol: { type: "simple-fill", color: [235, 77, 77, 0.8], outline: null }},
		  { minValue: -80, maxValue: -75, label: "≤80% Trump (R)", symbol: { type: "simple-fill", color: [237, 100, 100, 0.8], outline: null }},
		  { minValue: -75, maxValue: -70, label: "≤75% Trump (R)", symbol: { type: "simple-fill", color: [240, 122, 122, 0.8], outline: null }}, 
		  { minValue: -70, maxValue: -65, label: "≤70% Trump (R)", symbol: { type: "simple-fill", color: [242, 144, 144, 0.8], outline: null }},
		  { minValue: -65, maxValue: -60, label: "≤65% Trump (R)", symbol: { type: "simple-fill", color: [245, 166, 166, 0.8], outline: null }},
		  { minValue: -60, maxValue: -55, label: "≤60% Trump (R)", symbol: { type: "simple-fill", color: [247, 188, 188, 0.8], outline: null }},
		  { minValue: -55, maxValue: -50, label: "≤55% Trump (R)", symbol: { type: "simple-fill", color: [250, 211, 211, 0.8], outline: null }},
		  { minValue: -50, maxValue: 0, label: "≤50% Trump (R)", symbol: { type: "simple-fill", color: [252, 233, 233, 0.8], outline: null }},
		  { minValue: -100002, maxValue: -100002, label: "Tie", symbol: { type: "simple-fill", color: [255, 255, 255, 0.8], outline: null }},
                  { minValue: 0, maxValue: 50, label: "≤50% Clinton (D)", symbol: { type: "simple-fill", color: [222, 238, 250, 0.8], outline: null }},
                  { minValue: 50, maxValue: 55, label: "≤55% Clinton (D)", symbol: { type: "simple-fill", color: [190, 220, 245, 0.8], outline: null }},
		  { minValue: 55, maxValue: 60, label: "≤60% Clinton (D)", symbol: { type: "simple-fill", color: [157, 203, 241, 0.8], outline: null }},
                  { minValue: 60, maxValue: 65, label: "≤65% Clinton (D)", symbol: { type: "simple-fill", color: [125, 185, 236, 0.8], outline: null }},
                  { minValue: 65, maxValue: 70, label: "≤70% Clinton (D)", symbol: { type: "simple-fill", color: [92, 168, 231, 0.8], outline: null }},
                  { minValue: 70, maxValue: 75, label: "≤75% Clinton (D)", symbol: { type: "simple-fill", color: [60, 150, 226, 0.8], outline: null }},
                  { minValue: 75, maxValue: 80, label: "≤80% Clinton (D)", symbol: { type: "simple-fill", color: [32, 132, 217, 0.8], outline: null }},
                  { minValue: 80, maxValue: 85, label: "≤85% Clinton (D)", symbol: { type: "simple-fill", color: [27, 112, 184, 0.8], outline: null }},
                  { minValue: 85, maxValue: 90, label: "≤90% Clinton (D)", symbol: { type: "simple-fill", color: [22, 93, 152, 0.8], outline: null }},
                  { minValue: 90, maxValue: 95, label: "≤95% Clinton (D)", symbol: { type: "simple-fill", color: [18, 73, 119, 0.8], outline: null }},
                  { minValue: 95, maxValue: 100, label: "≤100% Clinton (D)", symbol: { type: "simple-fill", color: [13, 53, 87, 0.8], outline: null }},
              ]
          });

            const countColRenderer16 = new ClassBreaksRenderer({
              valueExpression: `
                var dem_votes = $feature.votes_dem;
                var gop_votes = $feature.votes_gop;
                var total_votes = $feature.total_vote;

                if (total_votes == 0) {
                    return 100002;  // For no votes
                } else if (dem_votes == gop_votes) {
                    return -100002;  // For exact ties
                } else if (dem_votes > gop_votes) {
                    return (dem_votes / total_votes) * 100;  // Clinton won
                } else {
                    return -((gop_votes / total_votes) * 100);  // Trump won
                }
              `,
              classBreakInfos: [
                  { minValue: 100002, maxValue: 100002, label: "No Votes", symbol: { type: "simple-fill", color: [215, 219, 221, 0.8], outline: null }},
		  { minValue: -100, maxValue: -95, label: "≤100% Trump (R)", symbol: { type: "simple-fill", color: [213, 25, 25, 0.8], outline: null }},
                  { minValue: -95, maxValue: -90, label: "≤95% Trump (R)", symbol: { type: "simple-fill", color: [229, 33, 33, 0.8], outline: null }},
                  { minValue: -90, maxValue: -85, label: "≤90% Trump (R)", symbol: { type: "simple-fill", color: [232, 55, 55, 0.8], outline: null }},
                  { minValue: -85, maxValue: -80, label: "≤85% Trump (R)", symbol: { type: "simple-fill", color: [235, 77, 77, 0.8], outline: null }},
		  { minValue: -80, maxValue: -75, label: "≤80% Trump (R)", symbol: { type: "simple-fill", color: [237, 100, 100, 0.8], outline: null }},
		  { minValue: -75, maxValue: -70, label: "≤75% Trump (R)", symbol: { type: "simple-fill", color: [240, 122, 122, 0.8], outline: null }}, 
		  { minValue: -70, maxValue: -65, label: "≤70% Trump (R)", symbol: { type: "simple-fill", color: [242, 144, 144, 0.8], outline: null }},
		  { minValue: -65, maxValue: -60, label: "≤65% Trump (R)", symbol: { type: "simple-fill", color: [245, 166, 166, 0.8], outline: null }},
		  { minValue: -60, maxValue: -55, label: "≤60% Trump (R)", symbol: { type: "simple-fill", color: [247, 188, 188, 0.8], outline: null }},
		  { minValue: -55, maxValue: -50, label: "≤55% Trump (R)", symbol: { type: "simple-fill", color: [250, 211, 211, 0.8], outline: null }},
		  { minValue: -50, maxValue: 0, label: "≤50% Trump (R)", symbol: { type: "simple-fill", color: [252, 233, 233, 0.8], outline: null }},
		  { minValue: -100002, maxValue: -100002, label: "Tie", symbol: { type: "simple-fill", color: [255, 255, 255, 0.8], outline: null }},
                  { minValue: 0, maxValue: 50, label: "≤50% Clinton (D)", symbol: { type: "simple-fill", color: [222, 238, 250, 0.8], outline: null }},
                  { minValue: 50, maxValue: 55, label: "≤55% Clinton (D)", symbol: { type: "simple-fill", color: [190, 220, 245, 0.8], outline: null }},
		  { minValue: 55, maxValue: 60, label: "≤60% Clinton (D)", symbol: { type: "simple-fill", color: [157, 203, 241, 0.8], outline: null }},
                  { minValue: 60, maxValue: 65, label: "≤65% Clinton (D)", symbol: { type: "simple-fill", color: [125, 185, 236, 0.8], outline: null }},
                  { minValue: 65, maxValue: 70, label: "≤70% Clinton (D)", symbol: { type: "simple-fill", color: [92, 168, 231, 0.8], outline: null }},
                  { minValue: 70, maxValue: 75, label: "≤75% Clinton (D)", symbol: { type: "simple-fill", color: [60, 150, 226, 0.8], outline: null }},
                  { minValue: 75, maxValue: 80, label: "≤80% Clinton (D)", symbol: { type: "simple-fill", color: [32, 132, 217, 0.8], outline: null }},
                  { minValue: 80, maxValue: 85, label: "≤85% Clinton (D)", symbol: { type: "simple-fill", color: [27, 112, 184, 0.8], outline: null }},
                  { minValue: 85, maxValue: 90, label: "≤90% Clinton (D)", symbol: { type: "simple-fill", color: [22, 93, 152, 0.8], outline: null }},
                  { minValue: 90, maxValue: 95, label: "≤95% Clinton (D)", symbol: { type: "simple-fill", color: [18, 73, 119, 0.8], outline: null }},
                  { minValue: 95, maxValue: 100, label: "≤100% Clinton (D)", symbol: { type: "simple-fill", color: [13, 53, 87, 0.8], outline: null }},
              ]
          });

	  const precColRenderer16 = new ClassBreaksRenderer({
              valueExpression: `
                var dem_votes = $feature.G16PREDCLI;
                var gop_votes = $feature.G16PRERTRU;
	        var other_votes = $feature.Total_Othe;
                var total_votes = $feature.Total_Vote;

                if (total_votes == 0) {
                    return 100002;  // For no votes
	        } else if (other_votes > dem_votes && other_votes > gop_votes) {
       		    if (gop_votes > dem_votes || gop_votes < dem_votes) {
                    return (other_votes / total_votes) * 100001; // McMullin or other won
		    }
                } else if (dem_votes == gop_votes && dem_votes > other_votes) {
                    return -100002;  // For exact ties
                } else if (other_votes == gop_votes && other_votes > dem_votes) {
                    return -100002;  // For exact ties
                } else if (dem_votes == other_votes && dem_votes > gop_votes) {
                    return -100002;  // For exact ties
                } else if (dem_votes > gop_votes) {
                    return (dem_votes / total_votes) * 100;  // Clinton won
                } else {
                    return -((gop_votes / total_votes) * 100);  // Trump won
                }
              `,
              classBreakInfos: [
	          { minValue: 95000, maxValue: 100000, label: "≤100% Other", symbol: { type: "simple-fill", color: [53, 9, 109, 0.8], outline: null }},
		  { minValue: 90000, maxValue: 95000, label: "≤95% Other", symbol: { type: "simple-fill", color: [69, 11, 142, 0.8], outline: null }},
		  { minValue: 85000, maxValue: 90000, label: "≤90% Other", symbol: { type: "simple-fill", color: [85, 14, 175, 0.8], outline: null }},
		  { minValue: 80000, maxValue: 85000, label: "≤85% Other", symbol: { type: "simple-fill", color: [101, 16, 208, 0.8], outline: null }},
		  { minValue: 75000, maxValue: 80000, label: "≤80% Other", symbol: { type: "simple-fill", color: [118, 24, 237, 0.8], outline: null }},    
		  { minValue: 70000, maxValue: 75000, label: "≤75% Other", symbol: { type: "simple-fill", color: [138, 57, 239, 0.8], outline: null }},
		  { minValue: 65000, maxValue: 70000, label: "≤70% Other", symbol: { type: "simple-fill", color: [157, 90, 242, 0.8], outline: null }},
		  { minValue: 60000, maxValue: 65000, label: "≤65% Other", symbol: { type: "simple-fill", color: [177, 123, 245, 0.8], outline: null }},
		  { minValue: 55000, maxValue: 60000, label: "≤60% Other", symbol: { type: "simple-fill", color: [196, 156, 247, 0.8], outline: null }},
		  { minValue: 50000, maxValue: 55000, label: "≤55% Other", symbol: { type: "simple-fill", color: [216, 189, 250, 0.8], outline: null }},
		  { minValue: 100, maxValue: 50000, label: "≤50% Other", symbol: { type: "simple-fill", color: [235, 222, 252, 0.8], outline: null }},
		  { minValue: 100002, maxValue: 100002, label: "No Votes", symbol: { type: "simple-fill", color: [215, 219, 221, 0.8], outline: null }},
		  { minValue: -100, maxValue: -95, label: "≤100% Trump (R)", symbol: { type: "simple-fill", color: [213, 25, 25, 0.8], outline: null }},
                  { minValue: -95, maxValue: -90, label: "≤95% Trump (R)", symbol: { type: "simple-fill", color: [229, 33, 33, 0.8], outline: null }},
                  { minValue: -90, maxValue: -85, label: "≤90% Trump (R)", symbol: { type: "simple-fill", color: [232, 55, 55, 0.8], outline: null }},
                  { minValue: -85, maxValue: -80, label: "≤85% Trump (R)", symbol: { type: "simple-fill", color: [235, 77, 77, 0.8], outline: null }},
		  { minValue: -80, maxValue: -75, label: "≤80% Trump (R)", symbol: { type: "simple-fill", color: [237, 100, 100, 0.8], outline: null }},
		  { minValue: -75, maxValue: -70, label: "≤75% Trump (R)", symbol: { type: "simple-fill", color: [240, 122, 122, 0.8], outline: null }}, 
		  { minValue: -70, maxValue: -65, label: "≤70% Trump (R)", symbol: { type: "simple-fill", color: [242, 144, 144, 0.8], outline: null }},
		  { minValue: -65, maxValue: -60, label: "≤65% Trump (R)", symbol: { type: "simple-fill", color: [245, 166, 166, 0.8], outline: null }},
		  { minValue: -60, maxValue: -55, label: "≤60% Trump (R)", symbol: { type: "simple-fill", color: [247, 188, 188, 0.8], outline: null }},
		  { minValue: -55, maxValue: -50, label: "≤55% Trump (R)", symbol: { type: "simple-fill", color: [250, 211, 211, 0.8], outline: null }},
		  { minValue: -50, maxValue: 0, label: "≤50% Trump (R)", symbol: { type: "simple-fill", color: [252, 233, 233, 0.8], outline: null }},
		  { minValue: -100002, maxValue: -100002, label: "Tie", symbol: { type: "simple-fill", color: [255, 255, 255, 0.8], outline: null }},
                  { minValue: 0, maxValue: 50, label: "≤50% Clinton (D)", symbol: { type: "simple-fill", color: [222, 238, 250, 0.8], outline: null }},
                  { minValue: 50, maxValue: 55, label: "≤55% Clinton (D)", symbol: { type: "simple-fill", color: [190, 220, 245, 0.8], outline: null }},
		  { minValue: 55, maxValue: 60, label: "≤60% Clinton (D)", symbol: { type: "simple-fill", color: [157, 203, 241, 0.8], outline: null }},
                  { minValue: 60, maxValue: 65, label: "≤65% Clinton (D)", symbol: { type: "simple-fill", color: [125, 185, 236, 0.8], outline: null }},
                  { minValue: 65, maxValue: 70, label: "≤70% Clinton (D)", symbol: { type: "simple-fill", color: [92, 168, 231, 0.8], outline: null }},
                  { minValue: 70, maxValue: 75, label: "≤75% Clinton (D)", symbol: { type: "simple-fill", color: [60, 150, 226, 0.8], outline: null }},
                  { minValue: 75, maxValue: 80, label: "≤80% Clinton (D)", symbol: { type: "simple-fill", color: [32, 132, 217, 0.8], outline: null }},
                  { minValue: 80, maxValue: 85, label: "≤85% Clinton (D)", symbol: { type: "simple-fill", color: [27, 112, 184, 0.8], outline: null }},
                  { minValue: 85, maxValue: 90, label: "≤90% Clinton (D)", symbol: { type: "simple-fill", color: [22, 93, 152, 0.8], outline: null }},
                  { minValue: 90, maxValue: 95, label: "≤95% Clinton (D)", symbol: { type: "simple-fill", color: [18, 73, 119, 0.8], outline: null }},
                  { minValue: 95, maxValue: 100, label: "≤100% Clinton (D)", symbol: { type: "simple-fill", color: [13, 53, 87, 0.8], outline: null }},
              ]
          });
	
	//Highlight renderers for 2020
	const stateRenderer = new SimpleRenderer({
            //type: "simple",
            symbol: {
              type: "simple-fill",
              style: "none",
              outline: null
            }
        }); 
	
	const countRenderer = new SimpleRenderer({
            //type: "simple",
            symbol: {
              type: "simple-fill",
              style: "none",
              outline: null
            }
        }); 

	const precRenderer = new SimpleRenderer({
            //type: "simple",
            symbol: {
              type: "simple-fill",
              style: "none",
              outline: null
            }
        }); 

	const voteMarginSymbol = new SimpleMarkerSymbol({
          outline: {
            color: "rgba(0, 0, 0, 0)",
            width: 0
          }
        });        

	// Bubble renderer
	const stateBubbleRenderer = new SimpleRenderer({
              symbol: voteMarginSymbol,
              visualVariables: [
                {
                  type: "size",
                  field: "BID_TRU",
                  stops: [
                    { value: 2000, size: 3 },
		    { value: 500000, size: 20 },
		    { value: 5500000, size: 76 },
                    { value: -2000, size: 3 },
		    { value: -500000, size: 20 },
		    { value: -5500000, size: 76 },
                  ],
                  legendOptions: {
                    title: "Number of Biden (D) Votes minus Number of Trump (R) Votes"
                  }
                },
                {
                  type: "color",
                  field: "BID_TRU",
                  legendOptions: {
                    showLegend: false
                  },
                  stops: [
                    { value: -1, color: [204, 10, 18, 0.60] },
                    { value: 1, color: [37, 66, 143, 0.60] }
                  ]
                }
              ]
            });
	
	const countyBubbleRenderer = new SimpleRenderer({
            symbol: voteMarginSymbol,
            visualVariables: [
              {
                type: "size",
                field: "BID_TRU",
                stops: [
                  { value: 1, size: 1 },
		  { value: 100000, size: 23 },
		  { value: 2000000, size: 92 },
                  { value: -1, size: 1 },
		  { value: -100000, size: 23 },
		  { value: -2000000, size: 92 },
                ],
                legendOptions: {
                  title: "Number of Biden (D) Votes minus Number of Trump (R) Votes"
                }
              },
              {
                type: "color",
                field: "BID_TRU",
                legendOptions: {
                  showLegend: false
                },
                stops: [
                  { value: -1, color: [204, 10, 18, 0.60] },
                  { value: 1, color: [37, 66, 143, 0.60] }
                ]
              }
            ]
          });

          const precinctBubbleRenderer = new SimpleRenderer({
            symbol: voteMarginSymbol,
            visualVariables: [
              {
                type: "size",
                field: "BID_TRU",
                stops: [
                  { value: 1, size: 1 },
                  { value: 700, size: 8 },
                  { value: 13000, size: 27 },
                  { value: -1, size: 1 },
                  { value: -700, size: 8 },
                  { value: -13000, size: 27 },
                ],
                legendOptions: {
                  title: "Number of Biden (D) Votes minus Number of Trump (R) Votes"
                }
              },
              {
                type: "color",
                field: "BID_TRU",
                legendOptions: {
                  showLegend: false
                },
                stops: [
                  { value: -1, color: [204, 10, 18, 0.35] },
                  { value: 1, color: [37, 66, 143, 0.35] }
                ]
              }
            ]
          });

	  // Pie Chart Renderer
            const statePieRenderer = new PieChartRenderer({
              size: 10,
              attributes: [
              {
                field: "Trump_20",
                color: "#e30022",
                label: "Trump (R)"
              },
              {
                color: "#0000ff",
                label: "Biden (D)",
                field: "Biden"
              },
              {
                field: "Other_20",
                color: "#a9a9a9",
                label: "Other"
              }
            ],
            backgroundFillSymbol: {
              // polygon fill behind pie chart
              color: [127, 127, 127, 0.2],
              outline: {
                width: 1,
                color: [255, 255, 255, 0.3]
              }
            },		    
            outline: {
              width: 1.1,
              color: "grey"
            },
            visualVariables: [
            {
              type: "size", // size visual variable based on total votes represented in each pie
              valueExpression: "$feature.Tot_20",
	      valueExpressionTitle: "Total Number of Votes",
              minDataValue: 200000,
              maxDataValue: 18000000,
              minSize: 15,
              maxSize: 60
            }
          ]
    
        });
            
        const countyPieRenderer = new PieChartRenderer({
              size: 10,
              attributes: [
              {
                field: "votes_gop",
                color: "#e30022",
                label: "Trump (R)"
              },
              {
                color: "#0000ff",
                label: "Biden (D)",
                field: "votes_dem"
              },
              {
                field: "Total_Othe",
                color: "#a9a9a9",
                label: "Other"
              }
            ],
            backgroundFillSymbol: {
              // polygon fill behind pie chart
              color: [127, 127, 127, 0.2],
              outline: {
                width: 1,
                color: [255, 255, 255, 0.3]
              }
            },		    
            outline: {
              width: 1.1,
              color: "grey"
            },
            visualVariables: [
            {
              type: "size", // size visual variable based on total votes represented in each pie
              valueExpression: "$feature.total_vote",
	      valueExpressionTitle: "Total Number of Votes",
              minDataValue: 15000,
              maxDataValue: 1500000,
              minSize: 10,
              maxSize: 54
            }
          ]
    
        });

	const precinctPieRenderer = new PieChartRenderer({
              size: 10,
              attributes: [
              {
                field: "G20PRERTRU",
                color: "#e30022",
                label: "Trump (R)"
              },
              {
                color: "#0000ff",
                label: "Biden (D)",
                field: "G20PREDBID"
              },
              {
                field: "Total_Othe",
                color: "#a9a9a9",
                label: "Other"
              }
            ],
            backgroundFillSymbol: {
              // polygon fill behind pie chart
              color: [127, 127, 127, 0.2],
              outline: {
                width: 1,
                color: [255, 255, 255, 0.3]
              }
            },		    
            outline: {
              width: 1.1,
              color: "grey"
            },
            visualVariables: [
            {
              type: "size", // size visual variable based on total votes represented in each pie
              valueExpression: "$feature.Total_Vote",
	      valueExpressionTitle: "Total Number of Votes",
              minDataValue: 100,
              maxDataValue: 10000,
              minSize: 8,
              maxSize: 28
            }
          ]
    
        });

	  // Dot density renderer
	  const dotDensityRenderer = new DotDensityRenderer({
            dotValue: 1,
            outline: null,
            dotBlendingEnabled: true,
            referenceScale: 100000,
            legendOptions: {
              unit: "Vote(s)"
            },
            attributes: [
              {
                field: "G20PREDBID",
                color: "#00b6f1",
                label: "Biden (D)"
              },
              {
                field: "G20PRERTRU",
                color: "#f23c3f",
                label: "Trump (R)"
              }
            ]
          });

	  // Class breaks renderer
          const stateColRenderer2 = new ClassBreaksRenderer({
              valueExpression: `
                var dem_votes = $feature.Biden;
                var gop_votes = $feature.Trump_20;
                var total_votes = $feature.Tot_20;

                if (total_votes == 0) {
                    return 100002;  // For no votes
                } else if (dem_votes == gop_votes) {
                    return -100002;  // For exact ties
                } else if (dem_votes > gop_votes) {
                    return (dem_votes / total_votes) * 100;  // Clinton won
                } else {
                    return -((gop_votes / total_votes) * 100);  // Trump won
                }
              `,
              classBreakInfos: [
                  { minValue: 100002, maxValue: 100002, label: "No Votes", symbol: { type: "simple-fill", color: [215, 219, 221, 0.6], outline: null }},
		  { minValue: -100, maxValue: -95, label: "≤100% Trump (R)", symbol: { type: "simple-fill", color: [213, 25, 25, 0.6], outline: null }},
                  { minValue: -95, maxValue: -90, label: "≤95% Trump (R)", symbol: { type: "simple-fill", color: [229, 33, 33, 0.6], outline: null }},
                  { minValue: -90, maxValue: -85, label: "≤90% Trump (R)", symbol: { type: "simple-fill", color: [232, 55, 55, 0.6], outline: null }},
                  { minValue: -85, maxValue: -80, label: "≤85% Trump (R)", symbol: { type: "simple-fill", color: [235, 77, 77, 0.6], outline: null }},
		  { minValue: -80, maxValue: -75, label: "≤80% Trump (R)", symbol: { type: "simple-fill", color: [237, 100, 100, 0.6], outline: null }},
		  { minValue: -75, maxValue: -70, label: "≤75% Trump (R)", symbol: { type: "simple-fill", color: [240, 122, 122, 0.6], outline: null }}, 
		  { minValue: -70, maxValue: -65, label: "≤70% Trump (R)", symbol: { type: "simple-fill", color: [242, 144, 144, 0.6], outline: null }},
		  { minValue: -65, maxValue: -60, label: "≤65% Trump (R)", symbol: { type: "simple-fill", color: [245, 166, 166, 0.6], outline: null }},
		  { minValue: -60, maxValue: -55, label: "≤60% Trump (R)", symbol: { type: "simple-fill", color: [247, 188, 188, 0.6], outline: null }},
		  { minValue: -55, maxValue: -50, label: "≤55% Trump (R)", symbol: { type: "simple-fill", color: [250, 211, 211, 0.6], outline: null }},
		  { minValue: -50, maxValue: 0, label: "≤50% Trump (R)", symbol: { type: "simple-fill", color: [252, 233, 233, 0.6], outline: null }},
		  { minValue: -100002, maxValue: -100002, label: "Tie", symbol: { type: "simple-fill", color: [255, 255, 255, 0.6], outline: null }},
                  { minValue: 0, maxValue: 50, label: "≤50% Biden (D)", symbol: { type: "simple-fill", color: [222, 238, 250, 0.6], outline: null }},
                  { minValue: 50, maxValue: 55, label: "≤55% Biden (D)", symbol: { type: "simple-fill", color: [190, 220, 245, 0.6], outline: null }},
		  { minValue: 55, maxValue: 60, label: "≤60% Biden (D)", symbol: { type: "simple-fill", color: [157, 203, 241, 0.6], outline: null }},
                  { minValue: 60, maxValue: 65, label: "≤65% Biden (D)", symbol: { type: "simple-fill", color: [125, 185, 236, 0.6], outline: null }},
                  { minValue: 65, maxValue: 70, label: "≤70% Biden (D)", symbol: { type: "simple-fill", color: [92, 168, 231, 0.6], outline: null }},
                  { minValue: 70, maxValue: 75, label: "≤75% Biden (D)", symbol: { type: "simple-fill", color: [60, 150, 226, 0.6], outline: null }},
                  { minValue: 75, maxValue: 80, label: "≤80% Biden (D)", symbol: { type: "simple-fill", color: [32, 132, 217, 0.6], outline: null }},
                  { minValue: 80, maxValue: 85, label: "≤85% Biden (D)", symbol: { type: "simple-fill", color: [27, 112, 184, 0.6], outline: null }},
                  { minValue: 85, maxValue: 90, label: "≤90% Biden (D)", symbol: { type: "simple-fill", color: [22, 93, 152, 0.6], outline: null }},
                  { minValue: 90, maxValue: 95, label: "≤95% Biden (D)", symbol: { type: "simple-fill", color: [18, 73, 119, 0.6], outline: null }},
                  { minValue: 95, maxValue: 100, label: "≤100% Biden (D)", symbol: { type: "simple-fill", color: [13, 53, 87, 0.6], outline: null }},
              ]
          });
	  
          const countColRenderer2 = new ClassBreaksRenderer({
            valueExpression: `
              var dem_votes = $feature.votes_dem;
              var gop_votes = $feature.votes_gop;
              var total_votes = $feature.total_vote;

              if (total_votes == 0) {
                  return 100002;  // For no votes
              } else if (dem_votes == gop_votes) {
                  return -100002;  // For exact ties
              } else if (dem_votes > gop_votes) {
                  return (dem_votes / total_votes) * 100;  // Biden won
              } else {
                  return -((gop_votes / total_votes) * 100);  // Trump won
              }
            `,
            classBreakInfos: [
                 { minValue: 100002, maxValue: 100002, label: "No Votes", symbol: { type: "simple-fill", color: [215, 219, 221, 0.6], outline: null }},
		 { minValue: -100, maxValue: -95, label: "≤100% Trump (R)", symbol: { type: "simple-fill", color: [213, 25, 25, 0.6], outline: null }},
                 { minValue: -95, maxValue: -90, label: "≤95% Trump (R)", symbol: { type: "simple-fill", color: [229, 33, 33, 0.6], outline: null }},
                 { minValue: -90, maxValue: -85, label: "≤90% Trump (R)", symbol: { type: "simple-fill", color: [232, 55, 55, 0.6], outline: null }},
                 { minValue: -85, maxValue: -80, label: "≤85% Trump (R)", symbol: { type: "simple-fill", color: [235, 77, 77, 0.6], outline: null }},
		 { minValue: -80, maxValue: -75, label: "≤80% Trump (R)", symbol: { type: "simple-fill", color: [237, 100, 100, 0.6], outline: null }},
		 { minValue: -75, maxValue: -70, label: "≤75% Trump (R)", symbol: { type: "simple-fill", color: [240, 122, 122, 0.6], outline: null }}, 
		 { minValue: -70, maxValue: -65, label: "≤70% Trump (R)", symbol: { type: "simple-fill", color: [242, 144, 144, 0.6], outline: null }},
		 { minValue: -65, maxValue: -60, label: "≤65% Trump (R)", symbol: { type: "simple-fill", color: [245, 166, 166, 0.6], outline: null }},
		 { minValue: -60, maxValue: -55, label: "≤60% Trump (R)", symbol: { type: "simple-fill", color: [247, 188, 188, 0.6], outline: null }},
		 { minValue: -55, maxValue: -50, label: "≤55% Trump (R)", symbol: { type: "simple-fill", color: [250, 211, 211, 0.6], outline: null }},
		 { minValue: -50, maxValue: 0, label: "≤50% Trump (R)", symbol: { type: "simple-fill", color: [252, 233, 233, 0.6], outline: null }},
		 { minValue: -100002, maxValue: -100002, label: "Tie", symbol: { type: "simple-fill", color: [255, 255, 255, 0.6], outline: null }},
                 { minValue: 0, maxValue: 50, label: "≤50% Biden (D)", symbol: { type: "simple-fill", color: [222, 238, 250, 0.6], outline: null }},
                 { minValue: 50, maxValue: 55, label: "≤55% Biden (D)", symbol: { type: "simple-fill", color: [190, 220, 245, 0.6], outline: null }},
		 { minValue: 55, maxValue: 60, label: "≤60% Biden (D)", symbol: { type: "simple-fill", color: [157, 203, 241, 0.6], outline: null }},
                 { minValue: 60, maxValue: 65, label: "≤65% Biden (D)", symbol: { type: "simple-fill", color: [125, 185, 236, 0.6], outline: null }},
                 { minValue: 65, maxValue: 70, label: "≤70% Biden (D)", symbol: { type: "simple-fill", color: [92, 168, 231, 0.6], outline: null }},
                 { minValue: 70, maxValue: 75, label: "≤75% Biden (D)", symbol: { type: "simple-fill", color: [60, 150, 226, 0.6], outline: null }},
                 { minValue: 75, maxValue: 80, label: "≤80% Biden (D)", symbol: { type: "simple-fill", color: [32, 132, 217, 0.6], outline: null }},
                 { minValue: 80, maxValue: 85, label: "≤85% Biden (D)", symbol: { type: "simple-fill", color: [27, 112, 184, 0.6], outline: null }},
                 { minValue: 85, maxValue: 90, label: "≤90% Biden (D)", symbol: { type: "simple-fill", color: [22, 93, 152, 0.6], outline: null }},
                 { minValue: 90, maxValue: 95, label: "≤95% Biden (D)", symbol: { type: "simple-fill", color: [18, 73, 119, 0.6], outline: null }},
                 { minValue: 95, maxValue: 100, label: "≤100% Biden (D)", symbol: { type: "simple-fill", color: [13, 53, 87, 0.6], outline: null }},
              ]
          });

	  const precColRenderer2 = new ClassBreaksRenderer({
            valueExpression: `
              var dem_votes = $feature.G20PREDBID;
              var gop_votes = $feature.G20PRERTRU;
              var total_votes = $feature.Total_Vote;

              if (total_votes == 0) {
                  return 100002;  // For no votes
              } else if (dem_votes == gop_votes) {
                  return -100002;  // For exact ties
              } else if (dem_votes > gop_votes) {
                  return (dem_votes / total_votes) * 100;  // Biden won
              } else {
                  return -((gop_votes / total_votes) * 100);  // Trump won
              }
            `,
            classBreakInfos: [
                 { minValue: 100002, maxValue: 100002, label: "No Votes", symbol: { type: "simple-fill", color: [215, 219, 221, 0.35], outline: null }},
		 { minValue: -100, maxValue: -95, label: "≤100% Trump (R)", symbol: { type: "simple-fill", color: [213, 25, 25, 0.35], outline: null }},
                 { minValue: -95, maxValue: -90, label: "≤95% Trump (R)", symbol: { type: "simple-fill", color: [229, 33, 33, 0.35], outline: null }},
                 { minValue: -90, maxValue: -85, label: "≤90% Trump (R)", symbol: { type: "simple-fill", color: [232, 55, 55, 0.35], outline: null }},
                 { minValue: -85, maxValue: -80, label: "≤85% Trump (R)", symbol: { type: "simple-fill", color: [235, 77, 77, 0.35], outline: null }},
		 { minValue: -80, maxValue: -75, label: "≤80% Trump (R)", symbol: { type: "simple-fill", color: [237, 100, 100, 0.35], outline: null }},
		 { minValue: -75, maxValue: -70, label: "≤75% Trump (R)", symbol: { type: "simple-fill", color: [240, 122, 122, 0.35], outline: null }}, 
		 { minValue: -70, maxValue: -65, label: "≤70% Trump (R)", symbol: { type: "simple-fill", color: [242, 144, 144, 0.35], outline: null }},
		 { minValue: -65, maxValue: -60, label: "≤65% Trump (R)", symbol: { type: "simple-fill", color: [245, 166, 166, 0.35], outline: null }},
		 { minValue: -60, maxValue: -55, label: "≤60% Trump (R)", symbol: { type: "simple-fill", color: [247, 188, 188, 0.35], outline: null }},
		 { minValue: -55, maxValue: -50, label: "≤55% Trump (R)", symbol: { type: "simple-fill", color: [250, 211, 211, 0.35], outline: null }},
	         { minValue: -50, maxValue: 0, label: "≤50% Trump (R)", symbol: { type: "simple-fill", color: [252, 233, 233, 0.35], outline: null }},
		 { minValue: -100002, maxValue: -100002, label: "Tie", symbol: { type: "simple-fill", color: [255, 255, 255, 0.35], outline: null }},
                 { minValue: 0, maxValue: 50, label: "≤50% Biden (D)", symbol: { type: "simple-fill", color: [222, 238, 250, 0.35], outline: null }},
                 { minValue: 50, maxValue: 55, label: "≤55% Biden (D)", symbol: { type: "simple-fill", color: [190, 220, 245, 0.35], outline: null }},
		 { minValue: 55, maxValue: 60, label: "≤60% Biden (D)", symbol: { type: "simple-fill", color: [157, 203, 241, 0.35], outline: null }},
                 { minValue: 60, maxValue: 65, label: "≤65% Biden (D)", symbol: { type: "simple-fill", color: [125, 185, 236, 0.35], outline: null }},
                 { minValue: 65, maxValue: 70, label: "≤70% Biden (D)", symbol: { type: "simple-fill", color: [92, 168, 231, 0.35], outline: null }},
                 { minValue: 70, maxValue: 75, label: "≤75% Biden (D)", symbol: { type: "simple-fill", color: [60, 150, 226, 0.35], outline: null }},
                 { minValue: 75, maxValue: 80, label: "≤80% Biden (D)", symbol: { type: "simple-fill", color: [32, 132, 217, 0.35], outline: null }},
                 { minValue: 80, maxValue: 85, label: "≤85% Biden (D)", symbol: { type: "simple-fill", color: [27, 112, 184, 0.35], outline: null }},
                 { minValue: 85, maxValue: 90, label: "≤90% Biden (D)", symbol: { type: "simple-fill", color: [22, 93, 152, 0.35], outline: null }},
                 { minValue: 90, maxValue: 95, label: "≤95% Biden (D)", symbol: { type: "simple-fill", color: [18, 73, 119, 0.35], outline: null }},
                 { minValue: 95, maxValue: 100, label: "≤100% Biden (D)", symbol: { type: "simple-fill", color: [13, 53, 87, 0.35], outline: null }},
              ]
          });
	      
	  const stateColRenderer = new ClassBreaksRenderer({
              valueExpression: `
                var dem_votes = $feature.Biden;
                var gop_votes = $feature.Trump_20;
                var total_votes = $feature.Tot_20;

                if (total_votes == 0) {
                    return 100002;  // For no votes
                } else if (dem_votes == gop_votes) {
                    return -100002;  // For exact ties
                } else if (dem_votes > gop_votes) {
                    return (dem_votes / total_votes) * 100;  // Clinton won
                } else {
                    return -((gop_votes / total_votes) * 100);  // Trump won
                }
              `,
              classBreakInfos: [
                  { minValue: 100002, maxValue: 100002, label: "No Votes", symbol: { type: "simple-fill", color: [215, 219, 221, 0.8], outline: null }},
		  { minValue: -100, maxValue: -95, label: "≤100% Trump (R)", symbol: { type: "simple-fill", color: [213, 25, 25, 0.8], outline: null }},
                  { minValue: -95, maxValue: -90, label: "≤95% Trump (R)", symbol: { type: "simple-fill", color: [229, 33, 33, 0.8], outline: null }},
                  { minValue: -90, maxValue: -85, label: "≤90% Trump (R)", symbol: { type: "simple-fill", color: [232, 55, 55, 0.8], outline: null }},
                  { minValue: -85, maxValue: -80, label: "≤85% Trump (R)", symbol: { type: "simple-fill", color: [235, 77, 77, 0.8], outline: null }},
		  { minValue: -80, maxValue: -75, label: "≤80% Trump (R)", symbol: { type: "simple-fill", color: [237, 100, 100, 0.8], outline: null }},
		  { minValue: -75, maxValue: -70, label: "≤75% Trump (R)", symbol: { type: "simple-fill", color: [240, 122, 122, 0.8], outline: null }}, 
		  { minValue: -70, maxValue: -65, label: "≤70% Trump (R)", symbol: { type: "simple-fill", color: [242, 144, 144, 0.8], outline: null }},
		  { minValue: -65, maxValue: -60, label: "≤65% Trump (R)", symbol: { type: "simple-fill", color: [245, 166, 166, 0.8], outline: null }},
		  { minValue: -60, maxValue: -55, label: "≤60% Trump (R)", symbol: { type: "simple-fill", color: [247, 188, 188, 0.8], outline: null }},
		  { minValue: -55, maxValue: -50, label: "≤55% Trump (R)", symbol: { type: "simple-fill", color: [250, 211, 211, 0.8], outline: null }},
		  { minValue: -50, maxValue: 0, label: "≤50% Trump (R)", symbol: { type: "simple-fill", color: [252, 233, 233, 0.8], outline: null }},
		  { minValue: -100002, maxValue: -100002, label: "Tie", symbol: { type: "simple-fill", color: [255, 255, 255, 0.8], outline: null }},
                  { minValue: 0, maxValue: 50, label: "≤50% Biden (D)", symbol: { type: "simple-fill", color: [222, 238, 250, 0.8], outline: null }},
                  { minValue: 50, maxValue: 55, label: "≤55% Biden (D)", symbol: { type: "simple-fill", color: [190, 220, 245, 0.8], outline: null }},
		  { minValue: 55, maxValue: 60, label: "≤60% Biden (D)", symbol: { type: "simple-fill", color: [157, 203, 241, 0.8], outline: null }},
                  { minValue: 60, maxValue: 65, label: "≤65% Biden (D)", symbol: { type: "simple-fill", color: [125, 185, 236, 0.8], outline: null }},
                  { minValue: 65, maxValue: 70, label: "≤70% Biden (D)", symbol: { type: "simple-fill", color: [92, 168, 231, 0.8], outline: null }},
                  { minValue: 70, maxValue: 75, label: "≤75% Biden (D)", symbol: { type: "simple-fill", color: [60, 150, 226, 0.8], outline: null }},
                  { minValue: 75, maxValue: 80, label: "≤80% Biden (D)", symbol: { type: "simple-fill", color: [32, 132, 217, 0.8], outline: null }},
                  { minValue: 80, maxValue: 85, label: "≤85% Biden (D)", symbol: { type: "simple-fill", color: [27, 112, 184, 0.8], outline: null }},
                  { minValue: 85, maxValue: 90, label: "≤90% Biden (D)", symbol: { type: "simple-fill", color: [22, 93, 152, 0.8], outline: null }},
                  { minValue: 90, maxValue: 95, label: "≤95% Biden (D)", symbol: { type: "simple-fill", color: [18, 73, 119, 0.8], outline: null }},
                  { minValue: 95, maxValue: 100, label: "≤100% Biden (D)", symbol: { type: "simple-fill", color: [13, 53, 87, 0.8], outline: null }},
              ]
          });
	  
          const countColRenderer = new ClassBreaksRenderer({
            valueExpression: `
              var dem_votes = $feature.votes_dem;
              var gop_votes = $feature.votes_gop;
              var total_votes = $feature.total_vote;

              if (total_votes == 0) {
                  return 100002;  // For no votes
              } else if (dem_votes == gop_votes) {
                  return -100002;  // For exact ties
              } else if (dem_votes > gop_votes) {
                  return (dem_votes / total_votes) * 100;  // Biden won
              } else {
                  return -((gop_votes / total_votes) * 100);  // Trump won
              }
            `,
            classBreakInfos: [
                 { minValue: 100002, maxValue: 100002, label: "No Votes", symbol: { type: "simple-fill", color: [215, 219, 221, 0.8], outline: null }},
		 { minValue: -100, maxValue: -95, label: "≤100% Trump (R)", symbol: { type: "simple-fill", color: [213, 25, 25, 0.8], outline: null }},
                 { minValue: -95, maxValue: -90, label: "≤95% Trump (R)", symbol: { type: "simple-fill", color: [229, 33, 33, 0.8], outline: null }},
                 { minValue: -90, maxValue: -85, label: "≤90% Trump (R)", symbol: { type: "simple-fill", color: [232, 55, 55, 0.8], outline: null }},
                 { minValue: -85, maxValue: -80, label: "≤85% Trump (R)", symbol: { type: "simple-fill", color: [235, 77, 77, 0.8], outline: null }},
		 { minValue: -80, maxValue: -75, label: "≤80% Trump (R)", symbol: { type: "simple-fill", color: [237, 100, 100, 0.8], outline: null }},
		 { minValue: -75, maxValue: -70, label: "≤75% Trump (R)", symbol: { type: "simple-fill", color: [240, 122, 122, 0.8], outline: null }}, 
		 { minValue: -70, maxValue: -65, label: "≤70% Trump (R)", symbol: { type: "simple-fill", color: [242, 144, 144, 0.8], outline: null }},
		 { minValue: -65, maxValue: -60, label: "≤65% Trump (R)", symbol: { type: "simple-fill", color: [245, 166, 166, 0.8], outline: null }},
		 { minValue: -60, maxValue: -55, label: "≤60% Trump (R)", symbol: { type: "simple-fill", color: [247, 188, 188, 0.8], outline: null }},
		 { minValue: -55, maxValue: -50, label: "≤55% Trump (R)", symbol: { type: "simple-fill", color: [250, 211, 211, 0.8], outline: null }},
		 { minValue: -50, maxValue: 0, label: "≤50% Trump (R)", symbol: { type: "simple-fill", color: [252, 233, 233, 0.8], outline: null }},
		 { minValue: -100002, maxValue: -100002, label: "Tie", symbol: { type: "simple-fill", color: [255, 255, 255, 0.8], outline: null }},
                 { minValue: 0, maxValue: 50, label: "≤50% Biden (D)", symbol: { type: "simple-fill", color: [222, 238, 250, 0.8], outline: null }},
                 { minValue: 50, maxValue: 55, label: "≤55% Biden (D)", symbol: { type: "simple-fill", color: [190, 220, 245, 0.8], outline: null }},
		 { minValue: 55, maxValue: 60, label: "≤60% Biden (D)", symbol: { type: "simple-fill", color: [157, 203, 241, 0.8], outline: null }},
                 { minValue: 60, maxValue: 65, label: "≤65% Biden (D)", symbol: { type: "simple-fill", color: [125, 185, 236, 0.8], outline: null }},
                 { minValue: 65, maxValue: 70, label: "≤70% Biden (D)", symbol: { type: "simple-fill", color: [92, 168, 231, 0.8], outline: null }},
                 { minValue: 70, maxValue: 75, label: "≤75% Biden (D)", symbol: { type: "simple-fill", color: [60, 150, 226, 0.8], outline: null }},
                 { minValue: 75, maxValue: 80, label: "≤80% Biden (D)", symbol: { type: "simple-fill", color: [32, 132, 217, 0.8], outline: null }},
                 { minValue: 80, maxValue: 85, label: "≤85% Biden (D)", symbol: { type: "simple-fill", color: [27, 112, 184, 0.8], outline: null }},
                 { minValue: 85, maxValue: 90, label: "≤90% Biden (D)", symbol: { type: "simple-fill", color: [22, 93, 152, 0.8], outline: null }},
                 { minValue: 90, maxValue: 95, label: "≤95% Biden (D)", symbol: { type: "simple-fill", color: [18, 73, 119, 0.8], outline: null }},
                 { minValue: 95, maxValue: 100, label: "≤100% Biden (D)", symbol: { type: "simple-fill", color: [13, 53, 87, 0.8], outline: null }},
              ]
          });

	  const precColRenderer = new ClassBreaksRenderer({
            valueExpression: `
              var dem_votes = $feature.G20PREDBID;
              var gop_votes = $feature.G20PRERTRU;
              var total_votes = $feature.Total_Vote;

              if (total_votes == 0) {
                  return 100002;  // For no votes
              } else if (dem_votes == gop_votes) {
                  return -100002;  // For exact ties
              } else if (dem_votes > gop_votes) {
                  return (dem_votes / total_votes) * 100;  // Biden won
              } else {
                  return -((gop_votes / total_votes) * 100);  // Trump won
              }
            `,
            classBreakInfos: [
                 { minValue: 100002, maxValue: 100002, label: "No Votes", symbol: { type: "simple-fill", color: [215, 219, 221, 0.8], outline: null }},
		 { minValue: -100, maxValue: -95, label: "≤100% Trump (R)", symbol: { type: "simple-fill", color: [213, 25, 25, 0.8], outline: null }},
                 { minValue: -95, maxValue: -90, label: "≤95% Trump (R)", symbol: { type: "simple-fill", color: [229, 33, 33, 0.8], outline: null }},
                 { minValue: -90, maxValue: -85, label: "≤90% Trump (R)", symbol: { type: "simple-fill", color: [232, 55, 55, 0.8], outline: null }},
                 { minValue: -85, maxValue: -80, label: "≤85% Trump (R)", symbol: { type: "simple-fill", color: [235, 77, 77, 0.8], outline: null }},
		 { minValue: -80, maxValue: -75, label: "≤80% Trump (R)", symbol: { type: "simple-fill", color: [237, 100, 100, 0.8], outline: null }},
		 { minValue: -75, maxValue: -70, label: "≤75% Trump (R)", symbol: { type: "simple-fill", color: [240, 122, 122, 0.8], outline: null }}, 
		 { minValue: -70, maxValue: -65, label: "≤70% Trump (R)", symbol: { type: "simple-fill", color: [242, 144, 144, 0.8], outline: null }},
		 { minValue: -65, maxValue: -60, label: "≤65% Trump (R)", symbol: { type: "simple-fill", color: [245, 166, 166, 0.8], outline: null }},
		 { minValue: -60, maxValue: -55, label: "≤60% Trump (R)", symbol: { type: "simple-fill", color: [247, 188, 188, 0.8], outline: null }},
		 { minValue: -55, maxValue: -50, label: "≤55% Trump (R)", symbol: { type: "simple-fill", color: [250, 211, 211, 0.8], outline: null }},
	         { minValue: -50, maxValue: 0, label: "≤50% Trump (R)", symbol: { type: "simple-fill", color: [252, 233, 233, 0.8], outline: null }},
		 { minValue: -100002, maxValue: -100002, label: "Tie", symbol: { type: "simple-fill", color: [255, 255, 255, 0.8], outline: null }},
                 { minValue: 0, maxValue: 50, label: "≤50% Biden (D)", symbol: { type: "simple-fill", color: [222, 238, 250, 0.8], outline: null }},
                 { minValue: 50, maxValue: 55, label: "≤55% Biden (D)", symbol: { type: "simple-fill", color: [190, 220, 245, 0.8], outline: null }},
		 { minValue: 55, maxValue: 60, label: "≤60% Biden (D)", symbol: { type: "simple-fill", color: [157, 203, 241, 0.8], outline: null }},
                 { minValue: 60, maxValue: 65, label: "≤65% Biden (D)", symbol: { type: "simple-fill", color: [125, 185, 236, 0.8], outline: null }},
                 { minValue: 65, maxValue: 70, label: "≤70% Biden (D)", symbol: { type: "simple-fill", color: [92, 168, 231, 0.8], outline: null }},
                 { minValue: 70, maxValue: 75, label: "≤75% Biden (D)", symbol: { type: "simple-fill", color: [60, 150, 226, 0.8], outline: null }},
                 { minValue: 75, maxValue: 80, label: "≤80% Biden (D)", symbol: { type: "simple-fill", color: [32, 132, 217, 0.8], outline: null }},
                 { minValue: 80, maxValue: 85, label: "≤85% Biden (D)", symbol: { type: "simple-fill", color: [27, 112, 184, 0.8], outline: null }},
                 { minValue: 85, maxValue: 90, label: "≤90% Biden (D)", symbol: { type: "simple-fill", color: [22, 93, 152, 0.8], outline: null }},
                 { minValue: 90, maxValue: 95, label: "≤95% Biden (D)", symbol: { type: "simple-fill", color: [18, 73, 119, 0.8], outline: null }},
                 { minValue: 95, maxValue: 100, label: "≤100% Biden (D)", symbol: { type: "simple-fill", color: [13, 53, 87, 0.8], outline: null }},
              ]
          });

          stateLayer16.renderer = stateRenderer16;
	  countyLayer16.renderer = countRenderer16;
	  precinctLayer16.renderer = precRenderer16;
          pieStateLayer16.renderer = statePieRenderer16;
          pieCountyLayer16.renderer = countyPieRenderer16;
          piePrecinctLayer16.renderer = precinctPieRenderer16;
          bubbleStateLayer16.renderer = stateBubbleRenderer16;  
	  bubblePrecinctLayer16.renderer = precinctBubbleRenderer16;
	  bubbleCountyLayer16.renderer = countyBubbleRenderer16;
	  bubbleStateLayer162.renderer = stateBubbleRenderer16;
	  bubblePrecinctLayer162.renderer = precinctBubbleRenderer16;
	  bubbleCountyLayer162.renderer = countyBubbleRenderer16;
	  dotLayer16.renderer = dotDensityRenderer16;
          stateColLayer16.renderer = stateColRenderer16;
	  countColLayer16.renderer = countColRenderer16;
	  precColLayer16.renderer = precColRenderer16;
	  stateColLayer162.renderer = stateColRenderer162;
	  countColLayer162.renderer = countColRenderer162;
	  precColLayer162.renderer = precColRenderer162;
	  stateLayer.renderer = stateRenderer;
	  countyLayer.renderer = countRenderer;
	  precinctLayer.renderer = precRenderer;
          pieStateLayer.renderer = statePieRenderer;
          pieCountyLayer.renderer = countyPieRenderer;
          piePrecinctLayer.renderer = precinctPieRenderer;
	  bubblePrecinctLayer.renderer = precinctBubbleRenderer;
	  bubbleCountyLayer.renderer = countyBubbleRenderer;         
	  bubbleStateLayer.renderer = stateBubbleRenderer;
	  bubblePrecinctLayer2.renderer = precinctBubbleRenderer;
	  bubbleCountyLayer2.renderer = countyBubbleRenderer;         
	  bubbleStateLayer2.renderer = stateBubbleRenderer;
	  dotLayer.renderer = dotDensityRenderer;
	  stateColLayer.renderer = stateColRenderer;
	  countColLayer.renderer = countColRenderer;
	  precColLayer.renderer = precColRenderer;
	  stateColLayer2.renderer = stateColRenderer2;
	  countColLayer2.renderer = countColRenderer2;
	  precColLayer2.renderer = precColRenderer2;

          //const debouncedEventHandler = promiseUtils.debounce(eventHandler);
	      
          view.on("pointer-move", eventHandler);
	  view.on("pointer-down", eventHandler);

          let highlight;
          const infoDiv = document.getElementById('infoDiv');  
	  let timeoutId;

	  view.on("pointer-move", function(event) {
          // Clear the timeout if it exists
            if (timeoutId) {
              clearTimeout(timeoutId);
            }

            // Set a timeout to run the eventHandler after a delay
            timeoutId = setTimeout(function() {
              eventHandler(event);
            }, 10);  // 10 ms delay
          });        
	      
	  function eventHandler(event) {
            const screenPoint = {
              include: [stateLayer16, countyLayer16, precinctLayer16, stateLayer, countyLayer, precinctLayer]
            };

            view.hitTest(event, screenPoint).then(function(response) {
              if (response.results.length > 0) {
                const graphic = response.results[0].graphic;

                let featureID;
                if (graphic.layer === precinctLayer) {
                  featureID = graphic.attributes.FID;  // Use the FID attribute for precincts
                } else if (graphic.layer === countyLayer) {
                  featureID = graphic.attributes.CountyFi_1;  // Use the CountyFi_1 attribute for counties
                } else if (graphic.layer === stateLayer) {
                  featureID = graphic.attributes.snid20;  // Use the snid attribute for states
                } else if (graphic.layer === precinctLayer16) {
                  featureID = graphic.attributes.pnid;  // Use the pnid attribute for precincts
                } else if (graphic.layer === countyLayer16) {
                  featureID = graphic.attributes.cnid16;  // Use the cnid attribute for counties
                } else if (graphic.layer === stateLayer16) {
                  featureID = graphic.attributes.snid16;  // Use the snid attribute for states
                } 

                if (graphic.layer === precinctLayer && featureID !== currentPrecinctID) {
        	  currentPrecinctID = featureID;
      		} else if (graphic.layer === countyLayer && featureID !== currentCountyID) {
        	  currentCountyID = featureID;
                } else if (graphic.layer === stateLayer && featureID !== currentStateID) {
        	  currentStateID = featureID;
	        } else if (graphic.layer === precinctLayer16 && featureID !== currentPrecinctID16) {
        	  currentPrecinctID16 = featureID;
      		} else if (graphic.layer === countyLayer16 && featureID !== currentCountyID16) {
        	  currentCountyID16 = featureID;
                } else if (graphic.layer === stateLayer16 && featureID !== currentStateID16) {
        	  currentStateID16 = featureID;
      		} else {
                  // The feature under the mouse is the same as the last highlighted feature, so return
                  return;
                }

                  if (highlight) {
                    highlight.remove();
                    highlight = null;
                  }

                  let layerView;
                  if (graphic.layer === precinctLayer) {
                    layerView = PrecinctLayerView;
                    currentPrecinctID = featureID;
		    highlight = layerView.highlight(graphic);
                    // Get the vote counts for each candidate
		    var clintonVotes = graphic.attributes.G20PREDBID;
                    var trumpVotes = graphic.attributes.G20PRERTRU;
                    var otherVotes = graphic.attributes.Total_Othe;

                    // Determine which candidate has the most votes
                    var maxVotes = Math.max(clintonVotes, trumpVotes, otherVotes);

                    // Set the background color based on the candidate with the most votes
                    var clintonHighlight = (clintonVotes === maxVotes) ? "background-color: #e0ecf8;" : "";
                    var trumpHighlight = (trumpVotes === maxVotes) ? "background-color: #f8e0e0;" : "";
                    var otherHighlight = (otherVotes === maxVotes) ? "background-color: #e6e6e6;" : "";

                    infoDiv.innerHTML = 
                      "<b style='font-size: 1.2em;'>Precinct Results</b><br>" +
                      "<div style='color: black; font-weight: 500;" + clintonHighlight + "'>Biden: <b style='color: blue;'>" + graphic.attributes.PCTBID_S + "</b> (" + clintonVotes.toLocaleString() + " votes)</div>" +
                      "<div style='color: black; font-weight: 500;" + trumpHighlight + "'>Trump: <b style='color: red;'>" + graphic.attributes.PCTTRU_S + "</b> (" + trumpVotes.toLocaleString() + " votes)</div>" +
                      "<div style='color: black; font-weight: 500;" + otherHighlight + "'>Other: <b style='color: dimgrey;'>" + graphic.attributes.PCTOTH_S + "</b> (" + otherVotes.toLocaleString() + " votes)</div>";
                  } else if (graphic.layer === countyLayer) {
                    layerView = CountyLayerView;
                    currentCountyID = featureID;
		    highlight = layerView.highlight(graphic);
                    // Get the vote counts for each candidate
		    var clintonVotes = graphic.attributes.votes_dem;
                    var trumpVotes = graphic.attributes.votes_gop;
                    var otherVotes = graphic.attributes.Total_Othe;

                    // Determine which candidate has the most votes
                    var maxVotes = Math.max(clintonVotes, trumpVotes, otherVotes);

                    // Set the background color based on the candidate with the most votes
                    var clintonHighlight = (clintonVotes === maxVotes) ? "background-color: #e0ecf8;" : "";
                    var trumpHighlight = (trumpVotes === maxVotes) ? "background-color: #f8e0e0;" : "";
                    var otherHighlight = (otherVotes === maxVotes) ? "background-color: #e6e6e6;" : "";

                    infoDiv.innerHTML = 
                      "<b span style='font-size: 1.2em;'>" + graphic.attributes.county_nam + " Results</b><br>" +
                      "<div style='color: black; font-weight: 500;" + clintonHighlight + "'>Biden: <b style='color: blue;'>" + graphic.attributes.PCTBID + "</b> (" + clintonVotes.toLocaleString() + " votes)</div>" +
                      "<div style='color: black; font-weight: 500;" + trumpHighlight + "'>Trump: <b style='color: red;'>" + graphic.attributes.PCTTRU + "</b> (" + trumpVotes.toLocaleString() + " votes)</div>" +
                      "<div style='color: black; font-weight: 500;" + otherHighlight + "'>Other: <b style='color: dimgrey;'>" + graphic.attributes.PCTOTH + "</b> (" + otherVotes.toLocaleString() + " votes)</div>";
                  } else if (graphic.layer === stateLayer) {
                    layerView = StateLayerView;
                    currentStateID = featureID;
		    highlight = layerView.highlight(graphic);
                    // Get the vote counts for each candidate
		    var clintonVotes = graphic.attributes.Biden;
                    var trumpVotes = graphic.attributes.Trump_20;
                    var otherVotes = graphic.attributes.Other_20;

                    // Determine which candidate has the most votes
                    var maxVotes = Math.max(clintonVotes, trumpVotes, otherVotes);

                    // Set the background color based on the candidate with the most votes
                    var clintonHighlight = (clintonVotes === maxVotes) ? "background-color: #e0ecf8;" : "";
                    var trumpHighlight = (trumpVotes === maxVotes) ? "background-color: #f8e0e0;" : "";
                    var otherHighlight = (otherVotes === maxVotes) ? "background-color: #e6e6e6;" : "";

                    infoDiv.innerHTML = 
                      "<b span style='font-size: 1.2em;'>" + graphic.attributes.STATE_NAME + " Results</b><br>" +
                      "<div style='color: black; font-weight: 500;" + clintonHighlight + "'>Biden: <b style='color: blue;'>" + graphic.attributes.PCT_BID_S + "</b> (" + clintonVotes.toLocaleString() + " votes)</div>" +
                      "<div style='color: black; font-weight: 500;" + trumpHighlight + "'>Trump: <b style='color: red;'>" + graphic.attributes.PCT_T_20_S + "</b> (" + trumpVotes.toLocaleString() + " votes)</div>" +
                      "<div style='color: black; font-weight: 500;" + otherHighlight + "'>Other: <b style='color: dimgrey;'>" + graphic.attributes.PCT_O_20_S + "</b> (" + otherVotes.toLocaleString() + " votes)</div>";
                  } else if (graphic.layer === precinctLayer16) {
                    layerView = PrecinctLayerView16;
                    currentPrecinctID16 = featureID;
		    highlight = layerView.highlight(graphic);
                    // Get the vote counts for each candidate
		    var clintonVotes = graphic.attributes.G16PREDCLI;
                    var trumpVotes = graphic.attributes.G16PRERTRU;
                    var otherVotes = graphic.attributes.Total_Othe;

                    // Determine which candidate has the most votes
                    var maxVotes = Math.max(clintonVotes, trumpVotes, otherVotes);

                    // Set the background color based on the candidate with the most votes
                    var clintonHighlight = (clintonVotes === maxVotes) ? "background-color: #e0ecf8;" : "";
                    var trumpHighlight = (trumpVotes === maxVotes) ? "background-color: #f8e0e0;" : "";
                    var otherHighlight = (otherVotes === maxVotes) ? "background-color: #e6e6e6;" : "";

                    infoDiv.innerHTML = 
                      "<b style='font-size: 1.2em;'>Precinct Results</b><br>" +
                      "<div style='color: black; font-weight: 500;" + clintonHighlight + "'>Clinton: <b style='color: blue;'>" + graphic.attributes.PCTCLI_S + "</b> (" + clintonVotes.toLocaleString() + " votes)</div>" +
                      "<div style='color: black; font-weight: 500;" + trumpHighlight + "'>Trump: <b style='color: red;'>" + graphic.attributes.PCTTRU_S + "</b> (" + trumpVotes.toLocaleString() + " votes)</div>" +
                      "<div style='color: black; font-weight: 500;" + otherHighlight + "'>Other: <b style='color: dimgrey;'>" + graphic.attributes.PCTOTH_S + "</b> (" + otherVotes.toLocaleString() + " votes)</div>";
                  } else if (graphic.layer === countyLayer16) {
                    layerView = CountyLayerView16;
                    currentCountyID16 = featureID;
		    highlight = layerView.highlight(graphic);
                    // Get the vote counts for each candidate
		    var clintonVotes = graphic.attributes.votes_dem;
                    var trumpVotes = graphic.attributes.votes_gop;
                    var otherVotes = graphic.attributes.Total_Othe;

                    // Determine which candidate has the most votes
                    var maxVotes = Math.max(clintonVotes, trumpVotes, otherVotes);

                    // Set the background color based on the candidate with the most votes
                    var clintonHighlight = (clintonVotes === maxVotes) ? "background-color: #e0ecf8;" : "";
                    var trumpHighlight = (trumpVotes === maxVotes) ? "background-color: #f8e0e0;" : "";
                    var otherHighlight = (otherVotes === maxVotes) ? "background-color: #e6e6e6;" : "";

                    infoDiv.innerHTML = 
                      "<b span style='font-size: 1.2em;'>" + graphic.attributes.county_nam + " Results</b><br>" +
                      "<div style='color: black; font-weight: 500;" + clintonHighlight + "'>Clinton: <b style='color: blue;'>" + graphic.attributes.PCTCLI + "</b> (" + clintonVotes.toLocaleString() + " votes)</div>" +
                      "<div style='color: black; font-weight: 500;" + trumpHighlight + "'>Trump: <b style='color: red;'>" + graphic.attributes.PCTTRU + "</b> (" + trumpVotes.toLocaleString() + " votes)</div>" +
                      "<div style='color: black; font-weight: 500;" + otherHighlight + "'>Other: <b style='color: dimgrey;'>" + graphic.attributes.PCTOTH + "</b> (" + otherVotes.toLocaleString() + " votes)</div>";
                  } else if (graphic.layer === stateLayer16) {
                    layerView = StateLayerView16;
                    currentStateID16 = featureID;
		    highlight = layerView.highlight(graphic);
                    // Get the vote counts for each candidate
		    var clintonVotes = graphic.attributes.Clinton;
                    var trumpVotes = graphic.attributes.Trump_16;
                    var otherVotes = graphic.attributes.Other_16;

                    // Determine which candidate has the most votes
                    var maxVotes = Math.max(clintonVotes, trumpVotes, otherVotes);

                    // Set the background color based on the candidate with the most votes
                    var clintonHighlight = (clintonVotes === maxVotes) ? "background-color: #e0ecf8;" : "";
                    var trumpHighlight = (trumpVotes === maxVotes) ? "background-color: #f8e0e0;" : "";
                    var otherHighlight = (otherVotes === maxVotes) ? "background-color: #e6e6e6;" : "";

                    infoDiv.innerHTML = 
                      "<b span style='font-size: 1.2em;'>" + graphic.attributes.STATE_NAME + " Results</b><br>" +
                      "<div style='color: black; font-weight: 500;" + clintonHighlight + "'>Clinton: <b style='color: blue;'>" + graphic.attributes.PCT_CLI_S + "</b> (" + clintonVotes.toLocaleString() + " votes)</div>" +
                      "<div style='color: black; font-weight: 500;" + trumpHighlight + "'>Trump: <b style='color: red;'>" + graphic.attributes.PCT_T_16_S + "</b> (" + trumpVotes.toLocaleString() + " votes)</div>" +
                      "<div style='color: black; font-weight: 500;" + otherHighlight + "'>Other: <b style='color: dimgrey;'>" + graphic.attributes.PCT_O_16_S + "</b> (" + otherVotes.toLocaleString() + " votes)</div>";
                  }
              
                  if (layerView) {
                    infoDiv.style.display = 'block';
                  }
                  } else {
                  if (highlight) {
                    highlight.remove();
                    highlight = null;
                  }
                  currentPrecinctID = null;
                  currentCountyID = null;
                  currentStateID = null;
                  currentPrecinctID16 = null;
                  currentCountyID16 = null;
                  currentStateID16 = null;
              
                  infoDiv.style.display = 'none';
                     
 	      }
            });
          }
        });

       view.ui.add(
        [
          new Expand({
            view: view,
            content: new Search({ view: view }),
            group: "top-left",
            expanded: false
          }),
	  new Expand({
            view: view,
            content: new Legend({ view: view }),
            group: "top-left",
            expanded: true
          })
        ],
        "top-left"
      );
    });
  </script>
</head>

<body>
  <div id="viewDiv"></div>
  <div id="infoDiv"></div>
</body>
</html>
