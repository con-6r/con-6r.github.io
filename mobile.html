<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no" />
  <title>Election Explorer</title>

  <link rel="stylesheet" type="text/css" href="https://js.arcgis.com/calcite-components/2.13.0/calcite.css" />
  <link rel="stylesheet" href="https://js.arcgis.com/4.17/esri/themes/light/main.css" />
  <script type="module" src="https://js.arcgis.com/calcite-components/2.13.0/calcite.esm.js"></script>
	
  <style>
    html,
    body,
    #viewDiv {
      padding: 0;
      margin: 0;
          height: 100%;
          width: 100%;
        }
        .dark-mode {
          filter: hue-rotate(180deg) invert(1);
        }

        .infoDiv-dark-mode {
          filter: hue-rotate(180deg) invert(1);
        }
        #infoDiv {
          filter: hue-rotate(360deg) invert(0);
          display: none;
          position: absolute;
          top: 15px;
          right: 15px;
          background-color: #fff;
          padding-top: 9px;
		  padding-right: 13px;
		  padding-left: 13px;
		  padding-bottom: 9px;
          margin: auto;
          z-index: 99;
          font-family: "Avenir Next", sans-serif;
          font-size: 15px;
          width: auto;
		  min-width: 200px;
          max-width: 600px;
          white-space: nowrap;
          box-shadow: 0px 1px 3px rgba(0, 0, 0, 0.2);
        }
		#infoDivContent {
	      white-space: normal;
		  line-height: 1.15;
		/* Add a rule */
		}
		#infoDivContent > * {
		  margin: 0; 
		  padding: 2px 0; 
		}
		#closeInfoDiv {
	      position: absolute;
          top: 2px;
          right: 2px;
          background: none;
		  border: none;
		  font-size: 20px;
		  cursor: pointer;
		  padding: 0px;
		  line-height: 0.5;
		}
        .dark-mode-button {
          --calcite-color-brand: #FFFFFF;
          --calcite-color-text-inverse: #6E6E6E;
          --calcite-color-brand-hover: #F3F3F3;
          --calcite-color-brand-press: #E2F1FB;
        }
  </style>

  <script src="https://js.arcgis.com/4.17/"></script>

  <script>
  
    require([
      "esri/WebMap",
      "esri/core/Accessor",
      "esri/support/actions/ActionButton",
      "esri/views/MapView",
      "esri/layers/FeatureLayer",
      "esri/layers/GroupLayer",
      "esri/symbols/SimpleFillSymbol",
      "esri/renderers/SimpleRenderer",
      "esri/symbols/SimpleMarkerSymbol",
      "esri/renderers/ClassBreaksRenderer",
      "esri/renderers/DotDensityRenderer",
      "esri/widgets/Legend",
      "esri/widgets/LayerList",
      "esri/core/promiseUtils",
      "esri/widgets/Expand",
      "esri/PopupTemplate",
      "esri/widgets/Popup",
      "esri/widgets/Search"
    ], function (
      WebMap,
      Accessor,
      ActionButton,	    
      MapView,
      FeatureLayer,
      GroupLayer,
      SimpleFillSymbol,
      SimpleRenderer,
      SimpleMarkerSymbol,
      ClassBreaksRenderer,
      DotDensityRenderer,
      Legend,
      LayerList,
      promiseUtils,
      Expand,
      PopupTemplate,
      Popup,
      Search
    ) {
      
      const map = new WebMap({
        portalItem: {
          id: "3582b744bba84668b52a16b0b6942544"
        }
      });

      const view = new MapView({
        container: "viewDiv",
        zoom: 4,
        center: [-98.554210, 37.813620],
        map: map,
        highlightOptions: {
          fillOpacity: 0,
          color: [50, 50, 50]
        },
        constraints: {
	  minScale: 80000000,
          maxScale: 300
        }
      });
      
      let currentPrecinctID = null;  // Initialize currentPrecinctID
      let currentCountyID = null;
      let currentPrecinctID16 = null;
      let currentCountyID16 = null;
      let currentStateID = null;
      let currentStateID16 = null;
	  let currentPrecinctSwingID = null;
      let currentCountySwingID = null;
      let currentStateSwingID = null;

      let PrecinctLayerView = null;
      let CountyLayerView = null;
      let PrecinctLayerView16 = null;
      let CountyLayerView16 = null;
      let StateLayerView = null;
      let StateLayerView16 = null;
	  let PrecinctSwingLayerView = null;
      let CountySwingLayerView = null;
      let StateSwingLayerView = null;

      view.when().then(function () {
	  
	const stateSwing = new FeatureLayer({
          url: "https://services2.arcgis.com/VNo0ht0YPXJoI4oE/arcgis/rest/services/2020_2016_Election_Final_State_Results/FeatureServer/0",
          minScale: 80000000,
          maxScale: 20000000,
          title: "2016-2020 State Vote Shift",
          outFields: ["*"]
        });

	const countSwing = new FeatureLayer({
          url: "https://services2.arcgis.com/VNo0ht0YPXJoI4oE/arcgis/rest/services/2020_2016_Election_Final_County_Results/FeatureServer/0",
          minScale: 20000000,
          maxScale: 9000000,
          title: "2016-2020 County Vote Shift",
          outFields: ["*"]  
        });

	const precSwing = new FeatureLayer({
          url: "https://services2.arcgis.com/VNo0ht0YPXJoI4oE/arcgis/rest/services/2020_2016_Final_Election_Results_By_Census_Block/FeatureServer/0",
          minScale: 9000000,
          maxScale: 300,
          title: "2016-2020 Census Block Group Vote Shift",
          outFields: ["*"]  
        });

	const swingGroup = new GroupLayer({
          title: "2016-2020 Vote Shift",
          visible: true,
          visibilityMode: "inherited",
          layers: [stateSwing, countSwing, precSwing],
          listMode: "hide-children"
        });

        const stateSwingPCT = new FeatureLayer({
          url: "https://services2.arcgis.com/VNo0ht0YPXJoI4oE/arcgis/rest/services/2020_2016_Election_Final_State_Results/FeatureServer/0",
          minScale: 80000000,
          maxScale: 20000000,
          title: "2016-2020 State % Shift",
          outFields: ["*"]
        });

	const countSwingPCT = new FeatureLayer({
          url: "https://services2.arcgis.com/VNo0ht0YPXJoI4oE/arcgis/rest/services/2020_2016_Election_Final_County_Results/FeatureServer/0",
          minScale: 20000000,
          maxScale: 9000000,
          title: "2016-2020 County % Shift",
          outFields: ["*"]  
        });

	const precSwingPCT = new FeatureLayer({
          url: "https://services2.arcgis.com/VNo0ht0YPXJoI4oE/arcgis/rest/services/2020_2016_Final_Election_Results_By_Census_Block/FeatureServer/0",
          minScale: 9000000,
          maxScale: 300,
          title: "2016-2020 Census Block Group % Shift",
          outFields: ["*"]  
        });

	const pctSwingGroup = new GroupLayer({
          title: "2016-2020 % Shift",
          visible: true,
          visibilityMode: "inherited",
          layers: [stateSwingPCT, countSwingPCT, precSwingPCT],
          listMode: "hide-children"
        });

	const swingGroupLayer = new GroupLayer({
          title: "2016-2020 Shift Layer",
          visible: true,
          visibilityMode: "exclusive",
          layers: [swingGroup, pctSwingGroup],
          listMode: "show"
        });

	const dotLayer162 = new FeatureLayer({
          url: "https://services2.arcgis.com/VNo0ht0YPXJoI4oE/arcgis/rest/services/2020_2016_Final_Election_Results_By_Census_Block/FeatureServer/0",
          minScale: 80000000,
          maxScale: 300,
          title: "Dot Density Legend",
          outFields: ["*"]  // Removed Precinct_Name
        }); 

	const stateColLayer163 = new FeatureLayer({
          url: "https://services2.arcgis.com/VNo0ht0YPXJoI4oE/arcgis/rest/services/2020_2016_Election_Final_State_Results/FeatureServer/0",
          minScale: 80000000,
          maxScale: 20000000,
          title: "US Presidential Election Results by State",
          outFields: ["*"]
        });

	const countColLayer163 = new FeatureLayer({
          url: "https://services2.arcgis.com/VNo0ht0YPXJoI4oE/arcgis/rest/services/2020_2016_Election_Final_County_Results/FeatureServer/0",
          minScale: 20000000,
          maxScale: 2500000,
          title: "US Presidential Election Results by County",
          outFields: ["*"]  
        });

	const precColLayer163 = new FeatureLayer({
          url: "https://services2.arcgis.com/VNo0ht0YPXJoI4oE/arcgis/rest/services/2020_2016_Final_Election_Results_By_Census_Block/FeatureServer/0",
          minScale: 2500000,
          maxScale: 300,
          title: "US Presidential Election Results by Census Block Group",
          outFields: ["*"]  
        });

        const dotcolGroupLayer16 = new GroupLayer({
          title: "2016",
          visible: true,
          visibilityMode: "inherited",
          layers: [stateColLayer163, countColLayer163, precColLayer163, dotLayer162],
          listMode: "hide-children"
        });

	const dotLayer2 = new FeatureLayer({
          url: "https://services2.arcgis.com/VNo0ht0YPXJoI4oE/arcgis/rest/services/2020_2016_Final_Election_Results_By_Census_Block/FeatureServer/0",
          minScale: 80000000,
          maxScale: 300,
          title: "Dot Density Legend",
          outFields: ["*"]  // Removed Precinct_Name
        });

	const stateColLayer3 = new FeatureLayer({
          url: "https://services2.arcgis.com/VNo0ht0YPXJoI4oE/arcgis/rest/services/2020_2016_Election_Final_State_Results/FeatureServer/0",
          minScale: 80000000,
          maxScale: 20000000,
          title: "US Presidential Election Results by State",
          outFields: ["*"]
        });

	const countColLayer3 = new FeatureLayer({
          url: "https://services2.arcgis.com/VNo0ht0YPXJoI4oE/arcgis/rest/services/2020_2016_Election_Final_County_Results/FeatureServer/0",
          minScale: 20000000,
          maxScale: 2500000,
          title: "US Presidential Election Results by County",
          outFields: ["*"]  
        });

	const precColLayer3 = new FeatureLayer({
          url: "https://services2.arcgis.com/VNo0ht0YPXJoI4oE/arcgis/rest/services/2020_2016_Final_Election_Results_By_Census_Block/FeatureServer/0",
          minScale: 2500000,
          maxScale: 300,
          title: "US Presidential Election Results by Census Block Group",
          outFields: ["*"]  
        });

	const dotcolGroupLayer = new GroupLayer({
          title: "2020",
          visible: true,
          visibilityMode: "inherited",
          layers: [stateColLayer3, countColLayer3, precColLayer3, dotLayer2],
          listMode: "hide-children"
        });

	const dotcolallGroupLayer = new GroupLayer({
          title: "Choropleth + Dot Density Layer",
          visible: false,
          visibilityMode: "exclusive",
          layers: [dotcolGroupLayer16, dotcolGroupLayer],
          listMode: "show"
        }); 

	const dotLayer16 = new FeatureLayer({
          url: "https://services2.arcgis.com/VNo0ht0YPXJoI4oE/arcgis/rest/services/2020_2016_Final_Election_Results_By_Census_Block/FeatureServer/0",
          minScale: 80000000,
          maxScale: 300,
          title: "2016",
          outFields: ["*"]  // Removed Precinct_Name
        }); 

	const dotLayer = new FeatureLayer({
          url: "https://services2.arcgis.com/VNo0ht0YPXJoI4oE/arcgis/rest/services/2020_2016_Final_Election_Results_By_Census_Block/FeatureServer/0",
          minScale: 80000000,
          maxScale: 300,
          title: "2020",
          outFields: ["*"]  // Removed Precinct_Name
        });

	const dotGroupLayer = new GroupLayer({
          title: "Dot Density Layer",
          visible: false,
          visibilityMode: "exclusive",
          layers: [dotLayer16, dotLayer],
          listMode: "show"
        });        

        const bubbleStateLayer162 = new FeatureLayer({
          url: "https://services2.arcgis.com/VNo0ht0YPXJoI4oE/arcgis/rest/services/2020_2016_Election_Final_State_Results/FeatureServer/0",
          minScale: 80000000,
          maxScale: 20000000,
          title: "Net Vote Margin by State",
          outFields: ["*"]
        });
       
	const bubbleCountyLayer162 = new FeatureLayer({
          url: "https://services2.arcgis.com/VNo0ht0YPXJoI4oE/arcgis/rest/services/2020_2016_Election_Final_County_Results/FeatureServer/0",
          minScale: 20000000,
          maxScale: 2500000,
          title: "Net Vote Margin by County",
          outFields: ["*"]
        }); 

        const bubblePrecinctLayer162 = new FeatureLayer({
          url: "https://services2.arcgis.com/VNo0ht0YPXJoI4oE/arcgis/rest/services/2020_2016_Final_Election_Results_By_Census_Block/FeatureServer/0",
          minScale: 2500000,
          maxScale: 300,
          title: "Net Vote Margin by Census Block Group",
          outFields: ["*"]
        });

	const stateColLayer162 = new FeatureLayer({
          url: "https://services2.arcgis.com/VNo0ht0YPXJoI4oE/arcgis/rest/services/2020_2016_Election_Final_State_Results/FeatureServer/0",
          minScale: 80000000,
          maxScale: 20000000,
          title: "US Presidential Election Results by State",
          outFields: ["*"]
        });

	const countColLayer162 = new FeatureLayer({
          url: "https://services2.arcgis.com/VNo0ht0YPXJoI4oE/arcgis/rest/services/2020_2016_Election_Final_County_Results/FeatureServer/0",
          minScale: 20000000,
          maxScale: 2500000,
          title: "US Presidential Election Results by County",
          outFields: ["*"]  
        });

	const precColLayer162 = new FeatureLayer({
          url: "https://services2.arcgis.com/VNo0ht0YPXJoI4oE/arcgis/rest/services/2020_2016_Final_Election_Results_By_Census_Block/FeatureServer/0",
          minScale: 2500000,
          maxScale: 300,
          title: "US Presidential Election Results by Census Block Group",
          outFields: ["*"]  
        });

	const colbubGroupLayer16 = new GroupLayer({
          title: "2016",
          visible: true,
          visibilityMode: "inherited",
          layers: [stateColLayer162, bubbleStateLayer162, countColLayer162, bubbleCountyLayer162, precColLayer162, bubblePrecinctLayer162],
          listMode: "hide-children"
        });      
	      
        const bubbleStateLayer2 = new FeatureLayer({
          url: "https://services2.arcgis.com/VNo0ht0YPXJoI4oE/arcgis/rest/services/2020_2016_Election_Final_State_Results/FeatureServer/0",
          minScale: 80000000,
          maxScale: 20000000,
          title: "Net Vote Margin by State",
          outFields: ["*"]
        });

	const bubbleCountyLayer2 = new FeatureLayer({
          url: "https://services2.arcgis.com/VNo0ht0YPXJoI4oE/arcgis/rest/services/2020_2016_Election_Final_County_Results/FeatureServer/0",
          minScale: 20000000,
          maxScale: 2500000,
          title: "Net Vote Margin by County",
          outFields: ["*"]
        }); 

        const bubblePrecinctLayer2 = new FeatureLayer({
          url: "https://services2.arcgis.com/VNo0ht0YPXJoI4oE/arcgis/rest/services/2020_2016_Final_Election_Results_By_Census_Block/FeatureServer/0",
          minScale: 2500000,
          maxScale: 300,
          title: "Net Vote Margin by Census Block Group",
          outFields: ["*"]
        });

	const stateColLayer2 = new FeatureLayer({
          url: "https://services2.arcgis.com/VNo0ht0YPXJoI4oE/arcgis/rest/services/2020_2016_Election_Final_State_Results/FeatureServer/0",
          minScale: 80000000,
          maxScale: 20000000,
          title: "US Presidential Election Results by State",
          outFields: ["*"]
        });

	const countColLayer2 = new FeatureLayer({
          url: "https://services2.arcgis.com/VNo0ht0YPXJoI4oE/arcgis/rest/services/2020_2016_Election_Final_County_Results/FeatureServer/0",
          minScale: 20000000,
          maxScale: 2500000,
          title: "US Presidential Election Results by County",
          outFields: ["*"]  
        });

	const precColLayer2 = new FeatureLayer({
          url: "https://services2.arcgis.com/VNo0ht0YPXJoI4oE/arcgis/rest/services/2020_2016_Final_Election_Results_By_Census_Block/FeatureServer/0",
          minScale: 2500000,
          maxScale: 300,
          title: "US Presidential Election Results by Census Block Group",
          outFields: ["*"]  
        });
	
	const colbubGroupLayer = new GroupLayer({
          title: "2020",
          visible: true,
          visibilityMode: "inherited",
          layers: [stateColLayer2, bubbleStateLayer2, countColLayer2, bubbleCountyLayer2, precColLayer2, bubblePrecinctLayer2],
          listMode: "hide-children"
        });

	const colbuballGroupLayer = new GroupLayer({
          title: "Choropleth + Bubble Layer",
          visible: true,
          visibilityMode: "exclusive",
          layers: [colbubGroupLayer16, colbubGroupLayer],
          listMode: "show"
        });      
	      
        const bubbleStateLayer16 = new FeatureLayer({
          url: "https://services2.arcgis.com/VNo0ht0YPXJoI4oE/arcgis/rest/services/2020_2016_Election_Final_State_Results/FeatureServer/0",
          minScale: 80000000,
          maxScale: 20000000,
          title: "Net Vote Margin by State",
          outFields: ["*"]
        });
       
	const bubbleCountyLayer16 = new FeatureLayer({
          url: "https://services2.arcgis.com/VNo0ht0YPXJoI4oE/arcgis/rest/services/2020_2016_Election_Final_County_Results/FeatureServer/0",
          minScale: 20000000,
          maxScale: 2500000,
          title: "Net Vote Margin by County",
          outFields: ["*"]
        }); 

        const bubblePrecinctLayer16 = new FeatureLayer({
          url: "https://services2.arcgis.com/VNo0ht0YPXJoI4oE/arcgis/rest/services/2020_2016_Final_Election_Results_By_Census_Block/FeatureServer/0",
          minScale: 2500000,
          maxScale: 300,
          title: "Net Vote Margin by Census Block Group",
          outFields: ["*"]
        });
	
	const bubbleGroupLayer16 = new GroupLayer({
          title: "2016",
          visible: true,
          visibilityMode: "inherited",
          layers: [bubbleStateLayer16, bubbleCountyLayer16, bubblePrecinctLayer16],
          listMode: "hide-children"
        });
        
        const bubbleStateLayer = new FeatureLayer({
          url: "https://services2.arcgis.com/VNo0ht0YPXJoI4oE/arcgis/rest/services/2020_2016_Election_Final_State_Results/FeatureServer/0",
          minScale: 80000000,
          maxScale: 20000000,
          title: "Net Vote Margin by State",
          outFields: ["*"]
        });

	const bubbleCountyLayer = new FeatureLayer({
          url: "https://services2.arcgis.com/VNo0ht0YPXJoI4oE/arcgis/rest/services/2020_2016_Election_Final_County_Results/FeatureServer/0",
          minScale: 20000000,
          maxScale: 2500000,
          title: "Net Vote Margin by County",
          outFields: ["*"]
        }); 

        const bubblePrecinctLayer = new FeatureLayer({
          url: "https://services2.arcgis.com/VNo0ht0YPXJoI4oE/arcgis/rest/services/2020_2016_Final_Election_Results_By_Census_Block/FeatureServer/0",
          minScale: 2500000,
          maxScale: 300,
          title: "Net Vote Margin by Census Block Group",
          outFields: ["*"]
        });
	
	const bubbleGroupLayer = new GroupLayer({
          title: "2020",
          visible: true,
          visibilityMode: "inherited",
          layers: [bubbleStateLayer, bubbleCountyLayer, bubblePrecinctLayer],
          listMode: "hide-children"
        });

	const bubGroupLayer = new GroupLayer({
          title: "Bubble Layer",
          visible: false,
          visibilityMode: "exclusive",
          layers: [bubbleGroupLayer16, bubbleGroupLayer],
          listMode: "show"
        });

        const stateColLayer16 = new FeatureLayer({
          url: "https://services2.arcgis.com/VNo0ht0YPXJoI4oE/arcgis/rest/services/2020_2016_Election_Final_State_Results/FeatureServer/0",
          minScale: 80000000,
          maxScale: 20000000,
          title: "2016 US Presidential Election Results by State",
          outFields: ["*"]
        });

	const countColLayer16 = new FeatureLayer({
          url: "https://services2.arcgis.com/VNo0ht0YPXJoI4oE/arcgis/rest/services/2020_2016_Election_Final_County_Results/FeatureServer/0",
          minScale: 20000000,
          maxScale: 9000000,
          title: "2016 US Presidential Election Results by County",
          outFields: ["*"]  
        });

	const precColLayer16 = new FeatureLayer({
          url: "https://services2.arcgis.com/VNo0ht0YPXJoI4oE/arcgis/rest/services/2020_2016_Final_Election_Results_By_Census_Block/FeatureServer/0",
          minScale: 9000000,
          maxScale: 300,
          title: "2016 US Presidential Election Results by Census Block Group",
          outFields: ["*"]  
        });

	const colGroupLayer16 = new GroupLayer({
          title: "2016",
          visible: true,
          visibilityMode: "inherited",
          layers: [stateColLayer16, countColLayer16, precColLayer16],
          listMode: "hide-children"
        });

        const stateColLayer = new FeatureLayer({
          url: "https://services2.arcgis.com/VNo0ht0YPXJoI4oE/arcgis/rest/services/2020_2016_Election_Final_State_Results/FeatureServer/0",
          minScale: 80000000,
          maxScale: 20000000,
          title: "2020 US Presidential Election Results by State",
          outFields: ["*"]
        });

	const countColLayer = new FeatureLayer({
          url: "https://services2.arcgis.com/VNo0ht0YPXJoI4oE/arcgis/rest/services/2020_2016_Election_Final_County_Results/FeatureServer/0",
          minScale: 20000000,
          maxScale: 9000000,
          title: "2020 US Presidential Election Results by County",
          outFields: ["*"]  
        });

	const precColLayer = new FeatureLayer({
          url: "https://services2.arcgis.com/VNo0ht0YPXJoI4oE/arcgis/rest/services/2020_2016_Final_Election_Results_By_Census_Block/FeatureServer/0",
          minScale: 9000000,
          maxScale: 300,
          title: "2020 US Presidential Election Results by Census Block Group",
          outFields: ["*"]  
        });
	
	const colGroupLayer = new GroupLayer({
          title: "2020",
          visible: true,
          visibilityMode: "inherited",
          layers: [stateColLayer, countColLayer, precColLayer],
          listMode: "hide-children"
        });

	const chorGroupLayer = new GroupLayer({
          title: "Choropleth Layer",
          visible: true,
          visibilityMode: "exclusive",
          layers: [colGroupLayer16, colGroupLayer],
          listMode: "show"
        });

	const mastGroupLayer = new GroupLayer({
          title: "Layers",
          visible: true,
          visibilityMode: "exclusive",
          layers: [swingGroupLayer, dotcolallGroupLayer, dotGroupLayer, colbuballGroupLayer, bubGroupLayer, chorGroupLayer],
          listMode: "show"
        });
	
	map.add(mastGroupLayer);
	
	const stateLayer16 = new FeatureLayer({
          url: "https://services2.arcgis.com/VNo0ht0YPXJoI4oE/arcgis/rest/services/2020_2016_Election_Final_State_Results/FeatureServer/0",
         minScale: 80000000,
         maxScale: 20000000,
         legendEnabled: false,
         listMode: "hide", 
         title: "",
         outFields: ["*"]
       });
	
	const countyLayer16 = new FeatureLayer({
          url: "https://services2.arcgis.com/VNo0ht0YPXJoI4oE/arcgis/rest/services/2020_2016_Election_Final_County_Results/FeatureServer/0",
          minScale: 20000000,
          maxScale: 4500000,
          legendEnabled: false,
	  listMode: "hide",
          title: "",
          outFields: ["*"]
        });

	const precinctLayer16 = new FeatureLayer({
          url: "https://services2.arcgis.com/VNo0ht0YPXJoI4oE/arcgis/rest/services/2020_2016_Final_Election_Results_By_Census_Block/FeatureServer/0",
          minScale: 4500000,
          maxScale: 300,
	  legendEnabled: false,
	  listMode: "hide",
          title: "",
          outFields: ["*"]  
        });

	const high16 = new GroupLayer({
	  title: "2016",
          visible: true,
          visibilityMode: "inherited",
          layers: [stateLayer16, precinctLayer16, countyLayer16],
          listMode: "hide"
	});
	
	const stateLayer = new FeatureLayer({
          url: "https://services2.arcgis.com/VNo0ht0YPXJoI4oE/arcgis/rest/services/2020_2016_Election_Final_State_Results/FeatureServer/0",
         minScale: 80000000,
         maxScale: 20000000,
         legendEnabled: false,
         listMode: "hide",
         title: "",
         outFields: ["*"]
       });

	const countyLayer = new FeatureLayer({
          url: "https://services2.arcgis.com/VNo0ht0YPXJoI4oE/arcgis/rest/services/2020_2016_Election_Final_County_Results/FeatureServer/0",
          minScale: 20000000,
          maxScale: 4500000,
          legendEnabled: false,
	  listMode: "hide",
          title: "",
          outFields: ["*"]
        });
	
	const precinctLayer = new FeatureLayer({
          url: "https://services2.arcgis.com/VNo0ht0YPXJoI4oE/arcgis/rest/services/2020_2016_Final_Election_Results_By_Census_Block/FeatureServer/0",
          minScale: 4500000,
          maxScale: 300,
	  legendEnabled: false,
	  listMode: "hide",
          title: "",
          outFields: ["*"]  
        });

	const high20 = new GroupLayer({
	  title: "2020",
          visible: true,
          visibilityMode: "inherited",
          layers: [stateLayer, precinctLayer, countyLayer],
          listMode: "hide"
	});

    const stateSwingLayer = new FeatureLayer({
          url: "https://services2.arcgis.com/VNo0ht0YPXJoI4oE/arcgis/rest/services/2020_2016_Election_Final_State_Results/FeatureServer/0",
         minScale: 80000000,
         maxScale: 20000000,
         legendEnabled: false,
         listMode: "hide",
         title: "",
         outFields: ["*"]
       });

	const countySwingLayer = new FeatureLayer({
          url: "https://services2.arcgis.com/VNo0ht0YPXJoI4oE/arcgis/rest/services/2020_2016_Election_Final_County_Results/FeatureServer/0",
          minScale: 20000000,
          maxScale: 4500000,
          legendEnabled: false,
	  listMode: "hide",
          title: "",
          outFields: ["*"]
        });
	
	const precinctSwingLayer = new FeatureLayer({
          url: "https://services2.arcgis.com/VNo0ht0YPXJoI4oE/arcgis/rest/services/2020_2016_Final_Election_Results_By_Census_Block/FeatureServer/0",
          minScale: 4500000,
          maxScale: 300,
	  legendEnabled: false,
	  listMode: "hide",
          title: "",
          outFields: ["*"]  
        });

	const highSwing = new GroupLayer({
	  title: "Swing",
          visible: true,
          visibilityMode: "inherited",
          layers: [stateSwingLayer, precinctSwingLayer, countySwingLayer],
          listMode: "hide"
	});

	const masthigh = new GroupLayer({
	  title: "Pop-Up Layers",
	  visible: true,
	  visibilityMode: "exclusive",
	  layers: [highSwing, high16, high20],
	  listMode: "hide"
	});

	map.add(masthigh);

	view.whenLayerView(stateLayer16).then(function(layerView) {
	   StateLayerView16 = layerView;
        });

	view.whenLayerView(countyLayer16).then(function (layerView) {
           CountyLayerView16 = layerView;
        });

	view.whenLayerView(precinctLayer16).then(function (layerView) {
           PrecinctLayerView16 = layerView;
        });
        
	view.whenLayerView(stateLayer).then(function(layerView) {
	   StateLayerView = layerView;
	});

	view.whenLayerView(countyLayer).then(function (layerView) {
           CountyLayerView = layerView;
        });

	view.whenLayerView(precinctLayer).then(function (layerView) {
           PrecinctLayerView = layerView;
        });
		
	view.whenLayerView(stateSwingLayer).then(function(layerView) {
	   StateSwingLayerView = layerView;
	});

	view.whenLayerView(countySwingLayer).then(function (layerView) {
           CountySwingLayerView = layerView;
        });

	view.whenLayerView(precinctSwingLayer).then(function (layerView) {
           PrecinctSwingLayerView = layerView;
        });

	view.ui.add(
         [
           new Expand({
             view: view,
	     expandTooltip: "Layers",
             content: new LayerList({ view: view, listItemCreatedFunction: defineActions }),
             group: "bottom-right",
             expanded: true
           })
         ],
         "bottom-right"
       );

    function defineActions(event) {
      const item = event.item;

      if (item.layer.type === "group") {
        item.open = true;
      }

    item.layer.watch("visible", function(newValue, oldValue, property, object) {
        // Logic for individual layers within the group layers
        updateHighlightLayer(item.layer);
      });
    }

    // A function to update the highlight layer based on the selected year in the main group layer
    function updateHighlightLayer(layer) {
      if (layer === colGroupLayer16 && chorGroupLayer.visible) {
        high16.visible = true;
        high20.visible = false;
	highSwing.visible = false;
      } else if (layer === colGroupLayer && chorGroupLayer.visible) {
        high20.visible = true;
        high16.visible = false;
	highSwing.visible = false;
      } else if (layer === dotLayer16 && dotGroupLayer.visible) {
        high16.visible = true;
        high20.visible = false;
	highSwing.visible = false;
      } else if (layer === dotLayer && dotGroupLayer.visible) {
        high20.visible = true;
        high16.visible = false;
	highSwing.visible = false;
      } else if (layer === colbubGroupLayer16 && colbuballGroupLayer.visible) {
        high16.visible = true;
        high20.visible = false;
	highSwing.visible = false;
      } else if (layer === colbubGroupLayer && colbuballGroupLayer.visible) {
        high20.visible = true;
        high16.visible = false;
	highSwing.visible = false;
      } else if (layer === bubbleGroupLayer16 && bubGroupLayer.visible) {
        high16.visible = true;
        high20.visible = false;
	highSwing.visible = false;
      } else if (layer === bubbleGroupLayer && bubGroupLayer.visible) {
        high20.visible = true;
        high16.visible = false;
	highSwing.visible = false;
      } else if (layer === pctSwingGroup && swingGroupLayer.visible) {
        high20.visible = false;
        high16.visible = false;
	highSwing.visible = true;
      } else if (layer === swingGroup && swingGroupLayer.visible) {
        high16.visible = false;
        high20.visible = false;
	highSwing.visible = true;
      } else if (layer === dotcolGroupLayer && dotcolallGroupLayer.visible) {
	high20.visible = true;
	high16.visible = false;
	highSwing.visible = false;
      } else if (layer === dotcolGroupLayer16 && dotcolallGroupLayer.visible) {
	high16.visible = true;
	high20.visible = false;
	highSwing.visible = false;
      }
    }

    // Watch the visibility property of the main group layers
    [swingGroupLayer, chorGroupLayer, dotcolallGroupLayer, dotGroupLayer, colbuballGroupLayer, bubGroupLayer].forEach(groupLayer => {
      groupLayer.watch("visible", function(newValue, oldValue, property, object) {
        if (newValue === true) {
            // When a main group layer becomes visible, check its child layers and update the highlight layer
            groupLayer.layers.forEach(childLayer => {
                if (childLayer.visible) {
                    updateHighlightLayer(childLayer);
                }
            });
        }
      });
    });


        // Highlight layers renderer
		const stateSwingRenderer = new SimpleRenderer({
             //type: "simple",
             symbol: {
               type: "simple-fill",
               style: "none",
               outline: null
             }
          }); 

	const countSwingRenderer = new SimpleRenderer({
             //type: "simple",
             symbol: {
               type: "simple-fill",
               style: "none",
               outline: null
             }
          }); 

	const precSwingRenderer = new SimpleRenderer({
             //type: "simple",
             symbol: {
               type: "simple-fill",
               style: "none",
               outline: null
             }
          }); 
		
        const stateRenderer16 = new SimpleRenderer({
             //type: "simple",
             symbol: {
               type: "simple-fill",
               style: "none",
               outline: null
             }
          }); 
    
	  const countRenderer16 = new SimpleRenderer({
              //type: "simple",
              symbol: {
                type: "simple-fill",
                style: "none",
                outline: null
              }
          }); 

	  const precRenderer16 = new SimpleRenderer({
              //type: "simple",
              symbol: {
                type: "simple-fill",
                style: "none",
                outline: null
              }
          }); 

	  const voteMarginSymbol16 = new SimpleMarkerSymbol({
            outline: {
              color: "rgba(0, 0, 0, 0)",
              width: 0
            }
          });        

	  // Bubble Renderer
	const stateBubbleRenderer16 = new SimpleRenderer({
              symbol: voteMarginSymbol16,
              visualVariables: [
                {
                  type: "size",
                  field: "CLI_TRU",
                  stops: [
                    { value: 2000, size: 3 },
		    { value: 500000, size: 20 },
		    { value: 5500000, size: 76 },
                    { value: -2000, size: 3 },
		    { value: -500000, size: 20 },
		    { value: -5500000, size: 76 },
                  ],
                  legendOptions: {
                    title: "Number of Clinton (D) Votes minus Number of Trump (R) Votes"
                  }
                },
                {
                  type: "color",
                  field: "CLI_TRU",
                  legendOptions: {
                    showLegend: false
                  },
                  stops: [
                    { value: -1, color: [204, 10, 18, 0.60] },
                    { value: 1, color: [37, 66, 143, 0.60] }
                  ]
                }
              ]
            });

	 
	  const countyBubbleRenderer16 = new SimpleRenderer({
              symbol: voteMarginSymbol16,
              visualVariables: [
                {
                  type: "size",
                  field: "CLI_TRU",
                  stops: [
                    { value: 1, size: 1 },
		    { value: 100000, size: 23 },
		    { value: 2000000, size: 92 },
                    { value: -1, size: 1 },
		    { value: -100000, size: 23 },
		    { value: -2000000, size: 92 },
                  ],
                  legendOptions: {
                    title: "Number of Clinton (D) Votes minus Number of Trump (R) Votes"
                  }
                },
                {
                  type: "color",
                  field: "CLI_TRU",
                  legendOptions: {
                    showLegend: false
                  },
                  stops: [
                    { value: -1, color: [204, 10, 18, 0.60] },
                    { value: 1, color: [37, 66, 143, 0.60] }
                  ]
                }
              ]
            });

            const precinctBubbleRenderer16 = new SimpleRenderer({
              symbol: voteMarginSymbol16,
              visualVariables: [
                {
                  type: "size",
                  field: "CLI_TRU",
                  stops: [
                    { value: 1, size: 1 },
                    { value: 400, size: 10 },
                    { value: 7000, size: 20 },
                    { value: -1, size: 1 },
                    { value: -400, size: 10 },
                    { value: -7000, size: 20 },
                  ],
                  legendOptions: {
                    title: "Number of Clinton (D) Votes minus Number of Trump (R) Votes"
                  }
                },
                {
                  type: "color",
                  field: "CLI_TRU",
                  legendOptions: {
                    showLegend: false
                  },
                  stops: [
                    { value: -1, color: [204, 10, 18, 0.35] },
                    { value: 1, color: [37, 66, 143, 0.35] }
                  ]
                }
              ]
            });

	    // Dot density renderer
	    const dotDensityRenderer16 = new DotDensityRenderer({
              dotValue: 1,
	      dotSize: 0.5,
              outline: null,
              dotBlendingEnabled: true,
              referenceScale: 100000,
              legendOptions: {
                unit: "Vote(s)"
              },
              attributes: [
                {
                  field: "G16PREDCLI",
                  color: "#00b6f1",
                  label: "Clinton (D)"
                },
                {
                  field: "G16PRERTRU",
                  color: "#f23c3f",
                  label: "Trump (R)"
                }, 
                {
                  field: "TotOth16",
                  color: "#bf00ff",
                  label: "Other"
	        }
              ]
            });

	    // Class breaks renderer
		const stateSwingPCTRenderer = new ClassBreaksRenderer({
                    valueExpression: `
                      var biden_pct = $feature.pctbi;
                      var trump20_pct = $feature.pcttr20;
                      var clinton_pct = $feature.pctcl;
                      var trump16_pct = $feature.pcttr16;
                      var total_votes16 = $feature.Tot_16;
                      var total_votes20 = $feature.Tot_20;		
					  var difference = $feature.PCTDIF;
                      if (total_votes16 == 0 && total_votes20 == 0) {
                        return 100002;  // For no votes
                    } else if (difference == 0) {
                        return -100002;  // For no difference
                    } else {
                        return difference;
                    }
                    `,
                    classBreakInfos: [
                        { minValue: 100002, maxValue: 100002, label: "No Votes", symbol: { type: "simple-fill", color: [215, 219, 221, 0.6], outline: null }},
                        { minValue: -200, maxValue: -50, label: "Over 50% More Republican", symbol: { type: "simple-fill", color: [213, 25, 25, 0.6], outline: null }},
                        { minValue: -50, maxValue: -45, label: "≤50% More Republican", symbol: { type: "simple-fill", color: [229, 33, 33, 0.6], outline: null }},
                        { minValue: -45, maxValue: -40, label: "≤45% More Republican", symbol: { type: "simple-fill", color: [232, 55, 55, 0.6], outline: null }},
                        { minValue: -40, maxValue: -35, label: "≤40% More Republican", symbol: { type: "simple-fill", color: [235, 77, 77, 0.6], outline: null }},
                        { minValue: -35, maxValue: -30, label: "≤35% More Republican", symbol: { type: "simple-fill", color: [237, 100, 100, 0.6], outline: null }},
                        { minValue: -30, maxValue: -25, label: "≤30% More Republican", symbol: { type: "simple-fill", color: [240, 122, 122, 0.6], outline: null }},
                        { minValue: -25, maxValue: -20, label: "≤25% More Republican", symbol: { type: "simple-fill", color: [242, 144, 144, 0.6], outline: null }},
                        { minValue: -20, maxValue: -15, label: "≤20% More Republican", symbol: { type: "simple-fill", color: [245, 166, 166, 0.6], outline: null }},
                        { minValue: -15, maxValue: -10, label: "≤15% More Republican", symbol: { type: "simple-fill", color: [247, 188, 188, 0.6], outline: null }},
                        { minValue: -10, maxValue: -5, label: "≤10% More Republican", symbol: { type: "simple-fill", color: [250, 211, 211, 0.6], outline: null }},
                        { minValue: -5, maxValue: 0, label: "≤5% More Republican", symbol: { type: "simple-fill", color: [252, 233, 233, 0.6], outline: null }},
                        { minValue: -100002, maxValue: -100002, label: "No Change", symbol: { type: "simple-fill", color: [255, 255, 255, 0.6], outline: null }},
                        { minValue: 0, maxValue: 5, label: "≤5% More Democratic", symbol: { type: "simple-fill", color: [222, 238, 250, 0.6], outline: null }},
                        { minValue: 5, maxValue: 10, label: "≤10% More Democratic", symbol: { type: "simple-fill", color: [190, 220, 245, 0.6], outline: null }},
                        { minValue: 10, maxValue: 15, label: "≤15% More Democratic", symbol: { type: "simple-fill", color: [157, 203, 241, 0.6], outline: null }},
                        { minValue: 15, maxValue: 20, label: "≤20% More Democratic", symbol: { type: "simple-fill", color: [125, 185, 236, 0.6], outline: null }},
                        { minValue: 20, maxValue: 25, label: "≤25% More Democratic", symbol: { type: "simple-fill", color: [92, 168, 231, 0.6], outline: null }},
                        { minValue: 25, maxValue: 30, label: "≤30% More Democratic", symbol: { type: "simple-fill", color: [60, 150, 226, 0.6], outline: null }},
                        { minValue: 30, maxValue: 35, label: "≤35% More Democratic", symbol: { type: "simple-fill", color: [32, 132, 217, 0.6], outline: null }},
                        { minValue: 35, maxValue: 40, label: "≤40% More Democratic", symbol: { type: "simple-fill", color: [27, 112, 184, 0.6], outline: null }},
                        { minValue: 40, maxValue: 45, label: "≤45% More Democratic", symbol: { type: "simple-fill", color: [22, 93, 152, 0.6], outline: null }},
                        { minValue: 45, maxValue: 50, label: "≤50% More Democratic", symbol: { type: "simple-fill", color: [18, 73, 119, 0.6], outline: null }},
                        { minValue: 50, maxValue: 200, label: "Over 50% More Democratic", symbol: { type: "simple-fill", color: [13, 53, 87, 0.6], outline: null }},
                    ]
                });

                const countSwingPCTRenderer = new ClassBreaksRenderer({
                    valueExpression: `
                      var biden_pct = $feature.pctbi;
                      var trump20_pct = $feature.pcttr20;
                      var clinton_pct = $feature.pctcl;
                      var trump16_pct = $feature.pcttr16;
                      var total_votes16 = $feature.total_vo_1;
                      var total_votes20 = $feature.total_vote;
					  var difference = $feature.PCTDIF;
                      if (total_votes16 == 0 && total_votes20 == 0) {
                        return 100002;  // For no votes
                    } else if (difference == 0) {
                        return -100002;  // For no difference
                    } else {
                        return difference;
                    }
                    `,
                    classBreakInfos: [
                        { minValue: 100002, maxValue: 100002, label: "No Votes", symbol: { type: "simple-fill", color: [215, 219, 221, 0.6], outline: null }},
                        { minValue: -200, maxValue: -50, label: "Over 50% More Republican", symbol: { type: "simple-fill", color: [213, 25, 25, 0.6], outline: null }},
                        { minValue: -50, maxValue: -45, label: "≤50% More Republican", symbol: { type: "simple-fill", color: [229, 33, 33, 0.6], outline: null }},
                        { minValue: -45, maxValue: -40, label: "≤45% More Republican", symbol: { type: "simple-fill", color: [232, 55, 55, 0.6], outline: null }},
                        { minValue: -40, maxValue: -35, label: "≤40% More Republican", symbol: { type: "simple-fill", color: [235, 77, 77, 0.6], outline: null }},
                        { minValue: -35, maxValue: -30, label: "≤35% More Republican", symbol: { type: "simple-fill", color: [237, 100, 100, 0.6], outline: null }},
                        { minValue: -30, maxValue: -25, label: "≤30% More Republican", symbol: { type: "simple-fill", color: [240, 122, 122, 0.6], outline: null }},
                        { minValue: -25, maxValue: -20, label: "≤25% More Republican", symbol: { type: "simple-fill", color: [242, 144, 144, 0.6], outline: null }},
                        { minValue: -20, maxValue: -15, label: "≤20% More Republican", symbol: { type: "simple-fill", color: [245, 166, 166, 0.6], outline: null }},
                        { minValue: -15, maxValue: -10, label: "≤15% More Republican", symbol: { type: "simple-fill", color: [247, 188, 188, 0.6], outline: null }},
                        { minValue: -10, maxValue: -5, label: "≤10% More Republican", symbol: { type: "simple-fill", color: [250, 211, 211, 0.6], outline: null }},
                        { minValue: -5, maxValue: 0, label: "≤5% More Republican", symbol: { type: "simple-fill", color: [252, 233, 233, 0.6], outline: null }},
                        { minValue: -100002, maxValue: -100002, label: "No Change", symbol: { type: "simple-fill", color: [255, 255, 255, 0.6], outline: null }},
                        { minValue: 0, maxValue: 5, label: "≤5% More Democratic", symbol: { type: "simple-fill", color: [222, 238, 250, 0.6], outline: null }},
                        { minValue: 5, maxValue: 10, label: "≤10% More Democratic", symbol: { type: "simple-fill", color: [190, 220, 245, 0.6], outline: null }},
                        { minValue: 10, maxValue: 15, label: "≤15% More Democratic", symbol: { type: "simple-fill", color: [157, 203, 241, 0.6], outline: null }},
                        { minValue: 15, maxValue: 20, label: "≤20% More Democratic", symbol: { type: "simple-fill", color: [125, 185, 236, 0.6], outline: null }},
                        { minValue: 20, maxValue: 25, label: "≤25% More Democratic", symbol: { type: "simple-fill", color: [92, 168, 231, 0.6], outline: null }},
                        { minValue: 25, maxValue: 30, label: "≤30% More Democratic", symbol: { type: "simple-fill", color: [60, 150, 226, 0.6], outline: null }},
                        { minValue: 30, maxValue: 35, label: "≤35% More Democratic", symbol: { type: "simple-fill", color: [32, 132, 217, 0.6], outline: null }},
                        { minValue: 35, maxValue: 40, label: "≤40% More Democratic", symbol: { type: "simple-fill", color: [27, 112, 184, 0.6], outline: null }},
                        { minValue: 40, maxValue: 45, label: "≤45% More Democratic", symbol: { type: "simple-fill", color: [22, 93, 152, 0.6], outline: null }},
                        { minValue: 45, maxValue: 50, label: "≤50% More Democratic", symbol: { type: "simple-fill", color: [18, 73, 119, 0.6], outline: null }},
                        { minValue: 50, maxValue: 200, label: "Over 50% More Democratic", symbol: { type: "simple-fill", color: [13, 53, 87, 0.6], outline: null }},
                    ]
                });
                const precSwingPCTRenderer = new ClassBreaksRenderer({
                    valueExpression: `
                      var biden_pct = $feature.PCTBID;
                      var trump20_pct = $feature.PCTTRU20;
                      var clinton_pct = $feature.PCTCLI;
                      var trump16_pct = $feature.PCTTRU16;
                      var total_votes16 = $feature.TotVote16;
                      var total_votes20 = $feature.TotVote20;
					  var difference = $feature.PCTDIF;
                      if (total_votes16 == 0 && total_votes20 == 0) {
                        return 100002;  // For no votes
                    } else if (difference == 0) {
                        return -100002;  // For no difference
                    } else {
                        return difference;
                    }
                    `,
                    classBreakInfos: [
                        { minValue: 100002, maxValue: 100002, label: "No Votes", symbol: { type: "simple-fill", color: [215, 219, 221, 0.6], outline: null }},
                        { minValue: -200, maxValue: -50, label: "Over 50% More Republican", symbol: { type: "simple-fill", color: [213, 25, 25, 0.6], outline: null }},
                        { minValue: -50, maxValue: -45, label: "≤50% More Republican", symbol: { type: "simple-fill", color: [229, 33, 33, 0.6], outline: null }},
                        { minValue: -45, maxValue: -40, label: "≤45% More Republican", symbol: { type: "simple-fill", color: [232, 55, 55, 0.6], outline: null }},
                        { minValue: -40, maxValue: -35, label: "≤40% More Republican", symbol: { type: "simple-fill", color: [235, 77, 77, 0.6], outline: null }},
                        { minValue: -35, maxValue: -30, label: "≤35% More Republican", symbol: { type: "simple-fill", color: [237, 100, 100, 0.6], outline: null }},
                        { minValue: -30, maxValue: -25, label: "≤30% More Republican", symbol: { type: "simple-fill", color: [240, 122, 122, 0.6], outline: null }},
                        { minValue: -25, maxValue: -20, label: "≤25% More Republican", symbol: { type: "simple-fill", color: [242, 144, 144, 0.6], outline: null }},
                        { minValue: -20, maxValue: -15, label: "≤20% More Republican", symbol: { type: "simple-fill", color: [245, 166, 166, 0.6], outline: null }},
                        { minValue: -15, maxValue: -10, label: "≤15% More Republican", symbol: { type: "simple-fill", color: [247, 188, 188, 0.6], outline: null }},
                        { minValue: -10, maxValue: -5, label: "≤10% More Republican", symbol: { type: "simple-fill", color: [250, 211, 211, 0.6], outline: null }},
                        { minValue: -5, maxValue: 0, label: "≤5% More Republican", symbol: { type: "simple-fill", color: [252, 233, 233, 0.6], outline: null }},
                        { minValue: -100002, maxValue: -100002, label: "No Change", symbol: { type: "simple-fill", color: [255, 255, 255, 0.6], outline: null }},
                        { minValue: 0, maxValue: 5, label: "≤5% More Democratic", symbol: { type: "simple-fill", color: [222, 238, 250, 0.6], outline: null }},
                        { minValue: 5, maxValue: 10, label: "≤10% More Democratic", symbol: { type: "simple-fill", color: [190, 220, 245, 0.6], outline: null }},
                        { minValue: 10, maxValue: 15, label: "≤15% More Democratic", symbol: { type: "simple-fill", color: [157, 203, 241, 0.6], outline: null }},
                        { minValue: 15, maxValue: 20, label: "≤20% More Democratic", symbol: { type: "simple-fill", color: [125, 185, 236, 0.6], outline: null }},
                        { minValue: 20, maxValue: 25, label: "≤25% More Democratic", symbol: { type: "simple-fill", color: [92, 168, 231, 0.6], outline: null }},
                        { minValue: 25, maxValue: 30, label: "≤30% More Democratic", symbol: { type: "simple-fill", color: [60, 150, 226, 0.6], outline: null }},
                        { minValue: 30, maxValue: 35, label: "≤35% More Democratic", symbol: { type: "simple-fill", color: [32, 132, 217, 0.6], outline: null }},
                        { minValue: 35, maxValue: 40, label: "≤40% More Democratic", symbol: { type: "simple-fill", color: [27, 112, 184, 0.6], outline: null }},
                        { minValue: 40, maxValue: 45, label: "≤45% More Democratic", symbol: { type: "simple-fill", color: [22, 93, 152, 0.6], outline: null }},
                        { minValue: 45, maxValue: 50, label: "≤50% More Democratic", symbol: { type: "simple-fill", color: [18, 73, 119, 0.6], outline: null }},
                        { minValue: 50, maxValue: 200, label: "Over 50% More Democratic", symbol: { type: "simple-fill", color: [13, 53, 87, 0.6], outline: null }},
                    ]
                });

                const stateSwingVoteRenderer = new ClassBreaksRenderer({
                    valueExpression: `
                      var total_votes16 = $feature.Tot_16;
                      var total_votes20 = $feature.Tot_20;
                      var difference = $feature.TOTDIF;
                      if (total_votes16 == 0 && total_votes20 == 0) {
                        return 1000002;  // For no votes
                    } else if (difference == 0) {
                        return -1000002;  // For no difference
                    } else {
                        return difference;
                    }
                    `,
                    classBreakInfos: [
                        { minValue: 1000002, maxValue: 1000002, label: "No Votes", symbol: { type: "simple-fill", color: [215, 219, 221, 0.6], outline: null }},
                        { minValue: -1000000, maxValue: -500000, label: "Over 500,000 Votes More Republican", symbol: { type: "simple-fill", color: [213, 25, 25, 0.6], outline: null }},
                        { minValue: -500000, maxValue: -450000, label: "≤500,000 Votes More Republican", symbol: { type: "simple-fill", color: [229, 33, 33, 0.6], outline: null }},
                        { minValue: -450000, maxValue: -400000, label: "≤450,000 Votes More Republican", symbol: { type: "simple-fill", color: [232, 55, 55, 0.6], outline: null }},
                        { minValue: -400000, maxValue: -350000, label: "≤400,000 Votes More Republican", symbol: { type: "simple-fill", color: [235, 77, 77, 0.6], outline: null }},
                        { minValue: -350000, maxValue: -300000, label: "≤350,000 Votes More Republican", symbol: { type: "simple-fill", color: [237, 100, 100, 0.6], outline: null }},
                        { minValue: -300000, maxValue: -250000, label: "≤300,000 Votes More Republican", symbol: { type: "simple-fill", color: [240, 122, 122, 0.6], outline: null }},
                        { minValue: -250000, maxValue: -200000, label: "≤250,000 Votes More Republican", symbol: { type: "simple-fill", color: [242, 144, 144, 0.6], outline: null }},
                        { minValue: -200000, maxValue: -150000, label: "≤200,000 Votes More Republican", symbol: { type: "simple-fill", color: [245, 166, 166, 0.6], outline: null }},
                        { minValue: -150000, maxValue: -100000, label: "≤150,000 Votes More Republican", symbol: { type: "simple-fill", color: [247, 188, 188, 0.6], outline: null }},
                        { minValue: -100000, maxValue: -50000, label: "≤100,000 Votes More Republican", symbol: { type: "simple-fill", color: [250, 211, 211, 0.6], outline: null }},
                        { minValue: -50000, maxValue: 0, label: "≤50,000 Votes More Republican", symbol: { type: "simple-fill", color: [252, 233, 233, 0.6], outline: null }},
                        { minValue: -1000002, maxValue: -1000002, label: "No Change", symbol: { type: "simple-fill", color: [255, 255, 255, 0.6], outline: null }},
                        { minValue: 0, maxValue: 50000, label: "≤50,000 Votes More Democratic", symbol: { type: "simple-fill", color: [222, 238, 250, 0.6], outline: null }},
                        { minValue: 50000, maxValue: 100000, label: "≤100,000 Votes More Democratic", symbol: { type: "simple-fill", color: [190, 220, 245, 0.6], outline: null }},
                        { minValue: 100000, maxValue: 150000, label: "≤150,000 Votes More Democratic", symbol: { type: "simple-fill", color: [157, 203, 241, 0.6], outline: null }},
                        { minValue: 150000, maxValue: 200000, label: "≤200,000 Votes More Democratic", symbol: { type: "simple-fill", color: [125, 185, 236, 0.6], outline: null }},
                        { minValue: 200000, maxValue: 250000, label: "≤250,000 Votes More Democratic", symbol: { type: "simple-fill", color: [92, 168, 231, 0.6], outline: null }},
                        { minValue: 250000, maxValue: 300000, label: "≤300,000 Votes More Democratic", symbol: { type: "simple-fill", color: [60, 150, 226, 0.6], outline: null }},
                        { minValue: 300000, maxValue: 350000, label: "≤350,000 Votes More Democratic", symbol: { type: "simple-fill", color: [32, 132, 217, 0.6], outline: null }},
                        { minValue: 350000, maxValue: 400000, label: "≤400,000 Votes More Democratic", symbol: { type: "simple-fill", color: [27, 112, 184, 0.6], outline: null }},
                        { minValue: 400000, maxValue: 450000, label: "≤450,000 Votes More Democratic", symbol: { type: "simple-fill", color: [22, 93, 152, 0.6], outline: null }},
                        { minValue: 450000, maxValue: 500000, label: "≤500,000 Votes More Democratic", symbol: { type: "simple-fill", color: [18, 73, 119, 0.6], outline: null }},
                        { minValue: 500000, maxValue: 1000000, label: "Over 500,000 Votes More Democratic", symbol: { type: "simple-fill", color: [13, 53, 87, 0.6], outline: null }},
                    ]
                });

                const countSwingVoteRenderer = new ClassBreaksRenderer({
                    valueExpression: `
                      var total_votes16 = $feature.total_vo_1;
                      var total_votes20 = $feature.total_vote;
                      var difference = $feature.TOTDIF;
                      if (total_votes16 == 0 && total_votes20 == 0) {
                        return 1000002;  // For no votes
                    } else if (difference == 0) {
                        return -1000002;  // For no difference
                    } else {
                        return difference;
                    }
                    `,
                    classBreakInfos: [
                        { minValue: 1000002, maxValue: 1000002, label: "No Votes", symbol: { type: "simple-fill", color: [215, 219, 221, 0.6], outline: null }},
                        { minValue: -1000000, maxValue: -20000, label: "Over 20,000 Votes More Republican", symbol: { type: "simple-fill", color: [213, 25, 25, 0.6], outline: null }},
                        { minValue: -20000, maxValue: -18000, label: "≤20,000 Votes More Republican", symbol: { type: "simple-fill", color: [229, 33, 33, 0.6], outline: null }},
                        { minValue: -18000, maxValue: -16000, label: "≤18,000 Votes More Republican", symbol: { type: "simple-fill", color: [232, 55, 55, 0.6], outline: null }},
                        { minValue: -16000, maxValue: -14000, label: "≤16,000 Votes More Republican", symbol: { type: "simple-fill", color: [235, 77, 77, 0.6], outline: null }},
                        { minValue: -14000, maxValue: -12000, label: "≤14,000 Votes More Republican", symbol: { type: "simple-fill", color: [237, 100, 100, 0.6], outline: null }},
                        { minValue: -12000, maxValue: -10000, label: "≤12,000 Votes More Republican", symbol: { type: "simple-fill", color: [240, 122, 122, 0.6], outline: null }},
                        { minValue: -10000, maxValue: -8000, label: "≤10,000 Votes More Republican", symbol: { type: "simple-fill", color: [242, 144, 144, 0.6], outline: null }},
                        { minValue: -8000, maxValue: -6000, label: "≤8,000 Votes More Republican", symbol: { type: "simple-fill", color: [245, 166, 166, 0.6], outline: null }},
                        { minValue: -6000, maxValue: -4000, label: "≤6,000 Votes More Republican", symbol: { type: "simple-fill", color: [247, 188, 188, 0.6], outline: null }},
                        { minValue: -4000, maxValue: -2000, label: "≤4,000 Votes More Republican", symbol: { type: "simple-fill", color: [250, 211, 211, 0.6], outline: null }},
                        { minValue: -2000, maxValue: 0, label: "≤2,000 Votes More Republican", symbol: { type: "simple-fill", color: [252, 233, 233, 0.6], outline: null }},
                        { minValue: -1000002, maxValue: -1000002, label: "No Change", symbol: { type: "simple-fill", color: [255, 255, 255, 0.6], outline: null }},
                        { minValue: 0, maxValue: 2000, label: "≤2,000 Votes More Democratic", symbol: { type: "simple-fill", color: [222, 238, 250, 0.6], outline: null }},
                        { minValue: 2000, maxValue: 4000, label: "≤4,000 Votes More Democratic", symbol: { type: "simple-fill", color: [190, 220, 245, 0.6], outline: null }},
                        { minValue: 4000, maxValue: 6000, label: "≤6,000 Votes More Democratic", symbol: { type: "simple-fill", color: [157, 203, 241, 0.6], outline: null }},
                        { minValue: 6000, maxValue: 8000, label: "≤8,000 Votes More Democratic", symbol: { type: "simple-fill", color: [125, 185, 236, 0.6], outline: null }},
                        { minValue: 8000, maxValue: 10000, label: "≤10,000 Votes More Democratic", symbol: { type: "simple-fill", color: [92, 168, 231, 0.6], outline: null }},
                        { minValue: 10000, maxValue: 12000, label: "≤12,000 Votes More Democratic", symbol: { type: "simple-fill", color: [60, 150, 226, 0.6], outline: null }},
                        { minValue: 12000, maxValue: 14000, label: "≤14,000 Votes More Democratic", symbol: { type: "simple-fill", color: [32, 132, 217, 0.6], outline: null }},
                        { minValue: 14000, maxValue: 16000, label: "≤16,000 Votes More Democratic", symbol: { type: "simple-fill", color: [27, 112, 184, 0.6], outline: null }},
                        { minValue: 16000, maxValue: 18000, label: "≤18,000 Votes More Democratic", symbol: { type: "simple-fill", color: [22, 93, 152, 0.6], outline: null }},
                        { minValue: 18000, maxValue: 20000, label: "≤20,000 Votes More Democratic", symbol: { type: "simple-fill", color: [18, 73, 119, 0.6], outline: null }},
                        { minValue: 20000, maxValue: 1000000, label: "Over 20,000 Votes More Democratic", symbol: { type: "simple-fill", color: [13, 53, 87, 0.6], outline: null }},
                    ]
                });
                const precSwingVoteRenderer = new ClassBreaksRenderer({
                    valueExpression: `
                      var total_votes16 = $feature.TotVote16;
                      var total_votes20 = $feature.TotVote20;
                      var difference = $feature.TOTDIF;
                      if (total_votes16 == 0 && total_votes20 == 0) {
                        return 100002;  // For no votes
                    } else if (difference == 0) {
                        return -100002;  // For no difference
                    } else {
                        return difference;
                    }
                    `,
                    classBreakInfos: [
                        { minValue: 100002, maxValue: 100002, label: "No Votes", symbol: { type: "simple-fill", color: [215, 219, 221, 0.6], outline: null }},
                        { minValue: -3300, maxValue: -500, label: "Over 500 Votes More Republican", symbol: { type: "simple-fill", color: [213, 25, 25, 0.6], outline: null }},
                        { minValue: -500, maxValue: -450, label: "≤500 Votes More Republican", symbol: { type: "simple-fill", color: [229, 33, 33, 0.6], outline: null }},
                        { minValue: -450, maxValue: -400, label: "≤450 Votes More Republican", symbol: { type: "simple-fill", color: [232, 55, 55, 0.6], outline: null }},
                        { minValue: -400, maxValue: -350, label: "≤400 Votes More Republican", symbol: { type: "simple-fill", color: [235, 77, 77, 0.6], outline: null }},
                        { minValue: -350, maxValue: -300, label: "≤350 Votes More Republican", symbol: { type: "simple-fill", color: [237, 100, 100, 0.6], outline: null }},
                        { minValue: -300, maxValue: -250, label: "≤300 Votes More Republican", symbol: { type: "simple-fill", color: [240, 122, 122, 0.6], outline: null }},
                        { minValue: -250, maxValue: -200, label: "≤250 Votes More Republican", symbol: { type: "simple-fill", color: [242, 144, 144, 0.6], outline: null }},
                        { minValue: -200, maxValue: -150, label: "≤200 Votes More Republican", symbol: { type: "simple-fill", color: [245, 166, 166, 0.6], outline: null }},
                        { minValue: -150, maxValue: -100, label: "≤150 Votes More Republican", symbol: { type: "simple-fill", color: [247, 188, 188, 0.6], outline: null }},
                        { minValue: -100, maxValue: -50, label: "≤100 Votes More Republican", symbol: { type: "simple-fill", color: [250, 211, 211, 0.6], outline: null }},
                        { minValue: -50, maxValue: 0, label: "≤50 Votes More Republican", symbol: { type: "simple-fill", color: [252, 233, 233, 0.6], outline: null }},
                        { minValue: -100002, maxValue: -100002, label: "No Change", symbol: { type: "simple-fill", color: [255, 255, 255, 0.6], outline: null }},
                        { minValue: 0, maxValue: 50, label: "≤50 Votes More Democratic", symbol: { type: "simple-fill", color: [222, 238, 250, 0.6], outline: null }},
                        { minValue: 50, maxValue: 100, label: "≤100 Votes More Democratic", symbol: { type: "simple-fill", color: [190, 220, 245, 0.6], outline: null }},
                        { minValue: 100, maxValue: 150, label: "≤150 Votes More Democratic", symbol: { type: "simple-fill", color: [157, 203, 241, 0.6], outline: null }},
                        { minValue: 150, maxValue: 200, label: "≤200 Votes More Democratic", symbol: { type: "simple-fill", color: [125, 185, 236, 0.6], outline: null }},
                        { minValue: 200, maxValue: 250, label: "≤250 Votes More Democratic", symbol: { type: "simple-fill", color: [92, 168, 231, 0.6], outline: null }},
                        { minValue: 250, maxValue: 300, label: "≤300 Votes More Democratic", symbol: { type: "simple-fill", color: [60, 150, 226, 0.6], outline: null }},
                        { minValue: 300, maxValue: 350, label: "≤350 Votes More Democratic", symbol: { type: "simple-fill", color: [32, 132, 217, 0.6], outline: null }},
                        { minValue: 350, maxValue: 400, label: "≤400 Votes More Democratic", symbol: { type: "simple-fill", color: [27, 112, 184, 0.6], outline: null }},
                        { minValue: 400, maxValue: 450, label: "≤450 Votes More Democratic", symbol: { type: "simple-fill", color: [22, 93, 152, 0.6], outline: null }},
                        { minValue: 450, maxValue: 500, label: "≤500 Votes More Democratic", symbol: { type: "simple-fill", color: [18, 73, 119, 0.6], outline: null }},
                        { minValue: 500, maxValue: 3300, label: "Over 500 Votes More Democratic", symbol: { type: "simple-fill", color: [13, 53, 87, 0.6], outline: null }},
                    ]
                });

                const stateColRenderer162 = new ClassBreaksRenderer({
                    valueExpression: `
                      var dem_votes = $feature.Clinton;
                      var gop_votes = $feature.Trump_16;
                      var total_votes = $feature.Tot_16;
					  var clintwon = $feature.pctcl;
					  var truwon = $feature.pcttr16;
                      if (total_votes == 0) {
                          return 100002;  // For no votes
                      } else if (dem_votes == gop_votes) {
                          return -100002;  // For exact ties
                      } else if (dem_votes > gop_votes) {
                          return clintwon;  // Clinton won
                      } else {
                          return -(truwon);  // Trump won
                      }
                    `,
                    classBreakInfos: [
                        { minValue: 100002, maxValue: 100002, label: "No Votes", symbol: { type: "simple-fill", color: [215, 219, 221, 0.6], outline: null }},
                        { minValue: -100, maxValue: -95, label: "≤100% Trump (R)", symbol: { type: "simple-fill", color: [213, 25, 25, 0.6], outline: null }},
                        { minValue: -95, maxValue: -90, label: "≤95% Trump (R)", symbol: { type: "simple-fill", color: [229, 33, 33, 0.6], outline: null }},
                        { minValue: -90, maxValue: -85, label: "≤90% Trump (R)", symbol: { type: "simple-fill", color: [232, 55, 55, 0.6], outline: null }},
                        { minValue: -85, maxValue: -80, label: "≤85% Trump (R)", symbol: { type: "simple-fill", color: [235, 77, 77, 0.6], outline: null }},
                        { minValue: -80, maxValue: -75, label: "≤80% Trump (R)", symbol: { type: "simple-fill", color: [237, 100, 100, 0.6], outline: null }},
                        { minValue: -75, maxValue: -70, label: "≤75% Trump (R)", symbol: { type: "simple-fill", color: [240, 122, 122, 0.6], outline: null }},
                        { minValue: -70, maxValue: -65, label: "≤70% Trump (R)", symbol: { type: "simple-fill", color: [242, 144, 144, 0.6], outline: null }},
                        { minValue: -65, maxValue: -60, label: "≤65% Trump (R)", symbol: { type: "simple-fill", color: [245, 166, 166, 0.6], outline: null }},
                        { minValue: -60, maxValue: -55, label: "≤60% Trump (R)", symbol: { type: "simple-fill", color: [247, 188, 188, 0.6], outline: null }},
                        { minValue: -55, maxValue: -50, label: "≤55% Trump (R)", symbol: { type: "simple-fill", color: [250, 211, 211, 0.6], outline: null }},
                        { minValue: -50, maxValue: 0, label: "≤50% Trump (R)", symbol: { type: "simple-fill", color: [252, 233, 233, 0.6], outline: null }},
                        { minValue: -100002, maxValue: -100002, label: "Tie", symbol: { type: "simple-fill", color: [255, 255, 255, 0.6], outline: null }},
                        { minValue: 0, maxValue: 50, label: "≤50% Clinton (D)", symbol: { type: "simple-fill", color: [222, 238, 250, 0.6], outline: null }},
                        { minValue: 50, maxValue: 55, label: "≤55% Clinton (D)", symbol: { type: "simple-fill", color: [190, 220, 245, 0.6], outline: null }},
                        { minValue: 55, maxValue: 60, label: "≤60% Clinton (D)", symbol: { type: "simple-fill", color: [157, 203, 241, 0.6], outline: null }},
                        { minValue: 60, maxValue: 65, label: "≤65% Clinton (D)", symbol: { type: "simple-fill", color: [125, 185, 236, 0.6], outline: null }},
                        { minValue: 65, maxValue: 70, label: "≤70% Clinton (D)", symbol: { type: "simple-fill", color: [92, 168, 231, 0.6], outline: null }},
                        { minValue: 70, maxValue: 75, label: "≤75% Clinton (D)", symbol: { type: "simple-fill", color: [60, 150, 226, 0.6], outline: null }},
                        { minValue: 75, maxValue: 80, label: "≤80% Clinton (D)", symbol: { type: "simple-fill", color: [32, 132, 217, 0.6], outline: null }},
                        { minValue: 80, maxValue: 85, label: "≤85% Clinton (D)", symbol: { type: "simple-fill", color: [27, 112, 184, 0.6], outline: null }},
                        { minValue: 85, maxValue: 90, label: "≤90% Clinton (D)", symbol: { type: "simple-fill", color: [22, 93, 152, 0.6], outline: null }},
                        { minValue: 90, maxValue: 95, label: "≤95% Clinton (D)", symbol: { type: "simple-fill", color: [18, 73, 119, 0.6], outline: null }},
                        { minValue: 95, maxValue: 100, label: "≤100% Clinton (D)", symbol: { type: "simple-fill", color: [13, 53, 87, 0.6], outline: null }},
                    ]
                });
                const countColRenderer162 = new ClassBreaksRenderer({
                    valueExpression: `
                      var dem_votes = $feature.votes_dem_;
                      var gop_votes = $feature.votes_gop_;
                      var total_votes = $feature.total_vo_1;
					  var clintwon = $feature.pctcl;
					  var truwon = $feature.pcttr16;
                      if (total_votes == 0) {
                          return 100002;  // For no votes
                      } else if (dem_votes == gop_votes) {
                          return -100002;  // For exact ties
                      } else if (dem_votes > gop_votes) {
                          return clintwon;  // Clinton won
                      } else {
                          return -(truwon);  // Trump won
                      }
                    `,
                    classBreakInfos: [
                        { minValue: 100002, maxValue: 100002, label: "No Votes", symbol: { type: "simple-fill", color: [215, 219, 221, 0.6], outline: null }},
                        { minValue: -100, maxValue: -95, label: "≤100% Trump (R)", symbol: { type: "simple-fill", color: [213, 25, 25, 0.6], outline: null }},
                        { minValue: -95, maxValue: -90, label: "≤95% Trump (R)", symbol: { type: "simple-fill", color: [229, 33, 33, 0.6], outline: null }},
                        { minValue: -90, maxValue: -85, label: "≤90% Trump (R)", symbol: { type: "simple-fill", color: [232, 55, 55, 0.6], outline: null }},
                        { minValue: -85, maxValue: -80, label: "≤85% Trump (R)", symbol: { type: "simple-fill", color: [235, 77, 77, 0.6], outline: null }},
                        { minValue: -80, maxValue: -75, label: "≤80% Trump (R)", symbol: { type: "simple-fill", color: [237, 100, 100, 0.6], outline: null }},
                        { minValue: -75, maxValue: -70, label: "≤75% Trump (R)", symbol: { type: "simple-fill", color: [240, 122, 122, 0.6], outline: null }},
                        { minValue: -70, maxValue: -65, label: "≤70% Trump (R)", symbol: { type: "simple-fill", color: [242, 144, 144, 0.6], outline: null }},
                        { minValue: -65, maxValue: -60, label: "≤65% Trump (R)", symbol: { type: "simple-fill", color: [245, 166, 166, 0.6], outline: null }},
                        { minValue: -60, maxValue: -55, label: "≤60% Trump (R)", symbol: { type: "simple-fill", color: [247, 188, 188, 0.6], outline: null }},
                        { minValue: -55, maxValue: -50, label: "≤55% Trump (R)", symbol: { type: "simple-fill", color: [250, 211, 211, 0.6], outline: null }},
                        { minValue: -50, maxValue: 0, label: "≤50% Trump (R)", symbol: { type: "simple-fill", color: [252, 233, 233, 0.6], outline: null }},
                        { minValue: -100002, maxValue: -100002, label: "Tie", symbol: { type: "simple-fill", color: [255, 255, 255, 0.6], outline: null }},
                        { minValue: 0, maxValue: 50, label: "≤50% Clinton (D)", symbol: { type: "simple-fill", color: [222, 238, 250, 0.6], outline: null }},
                        { minValue: 50, maxValue: 55, label: "≤55% Clinton (D)", symbol: { type: "simple-fill", color: [190, 220, 245, 0.6], outline: null }},
                        { minValue: 55, maxValue: 60, label: "≤60% Clinton (D)", symbol: { type: "simple-fill", color: [157, 203, 241, 0.6], outline: null }},
                        { minValue: 60, maxValue: 65, label: "≤65% Clinton (D)", symbol: { type: "simple-fill", color: [125, 185, 236, 0.6], outline: null }},
                        { minValue: 65, maxValue: 70, label: "≤70% Clinton (D)", symbol: { type: "simple-fill", color: [92, 168, 231, 0.6], outline: null }},
                        { minValue: 70, maxValue: 75, label: "≤75% Clinton (D)", symbol: { type: "simple-fill", color: [60, 150, 226, 0.6], outline: null }},
                        { minValue: 75, maxValue: 80, label: "≤80% Clinton (D)", symbol: { type: "simple-fill", color: [32, 132, 217, 0.6], outline: null }},
                        { minValue: 80, maxValue: 85, label: "≤85% Clinton (D)", symbol: { type: "simple-fill", color: [27, 112, 184, 0.6], outline: null }},
                        { minValue: 85, maxValue: 90, label: "≤90% Clinton (D)", symbol: { type: "simple-fill", color: [22, 93, 152, 0.6], outline: null }},
                        { minValue: 90, maxValue: 95, label: "≤95% Clinton (D)", symbol: { type: "simple-fill", color: [18, 73, 119, 0.6], outline: null }},
                        { minValue: 95, maxValue: 100, label: "≤100% Clinton (D)", symbol: { type: "simple-fill", color: [13, 53, 87, 0.6], outline: null }},
                    ]
                });
                const precColRenderer162 = new ClassBreaksRenderer({
                    valueExpression: `
                      var dem_votes = $feature.G16PREDCLI;
                      var gop_votes = $feature.G16PRERTRU;
                      var other_votes = $feature.TotOth16;
                      var total_votes = $feature.TotVote16;
					  var clintwon = $feature.PCTCLI;
					  var truwon = $feature.PCTTRU16;
                      if (total_votes == 0) {
                          return 100002;  // For no votes
                      } else if (other_votes > dem_votes && other_votes > gop_votes) {
						if (gop_votes > dem_votes || gop_votes < dem_votes) {
                          return (other_votes / total_votes) * 100001; // McMullin or other won
						}
                      } else if (dem_votes == gop_votes && dem_votes > other_votes) {
                          return -100002;  // For exact ties
                      } else if (other_votes == gop_votes && other_votes > dem_votes) {
                          return -100002;  // For exact ties
                      } else if (dem_votes == other_votes && dem_votes > gop_votes) {
                          return -100002;  // For exact ties
                      } else if (dem_votes > gop_votes) {
                          return clintwon;  // Clinton won
                      } else {
                          return -(truwon);  // Trump won
                      }
                    `,
                    classBreakInfos: [
                      { minValue: 95000, maxValue: 100000, label: "≤100% Other", symbol: { type: "simple-fill", color: [53, 9, 109, 0.35], outline: null }},
                      { minValue: 90000, maxValue: 95000, label: "≤95% Other", symbol: { type: "simple-fill", color: [69, 11, 142, 0.35], outline: null }},
                      { minValue: 85000, maxValue: 90000, label: "≤90% Other", symbol: { type: "simple-fill", color: [85, 14, 175, 0.35], outline: null }},
                      { minValue: 80000, maxValue: 85000, label: "≤85% Other", symbol: { type: "simple-fill", color: [101, 16, 208, 0.35], outline: null }},
                      { minValue: 75000, maxValue: 80000, label: "≤80% Other", symbol: { type: "simple-fill", color: [118, 24, 237, 0.35], outline: null }},
                      { minValue: 70000, maxValue: 75000, label: "≤75% Other", symbol: { type: "simple-fill", color: [138, 57, 239, 0.35], outline: null }},
                      { minValue: 65000, maxValue: 70000, label: "≤70% Other", symbol: { type: "simple-fill", color: [157, 90, 242, 0.35], outline: null }},
                      { minValue: 60000, maxValue: 65000, label: "≤65% Other", symbol: { type: "simple-fill", color: [177, 123, 245, 0.35], outline: null }},
                      { minValue: 55000, maxValue: 60000, label: "≤60% Other", symbol: { type: "simple-fill", color: [196, 156, 247, 0.35], outline: null }},
                      { minValue: 50000, maxValue: 55000, label: "≤55% Other", symbol: { type: "simple-fill", color: [216, 189, 250, 0.35], outline: null }},
                      { minValue: 100, maxValue: 50000, label: "≤50% Other", symbol: { type: "simple-fill", color: [235, 222, 252, 0.35], outline: null }},
                      { minValue: 100002, maxValue: 100002, label: "No Votes", symbol: { type: "simple-fill", color: [215, 219, 221, 0.35], outline: null }},
                      { minValue: -100, maxValue: -95, label: "≤100% Trump (R)", symbol: { type: "simple-fill", color: [213, 25, 25, 0.35], outline: null }},
                      { minValue: -95, maxValue: -90, label: "≤95% Trump (R)", symbol: { type: "simple-fill", color: [229, 33, 33, 0.35], outline: null }},
                      { minValue: -90, maxValue: -85, label: "≤90% Trump (R)", symbol: { type: "simple-fill", color: [232, 55, 55, 0.35], outline: null }},
                      { minValue: -85, maxValue: -80, label: "≤85% Trump (R)", symbol: { type: "simple-fill", color: [235, 77, 77, 0.35], outline: null }},
                      { minValue: -80, maxValue: -75, label: "≤80% Trump (R)", symbol: { type: "simple-fill", color: [237, 100, 100, 0.35], outline: null }},
                      { minValue: -75, maxValue: -70, label: "≤75% Trump (R)", symbol: { type: "simple-fill", color: [240, 122, 122, 0.35], outline: null }},
                      { minValue: -70, maxValue: -65, label: "≤70% Trump (R)", symbol: { type: "simple-fill", color: [242, 144, 144, 0.35], outline: null }},
                      { minValue: -65, maxValue: -60, label: "≤65% Trump (R)", symbol: { type: "simple-fill", color: [245, 166, 166, 0.35], outline: null }},
                      { minValue: -60, maxValue: -55, label: "≤60% Trump (R)", symbol: { type: "simple-fill", color: [247, 188, 188, 0.35], outline: null }},
                      { minValue: -55, maxValue: -50, label: "≤55% Trump (R)", symbol: { type: "simple-fill", color: [250, 211, 211, 0.35], outline: null }},
                      { minValue: -50, maxValue: 0, label: "≤50% Trump (R)", symbol: { type: "simple-fill", color: [252, 233, 233, 0.35], outline: null }},
                      { minValue: -100002, maxValue: -100002, label: "Tie", symbol: { type: "simple-fill", color: [255, 255, 255, 0.35], outline: null }},
                      { minValue: 0, maxValue: 50, label: "≤50% Clinton (D)", symbol: { type: "simple-fill", color: [222, 238, 250, 0.35], outline: null }},
                      { minValue: 50, maxValue: 55, label: "≤55% Clinton (D)", symbol: { type: "simple-fill", color: [190, 220, 245, 0.35], outline: null }},
                      { minValue: 55, maxValue: 60, label: "≤60% Clinton (D)", symbol: { type: "simple-fill", color: [157, 203, 241, 0.35], outline: null }},
                      { minValue: 60, maxValue: 65, label: "≤65% Clinton (D)", symbol: { type: "simple-fill", color: [125, 185, 236, 0.35], outline: null }},
                      { minValue: 65, maxValue: 70, label: "≤70% Clinton (D)", symbol: { type: "simple-fill", color: [92, 168, 231, 0.35], outline: null }},
                      { minValue: 70, maxValue: 75, label: "≤75% Clinton (D)", symbol: { type: "simple-fill", color: [60, 150, 226, 0.35], outline: null }},
                      { minValue: 75, maxValue: 80, label: "≤80% Clinton (D)", symbol: { type: "simple-fill", color: [32, 132, 217, 0.35], outline: null }},
                      { minValue: 80, maxValue: 85, label: "≤85% Clinton (D)", symbol: { type: "simple-fill", color: [27, 112, 184, 0.35], outline: null }},
                      { minValue: 85, maxValue: 90, label: "≤90% Clinton (D)", symbol: { type: "simple-fill", color: [22, 93, 152, 0.35], outline: null }},
                      { minValue: 90, maxValue: 95, label: "≤95% Clinton (D)", symbol: { type: "simple-fill", color: [18, 73, 119, 0.35], outline: null }},
                      { minValue: 95, maxValue: 100, label: "≤100% Clinton (D)", symbol: { type: "simple-fill", color: [13, 53, 87, 0.35], outline: null }},
                    ]
                });

                const stateColRenderer16 = new ClassBreaksRenderer({
                    valueExpression: `
                      var dem_votes = $feature.Clinton;
                      var gop_votes = $feature.Trump_16;
                      var total_votes = $feature.Tot_16;
                      var clintwon = $feature.pctcl;
					  var truwon = $feature.pcttr16;
                      if (total_votes == 0) {
                          return 100002;  // For no votes
                      } else if (dem_votes == gop_votes) {
                          return -100002;  // For exact ties
                      } else if (dem_votes > gop_votes) {
                          return clintwon;  // Clinton won
                      } else {
                          return -(truwon);  // Trump won
                      }
                    `,
                    classBreakInfos: [
                        { minValue: 100002, maxValue: 100002, label: "No Votes", symbol: { type: "simple-fill", color: [215, 219, 221, 0.8], outline: null }},
                        { minValue: -100, maxValue: -95, label: "≤100% Trump (R)", symbol: { type: "simple-fill", color: [213, 25, 25, 0.8], outline: null }},
                        { minValue: -95, maxValue: -90, label: "≤95% Trump (R)", symbol: { type: "simple-fill", color: [229, 33, 33, 0.8], outline: null }},
                        { minValue: -90, maxValue: -85, label: "≤90% Trump (R)", symbol: { type: "simple-fill", color: [232, 55, 55, 0.8], outline: null }},
                        { minValue: -85, maxValue: -80, label: "≤85% Trump (R)", symbol: { type: "simple-fill", color: [235, 77, 77, 0.8], outline: null }},
                        { minValue: -80, maxValue: -75, label: "≤80% Trump (R)", symbol: { type: "simple-fill", color: [237, 100, 100, 0.8], outline: null }},
                        { minValue: -75, maxValue: -70, label: "≤75% Trump (R)", symbol: { type: "simple-fill", color: [240, 122, 122, 0.8], outline: null }},
                        { minValue: -70, maxValue: -65, label: "≤70% Trump (R)", symbol: { type: "simple-fill", color: [242, 144, 144, 0.8], outline: null }},
                        { minValue: -65, maxValue: -60, label: "≤65% Trump (R)", symbol: { type: "simple-fill", color: [245, 166, 166, 0.8], outline: null }},
                        { minValue: -60, maxValue: -55, label: "≤60% Trump (R)", symbol: { type: "simple-fill", color: [247, 188, 188, 0.8], outline: null }},
                        { minValue: -55, maxValue: -50, label: "≤55% Trump (R)", symbol: { type: "simple-fill", color: [250, 211, 211, 0.8], outline: null }},
                        { minValue: -50, maxValue: 0, label: "≤50% Trump (R)", symbol: { type: "simple-fill", color: [252, 233, 233, 0.8], outline: null }},
                        { minValue: -100002, maxValue: -100002, label: "Tie", symbol: { type: "simple-fill", color: [255, 255, 255, 0.8], outline: null }},
                        { minValue: 0, maxValue: 50, label: "≤50% Clinton (D)", symbol: { type: "simple-fill", color: [222, 238, 250, 0.8], outline: null }},
                        { minValue: 50, maxValue: 55, label: "≤55% Clinton (D)", symbol: { type: "simple-fill", color: [190, 220, 245, 0.8], outline: null }},
                        { minValue: 55, maxValue: 60, label: "≤60% Clinton (D)", symbol: { type: "simple-fill", color: [157, 203, 241, 0.8], outline: null }},
                        { minValue: 60, maxValue: 65, label: "≤65% Clinton (D)", symbol: { type: "simple-fill", color: [125, 185, 236, 0.8], outline: null }},
                        { minValue: 65, maxValue: 70, label: "≤70% Clinton (D)", symbol: { type: "simple-fill", color: [92, 168, 231, 0.8], outline: null }},
                        { minValue: 70, maxValue: 75, label: "≤75% Clinton (D)", symbol: { type: "simple-fill", color: [60, 150, 226, 0.8], outline: null }},
                        { minValue: 75, maxValue: 80, label: "≤80% Clinton (D)", symbol: { type: "simple-fill", color: [32, 132, 217, 0.8], outline: null }},
                        { minValue: 80, maxValue: 85, label: "≤85% Clinton (D)", symbol: { type: "simple-fill", color: [27, 112, 184, 0.8], outline: null }},
                        { minValue: 85, maxValue: 90, label: "≤90% Clinton (D)", symbol: { type: "simple-fill", color: [22, 93, 152, 0.8], outline: null }},
                        { minValue: 90, maxValue: 95, label: "≤95% Clinton (D)", symbol: { type: "simple-fill", color: [18, 73, 119, 0.8], outline: null }},
                        { minValue: 95, maxValue: 100, label: "≤100% Clinton (D)", symbol: { type: "simple-fill", color: [13, 53, 87, 0.8], outline: null }},
                    ]
                });
                const countColRenderer16 = new ClassBreaksRenderer({
                  valueExpression: `
                    var dem_votes = $feature.votes_dem_;
                    var gop_votes = $feature.votes_gop_;
                    var clintwon = $feature.pctcl;
					var truwon = $feature.pcttr16;
                    if (total_votes == 0) {
                        return 100002;  // For no votes
                    } else if (dem_votes == gop_votes) {
                        return -100002;  // For exact ties
                    } else if (dem_votes > gop_votes) {
                        return clintwon;  // Clinton won
                    } else {
                        return -(truwon);  // Trump won
                    }
                  `,
                  classBreakInfos: [
                      { minValue: 100002, maxValue: 100002, label: "No Votes", symbol: { type: "simple-fill", color: [215, 219, 221, 0.8], outline: null }},
                      { minValue: -100, maxValue: -95, label: "≤100% Trump (R)", symbol: { type: "simple-fill", color: [213, 25, 25, 0.8], outline: null }},
                      { minValue: -95, maxValue: -90, label: "≤95% Trump (R)", symbol: { type: "simple-fill", color: [229, 33, 33, 0.8], outline: null }},
                      { minValue: -90, maxValue: -85, label: "≤90% Trump (R)", symbol: { type: "simple-fill", color: [232, 55, 55, 0.8], outline: null }},
                      { minValue: -85, maxValue: -80, label: "≤85% Trump (R)", symbol: { type: "simple-fill", color: [235, 77, 77, 0.8], outline: null }},
                      { minValue: -80, maxValue: -75, label: "≤80% Trump (R)", symbol: { type: "simple-fill", color: [237, 100, 100, 0.8], outline: null }},
                      { minValue: -75, maxValue: -70, label: "≤75% Trump (R)", symbol: { type: "simple-fill", color: [240, 122, 122, 0.8], outline: null }},
                      { minValue: -70, maxValue: -65, label: "≤70% Trump (R)", symbol: { type: "simple-fill", color: [242, 144, 144, 0.8], outline: null }},
                      { minValue: -65, maxValue: -60, label: "≤65% Trump (R)", symbol: { type: "simple-fill", color: [245, 166, 166, 0.8], outline: null }},
                      { minValue: -60, maxValue: -55, label: "≤60% Trump (R)", symbol: { type: "simple-fill", color: [247, 188, 188, 0.8], outline: null }},
                      { minValue: -55, maxValue: -50, label: "≤55% Trump (R)", symbol: { type: "simple-fill", color: [250, 211, 211, 0.8], outline: null }},
                      { minValue: -50, maxValue: 0, label: "≤50% Trump (R)", symbol: { type: "simple-fill", color: [252, 233, 233, 0.8], outline: null }},
                      { minValue: -100002, maxValue: -100002, label: "Tie", symbol: { type: "simple-fill", color: [255, 255, 255, 0.8], outline: null }},
                      { minValue: 0, maxValue: 50, label: "≤50% Clinton (D)", symbol: { type: "simple-fill", color: [222, 238, 250, 0.8], outline: null }},
                      { minValue: 50, maxValue: 55, label: "≤55% Clinton (D)", symbol: { type: "simple-fill", color: [190, 220, 245, 0.8], outline: null }},
                      { minValue: 55, maxValue: 60, label: "≤60% Clinton (D)", symbol: { type: "simple-fill", color: [157, 203, 241, 0.8], outline: null }},
                      { minValue: 60, maxValue: 65, label: "≤65% Clinton (D)", symbol: { type: "simple-fill", color: [125, 185, 236, 0.8], outline: null }},
                      { minValue: 65, maxValue: 70, label: "≤70% Clinton (D)", symbol: { type: "simple-fill", color: [92, 168, 231, 0.8], outline: null }},
                      { minValue: 70, maxValue: 75, label: "≤75% Clinton (D)", symbol: { type: "simple-fill", color: [60, 150, 226, 0.8], outline: null }},
                      { minValue: 75, maxValue: 80, label: "≤80% Clinton (D)", symbol: { type: "simple-fill", color: [32, 132, 217, 0.8], outline: null }},
                      { minValue: 80, maxValue: 85, label: "≤85% Clinton (D)", symbol: { type: "simple-fill", color: [27, 112, 184, 0.8], outline: null }},
                      { minValue: 85, maxValue: 90, label: "≤90% Clinton (D)", symbol: { type: "simple-fill", color: [22, 93, 152, 0.8], outline: null }},
                      { minValue: 90, maxValue: 95, label: "≤95% Clinton (D)", symbol: { type: "simple-fill", color: [18, 73, 119, 0.8], outline: null }},
                      { minValue: 95, maxValue: 100, label: "≤100% Clinton (D)", symbol: { type: "simple-fill", color: [13, 53, 87, 0.8], outline: null }},
                  ]
                });
                const precColRenderer16 = new ClassBreaksRenderer({
                      valueExpression: `
                      var dem_votes = $feature.G16PREDCLI;
                      var gop_votes = $feature.G16PRERTRU;
                      var other_votes = $feature.TotOth16;
                      var total_votes = $feature.TotVote16;
                      var clintwon = $feature.PCTCLI;
					  var truwon = $feature.PCTTRU16;
                      if (total_votes == 0) {
                          return 100002;  // For no votes
                      } else if (other_votes > dem_votes && other_votes > gop_votes) {
						if (gop_votes > dem_votes || gop_votes < dem_votes) {
                          return (other_votes / total_votes) * 100001; // McMullin or other won
						}
                      } else if (dem_votes == gop_votes && dem_votes > other_votes) {
                          return -100002;  // For exact ties
                      } else if (other_votes == gop_votes && other_votes > dem_votes) {
                          return -100002;  // For exact ties
                      } else if (dem_votes == other_votes && dem_votes > gop_votes) {
                          return -100002;  // For exact ties
                      } else if (dem_votes > gop_votes) {
                          return clintwon;  // Clinton won
                      } else {
                          return -(truwon);  // Trump won
                      }
                      `,
                      classBreakInfos: [
                      { minValue: 95000, maxValue: 100000, label: "≤100% Other", symbol: { type: "simple-fill", color: [53, 9, 109, 0.8], outline: null }},
                      { minValue: 90000, maxValue: 95000, label: "≤95% Other", symbol: { type: "simple-fill", color: [69, 11, 142, 0.8], outline: null }},
                      { minValue: 85000, maxValue: 90000, label: "≤90% Other", symbol: { type: "simple-fill", color: [85, 14, 175, 0.8], outline: null }},
                      { minValue: 80000, maxValue: 85000, label: "≤85% Other", symbol: { type: "simple-fill", color: [101, 16, 208, 0.8], outline: null }},
                      { minValue: 75000, maxValue: 80000, label: "≤80% Other", symbol: { type: "simple-fill", color: [118, 24, 237, 0.8], outline: null }},
                      { minValue: 70000, maxValue: 75000, label: "≤75% Other", symbol: { type: "simple-fill", color: [138, 57, 239, 0.8], outline: null }},
                      { minValue: 65000, maxValue: 70000, label: "≤70% Other", symbol: { type: "simple-fill", color: [157, 90, 242, 0.8], outline: null }},
                      { minValue: 60000, maxValue: 65000, label: "≤65% Other", symbol: { type: "simple-fill", color: [177, 123, 245, 0.8], outline: null }},
                      { minValue: 55000, maxValue: 60000, label: "≤60% Other", symbol: { type: "simple-fill", color: [196, 156, 247, 0.8], outline: null }},
                      { minValue: 50000, maxValue: 55000, label: "≤55% Other", symbol: { type: "simple-fill", color: [216, 189, 250, 0.8], outline: null }},
                      { minValue: 100, maxValue: 50000, label: "≤50% Other", symbol: { type: "simple-fill", color: [235, 222, 252, 0.8], outline: null }},
                      { minValue: 100002, maxValue: 100002, label: "No Votes", symbol: { type: "simple-fill", color: [215, 219, 221, 0.8], outline: null }},
                      { minValue: -100, maxValue: -95, label: "≤100% Trump (R)", symbol: { type: "simple-fill", color: [213, 25, 25, 0.8], outline: null }},
                      { minValue: -95, maxValue: -90, label: "≤95% Trump (R)", symbol: { type: "simple-fill", color: [229, 33, 33, 0.8], outline: null }},
                      { minValue: -90, maxValue: -85, label: "≤90% Trump (R)", symbol: { type: "simple-fill", color: [232, 55, 55, 0.8], outline: null }},
                      { minValue: -85, maxValue: -80, label: "≤85% Trump (R)", symbol: { type: "simple-fill", color: [235, 77, 77, 0.8], outline: null }},
                      { minValue: -80, maxValue: -75, label: "≤80% Trump (R)", symbol: { type: "simple-fill", color: [237, 100, 100, 0.8], outline: null }},
                      { minValue: -75, maxValue: -70, label: "≤75% Trump (R)", symbol: { type: "simple-fill", color: [240, 122, 122, 0.8], outline: null }},
                      { minValue: -70, maxValue: -65, label: "≤70% Trump (R)", symbol: { type: "simple-fill", color: [242, 144, 144, 0.8], outline: null }},
                      { minValue: -65, maxValue: -60, label: "≤65% Trump (R)", symbol: { type: "simple-fill", color: [245, 166, 166, 0.8], outline: null }},
                      { minValue: -60, maxValue: -55, label: "≤60% Trump (R)", symbol: { type: "simple-fill", color: [247, 188, 188, 0.8], outline: null }},
                      { minValue: -55, maxValue: -50, label: "≤55% Trump (R)", symbol: { type: "simple-fill", color: [250, 211, 211, 0.8], outline: null }},
                      { minValue: -50, maxValue: 0, label: "≤50% Trump (R)", symbol: { type: "simple-fill", color: [252, 233, 233, 0.8], outline: null }},
                      { minValue: -100002, maxValue: -100002, label: "Tie", symbol: { type: "simple-fill", color: [255, 255, 255, 0.8], outline: null }},
                      { minValue: 0, maxValue: 50, label: "≤50% Clinton (D)", symbol: { type: "simple-fill", color: [222, 238, 250, 0.8], outline: null }},
                      { minValue: 50, maxValue: 55, label: "≤55% Clinton (D)", symbol: { type: "simple-fill", color: [190, 220, 245, 0.8], outline: null }},
                      { minValue: 55, maxValue: 60, label: "≤60% Clinton (D)", symbol: { type: "simple-fill", color: [157, 203, 241, 0.8], outline: null }},
                      { minValue: 60, maxValue: 65, label: "≤65% Clinton (D)", symbol: { type: "simple-fill", color: [125, 185, 236, 0.8], outline: null }},
                      { minValue: 65, maxValue: 70, label: "≤70% Clinton (D)", symbol: { type: "simple-fill", color: [92, 168, 231, 0.8], outline: null }},
                      { minValue: 70, maxValue: 75, label: "≤75% Clinton (D)", symbol: { type: "simple-fill", color: [60, 150, 226, 0.8], outline: null }},
                      { minValue: 75, maxValue: 80, label: "≤80% Clinton (D)", symbol: { type: "simple-fill", color: [32, 132, 217, 0.8], outline: null }},
                      { minValue: 80, maxValue: 85, label: "≤85% Clinton (D)", symbol: { type: "simple-fill", color: [27, 112, 184, 0.8], outline: null }},
                      { minValue: 85, maxValue: 90, label: "≤90% Clinton (D)", symbol: { type: "simple-fill", color: [22, 93, 152, 0.8], outline: null }},
                      { minValue: 90, maxValue: 95, label: "≤95% Clinton (D)", symbol: { type: "simple-fill", color: [18, 73, 119, 0.8], outline: null }},
                      { minValue: 95, maxValue: 100, label: "≤100% Clinton (D)", symbol: { type: "simple-fill", color: [13, 53, 87, 0.8], outline: null }},
                  ]
                });
	
	//Highlight renderers for 2020
	const stateRenderer = new SimpleRenderer({
            //type: "simple",
            symbol: {
              type: "simple-fill",
              style: "none",
              outline: null
            }
        }); 
	
	const countRenderer = new SimpleRenderer({
            //type: "simple",
            symbol: {
              type: "simple-fill",
              style: "none",
              outline: null
            }
        }); 

	const precRenderer = new SimpleRenderer({
            //type: "simple",
            symbol: {
              type: "simple-fill",
              style: "none",
              outline: null
            }
        }); 

	const voteMarginSymbol = new SimpleMarkerSymbol({
          outline: {
            color: "rgba(0, 0, 0, 0)",
            width: 0
          }
        });        

	// Bubble renderer
	const stateBubbleRenderer = new SimpleRenderer({
              symbol: voteMarginSymbol,
              visualVariables: [
                {
                  type: "size",
                  field: "BID_TRU",
                  stops: [
                    { value: 2000, size: 3 },
		    { value: 500000, size: 20 },
		    { value: 5500000, size: 76 },
                    { value: -2000, size: 3 },
		    { value: -500000, size: 20 },
		    { value: -5500000, size: 76 },
                  ],
                  legendOptions: {
                    title: "Number of Biden (D) Votes minus Number of Trump (R) Votes"
                  }
                },
                {
                  type: "color",
                  field: "BID_TRU",
                  legendOptions: {
                    showLegend: false
                  },
                  stops: [
                    { value: -1, color: [204, 10, 18, 0.60] },
                    { value: 1, color: [37, 66, 143, 0.60] }
                  ]
                }
              ]
            });
	
	const countyBubbleRenderer = new SimpleRenderer({
            symbol: voteMarginSymbol,
            visualVariables: [
              {
                type: "size",
                field: "BID_TRU",
                stops: [
                  { value: 1, size: 1 },
		  { value: 100000, size: 23 },
		  { value: 2000000, size: 92 },
                  { value: -1, size: 1 },
		  { value: -100000, size: 23 },
		  { value: -2000000, size: 92 },
                ],
                legendOptions: {
                  title: "Number of Biden (D) Votes minus Number of Trump (R) Votes"
                }
              },
              {
                type: "color",
                field: "BID_TRU",
                legendOptions: {
                  showLegend: false
                },
                stops: [
                  { value: -1, color: [204, 10, 18, 0.60] },
                  { value: 1, color: [37, 66, 143, 0.60] }
                ]
              }
            ]
          });

          const precinctBubbleRenderer = new SimpleRenderer({
            symbol: voteMarginSymbol,
            visualVariables: [
              {
                type: "size",
                field: "BID_TRU",
                stops: [
                  { value: 1, size: 1 },
                  { value: 400, size: 10 },
                  { value: 7000, size: 20 },
                  { value: -1, size: 1 },
                  { value: -400, size: 10 },
                  { value: -7000, size: 20 },
                ],
                legendOptions: {
                  title: "Number of Biden (D) Votes minus Number of Trump (R) Votes"
                }
              },
              {
                type: "color",
                field: "BID_TRU",
                legendOptions: {
                  showLegend: false
                },
                stops: [
                  { value: -1, color: [204, 10, 18, 0.35] },
                  { value: 1, color: [37, 66, 143, 0.35] }
                ]
              }
            ]
          });

	  // Dot density renderer
	  const dotDensityRenderer = new DotDensityRenderer({
            dotValue: 1,
	    dotSize: 0.5,
            outline: null,
            dotBlendingEnabled: true,
            referenceScale: 100000,
            legendOptions: {
              unit: "Vote(s)"
            },
            attributes: [
              {
                field: "G20PREDBID",
                color: "#00b6f1",
                label: "Biden (D)"
              },
              {
                field: "G20PRERTRU",
                color: "#f23c3f",
                label: "Trump (R)"
              },
		field: "TotOth20",
                color: "#bf00ff",
                label: "Other"
	      }
            ]
          });

	  // Class breaks renderer
          const stateColRenderer2 = new ClassBreaksRenderer({
                  valueExpression: `
					  var dem_votes = $feature.Biden;
					  var gop_votes = $feature.Trump_20;
					  var total_votes = $feature.Tot_20;
					  var bidwon = $feature.pctbi;
					  var truwon = $feature.pcttr20;
					  if (total_votes == 0) {
						  return 100002;  // For no votes
					  } else if (dem_votes == gop_votes) {
						  return -100002;  // For exact ties
					  } else if (dem_votes > gop_votes) {
						  return bidwon;  // Biden won
					  } else {
						  return -(truwon);  // Trump won
					  }
                  `,
                  classBreakInfos: [
                      { minValue: 100002, maxValue: 100002, label: "No Votes", symbol: { type: "simple-fill", color: [215, 219, 221, 0.6], outline: null }},
                      { minValue: -100, maxValue: -95, label: "≤100% Trump (R)", symbol: { type: "simple-fill", color: [213, 25, 25, 0.6], outline: null }},
                      { minValue: -95, maxValue: -90, label: "≤95% Trump (R)", symbol: { type: "simple-fill", color: [229, 33, 33, 0.6], outline: null }},
                      { minValue: -90, maxValue: -85, label: "≤90% Trump (R)", symbol: { type: "simple-fill", color: [232, 55, 55, 0.6], outline: null }},
                      { minValue: -85, maxValue: -80, label: "≤85% Trump (R)", symbol: { type: "simple-fill", color: [235, 77, 77, 0.6], outline: null }},
                      { minValue: -80, maxValue: -75, label: "≤80% Trump (R)", symbol: { type: "simple-fill", color: [237, 100, 100, 0.6], outline: null }},
                      { minValue: -75, maxValue: -70, label: "≤75% Trump (R)", symbol: { type: "simple-fill", color: [240, 122, 122, 0.6], outline: null }},
                      { minValue: -70, maxValue: -65, label: "≤70% Trump (R)", symbol: { type: "simple-fill", color: [242, 144, 144, 0.6], outline: null }},
                      { minValue: -65, maxValue: -60, label: "≤65% Trump (R)", symbol: { type: "simple-fill", color: [245, 166, 166, 0.6], outline: null }},
                      { minValue: -60, maxValue: -55, label: "≤60% Trump (R)", symbol: { type: "simple-fill", color: [247, 188, 188, 0.6], outline: null }},
                      { minValue: -55, maxValue: -50, label: "≤55% Trump (R)", symbol: { type: "simple-fill", color: [250, 211, 211, 0.6], outline: null }},
                      { minValue: -50, maxValue: 0, label: "≤50% Trump (R)", symbol: { type: "simple-fill", color: [252, 233, 233, 0.6], outline: null }},
                      { minValue: -100002, maxValue: -100002, label: "Tie", symbol: { type: "simple-fill", color: [255, 255, 255, 0.6], outline: null }},
                      { minValue: 0, maxValue: 50, label: "≤50% Biden (D)", symbol: { type: "simple-fill", color: [222, 238, 250, 0.6], outline: null }},
                      { minValue: 50, maxValue: 55, label: "≤55% Biden (D)", symbol: { type: "simple-fill", color: [190, 220, 245, 0.6], outline: null }},
                      { minValue: 55, maxValue: 60, label: "≤60% Biden (D)", symbol: { type: "simple-fill", color: [157, 203, 241, 0.6], outline: null }},
                      { minValue: 60, maxValue: 65, label: "≤65% Biden (D)", symbol: { type: "simple-fill", color: [125, 185, 236, 0.6], outline: null }},
                      { minValue: 65, maxValue: 70, label: "≤70% Biden (D)", symbol: { type: "simple-fill", color: [92, 168, 231, 0.6], outline: null }},
                      { minValue: 70, maxValue: 75, label: "≤75% Biden (D)", symbol: { type: "simple-fill", color: [60, 150, 226, 0.6], outline: null }},
                      { minValue: 75, maxValue: 80, label: "≤80% Biden (D)", symbol: { type: "simple-fill", color: [32, 132, 217, 0.6], outline: null }},
                      { minValue: 80, maxValue: 85, label: "≤85% Biden (D)", symbol: { type: "simple-fill", color: [27, 112, 184, 0.6], outline: null }},
                      { minValue: 85, maxValue: 90, label: "≤90% Biden (D)", symbol: { type: "simple-fill", color: [22, 93, 152, 0.6], outline: null }},
                      { minValue: 90, maxValue: 95, label: "≤95% Biden (D)", symbol: { type: "simple-fill", color: [18, 73, 119, 0.6], outline: null }},
                      { minValue: 95, maxValue: 100, label: "≤100% Biden (D)", symbol: { type: "simple-fill", color: [13, 53, 87, 0.6], outline: null }},
                  ]
              });

              const countColRenderer2 = new ClassBreaksRenderer({
                valueExpression: `
                  var dem_votes = $feature.votes_dem;
                  var gop_votes = $feature.votes_gop;
                  var total_votes = $feature.total_vote;
                  var bidwon = $feature.pctbi;
				  var truwon = $feature.pcttr20;
				  if (total_votes == 0) {
					return 100002;  // For no votes
				  } else if (dem_votes == gop_votes) {
					return -100002;  // For exact ties
				  } else if (dem_votes > gop_votes) {
					return bidwon;  // Biden won
				  } else {
					return -(truwon);  // Trump won
				  }
                `,
                classBreakInfos: [
                     { minValue: 100002, maxValue: 100002, label: "No Votes", symbol: { type: "simple-fill", color: [215, 219, 221, 0.6], outline: null }},
                     { minValue: -100, maxValue: -95, label: "≤100% Trump (R)", symbol: { type: "simple-fill", color: [213, 25, 25, 0.6], outline: null }},
                     { minValue: -95, maxValue: -90, label: "≤95% Trump (R)", symbol: { type: "simple-fill", color: [229, 33, 33, 0.6], outline: null }},
                     { minValue: -90, maxValue: -85, label: "≤90% Trump (R)", symbol: { type: "simple-fill", color: [232, 55, 55, 0.6], outline: null }},
                     { minValue: -85, maxValue: -80, label: "≤85% Trump (R)", symbol: { type: "simple-fill", color: [235, 77, 77, 0.6], outline: null }},
                     { minValue: -80, maxValue: -75, label: "≤80% Trump (R)", symbol: { type: "simple-fill", color: [237, 100, 100, 0.6], outline: null }},
                     { minValue: -75, maxValue: -70, label: "≤75% Trump (R)", symbol: { type: "simple-fill", color: [240, 122, 122, 0.6], outline: null }},
                     { minValue: -70, maxValue: -65, label: "≤70% Trump (R)", symbol: { type: "simple-fill", color: [242, 144, 144, 0.6], outline: null }},
                     { minValue: -65, maxValue: -60, label: "≤65% Trump (R)", symbol: { type: "simple-fill", color: [245, 166, 166, 0.6], outline: null }},
                     { minValue: -60, maxValue: -55, label: "≤60% Trump (R)", symbol: { type: "simple-fill", color: [247, 188, 188, 0.6], outline: null }},
                     { minValue: -55, maxValue: -50, label: "≤55% Trump (R)", symbol: { type: "simple-fill", color: [250, 211, 211, 0.6], outline: null }},
                     { minValue: -50, maxValue: 0, label: "≤50% Trump (R)", symbol: { type: "simple-fill", color: [252, 233, 233, 0.6], outline: null }},
                     { minValue: -100002, maxValue: -100002, label: "Tie", symbol: { type: "simple-fill", color: [255, 255, 255, 0.6], outline: null }},
                     { minValue: 0, maxValue: 50, label: "≤50% Biden (D)", symbol: { type: "simple-fill", color: [222, 238, 250, 0.6], outline: null }},
                     { minValue: 50, maxValue: 55, label: "≤55% Biden (D)", symbol: { type: "simple-fill", color: [190, 220, 245, 0.6], outline: null }},
                      { minValue: 55, maxValue: 60, label: "≤60% Biden (D)", symbol: { type: "simple-fill", color: [157, 203, 241, 0.6], outline: null }},
                     { minValue: 60, maxValue: 65, label: "≤65% Biden (D)", symbol: { type: "simple-fill", color: [125, 185, 236, 0.6], outline: null }},
                     { minValue: 65, maxValue: 70, label: "≤70% Biden (D)", symbol: { type: "simple-fill", color: [92, 168, 231, 0.6], outline: null }},
                     { minValue: 70, maxValue: 75, label: "≤75% Biden (D)", symbol: { type: "simple-fill", color: [60, 150, 226, 0.6], outline: null }},
                     { minValue: 75, maxValue: 80, label: "≤80% Biden (D)", symbol: { type: "simple-fill", color: [32, 132, 217, 0.6], outline: null }},
                     { minValue: 80, maxValue: 85, label: "≤85% Biden (D)", symbol: { type: "simple-fill", color: [27, 112, 184, 0.6], outline: null }},
                     { minValue: 85, maxValue: 90, label: "≤90% Biden (D)", symbol: { type: "simple-fill", color: [22, 93, 152, 0.6], outline: null }},
                     { minValue: 90, maxValue: 95, label: "≤95% Biden (D)", symbol: { type: "simple-fill", color: [18, 73, 119, 0.6], outline: null }},
                     { minValue: 95, maxValue: 100, label: "≤100% Biden (D)", symbol: { type: "simple-fill", color: [13, 53, 87, 0.6], outline: null }},
                  ]
              });
              const precColRenderer2 = new ClassBreaksRenderer({
                valueExpression: `
                  var dem_votes = $feature.G20PREDBID;
                  var gop_votes = $feature.G20PRERTRU;
                  var total_votes = $feature.TotVote20;
                  var bidwon = $feature.PCTBID;
				  var truwon = $feature.PCTTRU20;
				  if (total_votes == 0) {
					return 100002;  // For no votes
				  } else if (dem_votes == gop_votes) {
					return -100002;  // For exact ties
				  } else if (dem_votes > gop_votes) {
					return bidwon;  // Biden won
				  } else {
					return -(truwon);  // Trump won
				  }
                `,
                classBreakInfos: [
                     { minValue: 100002, maxValue: 100002, label: "No Votes", symbol: { type: "simple-fill", color: [215, 219, 221, 0.35], outline: null }},
                      { minValue: -100, maxValue: -95, label: "≤100% Trump (R)", symbol: { type: "simple-fill", color: [213, 25, 25, 0.35], outline: null }},
                     { minValue: -95, maxValue: -90, label: "≤95% Trump (R)", symbol: { type: "simple-fill", color: [229, 33, 33, 0.35], outline: null }},
                     { minValue: -90, maxValue: -85, label: "≤90% Trump (R)", symbol: { type: "simple-fill", color: [232, 55, 55, 0.35], outline: null }},
                     { minValue: -85, maxValue: -80, label: "≤85% Trump (R)", symbol: { type: "simple-fill", color: [235, 77, 77, 0.35], outline: null }},
                     { minValue: -80, maxValue: -75, label: "≤80% Trump (R)", symbol: { type: "simple-fill", color: [237, 100, 100, 0.35], outline: null }},
                     { minValue: -75, maxValue: -70, label: "≤75% Trump (R)", symbol: { type: "simple-fill", color: [240, 122, 122, 0.35], outline: null }},
                     { minValue: -70, maxValue: -65, label: "≤70% Trump (R)", symbol: { type: "simple-fill", color: [242, 144, 144, 0.35], outline: null }},
                     { minValue: -65, maxValue: -60, label: "≤65% Trump (R)", symbol: { type: "simple-fill", color: [245, 166, 166, 0.35], outline: null }},
                     { minValue: -60, maxValue: -55, label: "≤60% Trump (R)", symbol: { type: "simple-fill", color: [247, 188, 188, 0.35], outline: null }},
                     { minValue: -55, maxValue: -50, label: "≤55% Trump (R)", symbol: { type: "simple-fill", color: [250, 211, 211, 0.35], outline: null }},
                     { minValue: -50, maxValue: 0, label: "≤50% Trump (R)", symbol: { type: "simple-fill", color: [252, 233, 233, 0.35], outline: null }},
                     { minValue: -100002, maxValue: -100002, label: "Tie", symbol: { type: "simple-fill", color: [255, 255, 255, 0.35], outline: null }},
                     { minValue: 0, maxValue: 50, label: "≤50% Biden (D)", symbol: { type: "simple-fill", color: [222, 238, 250, 0.35], outline: null }},
                     { minValue: 50, maxValue: 55, label: "≤55% Biden (D)", symbol: { type: "simple-fill", color: [190, 220, 245, 0.35], outline: null }},
                     { minValue: 55, maxValue: 60, label: "≤60% Biden (D)", symbol: { type: "simple-fill", color: [157, 203, 241, 0.35], outline: null }},
                     { minValue: 60, maxValue: 65, label: "≤65% Biden (D)", symbol: { type: "simple-fill", color: [125, 185, 236, 0.35], outline: null }},
                     { minValue: 65, maxValue: 70, label: "≤70% Biden (D)", symbol: { type: "simple-fill", color: [92, 168, 231, 0.35], outline: null }},
                     { minValue: 70, maxValue: 75, label: "≤75% Biden (D)", symbol: { type: "simple-fill", color: [60, 150, 226, 0.35], outline: null }},
                     { minValue: 75, maxValue: 80, label: "≤80% Biden (D)", symbol: { type: "simple-fill", color: [32, 132, 217, 0.35], outline: null }},
                     { minValue: 80, maxValue: 85, label: "≤85% Biden (D)", symbol: { type: "simple-fill", color: [27, 112, 184, 0.35], outline: null }},
                     { minValue: 85, maxValue: 90, label: "≤90% Biden (D)", symbol: { type: "simple-fill", color: [22, 93, 152, 0.35], outline: null }},
                     { minValue: 90, maxValue: 95, label: "≤95% Biden (D)", symbol: { type: "simple-fill", color: [18, 73, 119, 0.35], outline: null }},
                     { minValue: 95, maxValue: 100, label: "≤100% Biden (D)", symbol: { type: "simple-fill", color: [13, 53, 87, 0.35], outline: null }},
                  ]
              });

              const stateColRenderer = new ClassBreaksRenderer({
                  valueExpression: `
                    var dem_votes = $feature.Biden;
                    var gop_votes = $feature.Trump_20;
                    var total_votes = $feature.Tot_20;
                    var bidwon = $feature.pctbi;
					var truwon = $feature.pcttr20;
					if (total_votes == 0) {
					  return 100002;  // For no votes
					} else if (dem_votes == gop_votes) {
					  return -100002;  // For exact ties
					} else if (dem_votes > gop_votes) {
					  return bidwon;  // Biden won
					} else {
					  return -(truwon);  // Trump won
					}
                  `,
                  classBreakInfos: [
                      { minValue: 100002, maxValue: 100002, label: "No Votes", symbol: { type: "simple-fill", color: [215, 219, 221, 0.8], outline: null }},
                      { minValue: -100, maxValue: -95, label: "≤100% Trump (R)", symbol: { type: "simple-fill", color: [213, 25, 25, 0.8], outline: null }},
                      { minValue: -95, maxValue: -90, label: "≤95% Trump (R)", symbol: { type: "simple-fill", color: [229, 33, 33, 0.8], outline: null }},
                      { minValue: -90, maxValue: -85, label: "≤90% Trump (R)", symbol: { type: "simple-fill", color: [232, 55, 55, 0.8], outline: null }},
                      { minValue: -85, maxValue: -80, label: "≤85% Trump (R)", symbol: { type: "simple-fill", color: [235, 77, 77, 0.8], outline: null }},
                      { minValue: -80, maxValue: -75, label: "≤80% Trump (R)", symbol: { type: "simple-fill", color: [237, 100, 100, 0.8], outline: null }},
                      { minValue: -75, maxValue: -70, label: "≤75% Trump (R)", symbol: { type: "simple-fill", color: [240, 122, 122, 0.8], outline: null }},
                      { minValue: -70, maxValue: -65, label: "≤70% Trump (R)", symbol: { type: "simple-fill", color: [242, 144, 144, 0.8], outline: null }},
                      { minValue: -65, maxValue: -60, label: "≤65% Trump (R)", symbol: { type: "simple-fill", color: [245, 166, 166, 0.8], outline: null }},
                      { minValue: -60, maxValue: -55, label: "≤60% Trump (R)", symbol: { type: "simple-fill", color: [247, 188, 188, 0.8], outline: null }},
                      { minValue: -55, maxValue: -50, label: "≤55% Trump (R)", symbol: { type: "simple-fill", color: [250, 211, 211, 0.8], outline: null }},
                      { minValue: -50, maxValue: 0, label: "≤50% Trump (R)", symbol: { type: "simple-fill", color: [252, 233, 233, 0.8], outline: null }},
                      { minValue: -100002, maxValue: -100002, label: "Tie", symbol: { type: "simple-fill", color: [255, 255, 255, 0.8], outline: null }},
                      { minValue: 0, maxValue: 50, label: "≤50% Biden (D)", symbol: { type: "simple-fill", color: [222, 238, 250, 0.8], outline: null }},
                      { minValue: 50, maxValue: 55, label: "≤55% Biden (D)", symbol: { type: "simple-fill", color: [190, 220, 245, 0.8], outline: null }},
                      { minValue: 55, maxValue: 60, label: "≤60% Biden (D)", symbol: { type: "simple-fill", color: [157, 203, 241, 0.8], outline: null }},
                      { minValue: 60, maxValue: 65, label: "≤65% Biden (D)", symbol: { type: "simple-fill", color: [125, 185, 236, 0.8], outline: null }},
                      { minValue: 65, maxValue: 70, label: "≤70% Biden (D)", symbol: { type: "simple-fill", color: [92, 168, 231, 0.8], outline: null }},
                      { minValue: 70, maxValue: 75, label: "≤75% Biden (D)", symbol: { type: "simple-fill", color: [60, 150, 226, 0.8], outline: null }},
                      { minValue: 75, maxValue: 80, label: "≤80% Biden (D)", symbol: { type: "simple-fill", color: [32, 132, 217, 0.8], outline: null }},
                      { minValue: 80, maxValue: 85, label: "≤85% Biden (D)", symbol: { type: "simple-fill", color: [27, 112, 184, 0.8], outline: null }},
                      { minValue: 85, maxValue: 90, label: "≤90% Biden (D)", symbol: { type: "simple-fill", color: [22, 93, 152, 0.8], outline: null }},
                      { minValue: 90, maxValue: 95, label: "≤95% Biden (D)", symbol: { type: "simple-fill", color: [18, 73, 119, 0.8], outline: null }},
                      { minValue: 95, maxValue: 100, label: "≤100% Biden (D)", symbol: { type: "simple-fill", color: [13, 53, 87, 0.8], outline: null }},
                  ]
              });

              const countColRenderer = new ClassBreaksRenderer({
                valueExpression: `
                  var dem_votes = $feature.votes_dem;
                  var gop_votes = $feature.votes_gop;
                  var total_votes = $feature.total_vote;
                  var bidwon = $feature.pctbi;
				  var truwon = $feature.pcttr20;
				  if (total_votes == 0) {
					return 100002;  // For no votes
				  } else if (dem_votes == gop_votes) {
					return -100002;  // For exact ties
				  } else if (dem_votes > gop_votes) {
					return bidwon;  // Biden won
				  } else {
					return -(truwon);  // Trump won
				  }
                `,
                classBreakInfos: [
                     { minValue: 100002, maxValue: 100002, label: "No Votes", symbol: { type: "simple-fill", color: [215, 219, 221, 0.8], outline: null }},
                     { minValue: -100, maxValue: -95, label: "≤100% Trump (R)", symbol: { type: "simple-fill", color: [213, 25, 25, 0.8], outline: null }},
                     { minValue: -95, maxValue: -90, label: "≤95% Trump (R)", symbol: { type: "simple-fill", color: [229, 33, 33, 0.8], outline: null }},
                     { minValue: -90, maxValue: -85, label: "≤90% Trump (R)", symbol: { type: "simple-fill", color: [232, 55, 55, 0.8], outline: null }},
                     { minValue: -85, maxValue: -80, label: "≤85% Trump (R)", symbol: { type: "simple-fill", color: [235, 77, 77, 0.8], outline: null }},
                     { minValue: -80, maxValue: -75, label: "≤80% Trump (R)", symbol: { type: "simple-fill", color: [237, 100, 100, 0.8], outline: null }},
                     { minValue: -75, maxValue: -70, label: "≤75% Trump (R)", symbol: { type: "simple-fill", color: [240, 122, 122, 0.8], outline: null }},
                     { minValue: -70, maxValue: -65, label: "≤70% Trump (R)", symbol: { type: "simple-fill", color: [242, 144, 144, 0.8], outline: null }},
                     { minValue: -65, maxValue: -60, label: "≤65% Trump (R)", symbol: { type: "simple-fill", color: [245, 166, 166, 0.8], outline: null }},
                     { minValue: -60, maxValue: -55, label: "≤60% Trump (R)", symbol: { type: "simple-fill", color: [247, 188, 188, 0.8], outline: null }},
                     { minValue: -55, maxValue: -50, label: "≤55% Trump (R)", symbol: { type: "simple-fill", color: [250, 211, 211, 0.8], outline: null }},
                     { minValue: -50, maxValue: 0, label: "≤50% Trump (R)", symbol: { type: "simple-fill", color: [252, 233, 233, 0.8], outline: null }},
                     { minValue: -100002, maxValue: -100002, label: "Tie", symbol: { type: "simple-fill", color: [255, 255, 255, 0.8], outline: null }},
                     { minValue: 0, maxValue: 50, label: "≤50% Biden (D)", symbol: { type: "simple-fill", color: [222, 238, 250, 0.8], outline: null }},
                     { minValue: 50, maxValue: 55, label: "≤55% Biden (D)", symbol: { type: "simple-fill", color: [190, 220, 245, 0.8], outline: null }},
                     { minValue: 55, maxValue: 60, label: "≤60% Biden (D)", symbol: { type: "simple-fill", color: [157, 203, 241, 0.8], outline: null }},
                     { minValue: 60, maxValue: 65, label: "≤65% Biden (D)", symbol: { type: "simple-fill", color: [125, 185, 236, 0.8], outline: null }},
                     { minValue: 65, maxValue: 70, label: "≤70% Biden (D)", symbol: { type: "simple-fill", color: [92, 168, 231, 0.8], outline: null }},
                     { minValue: 70, maxValue: 75, label: "≤75% Biden (D)", symbol: { type: "simple-fill", color: [60, 150, 226, 0.8], outline: null }},
                     { minValue: 75, maxValue: 80, label: "≤80% Biden (D)", symbol: { type: "simple-fill", color: [32, 132, 217, 0.8], outline: null }},
                     { minValue: 80, maxValue: 85, label: "≤85% Biden (D)", symbol: { type: "simple-fill", color: [27, 112, 184, 0.8], outline: null }},
                     { minValue: 85, maxValue: 90, label: "≤90% Biden (D)", symbol: { type: "simple-fill", color: [22, 93, 152, 0.8], outline: null }},
                     { minValue: 90, maxValue: 95, label: "≤95% Biden (D)", symbol: { type: "simple-fill", color: [18, 73, 119, 0.8], outline: null }},
                     { minValue: 95, maxValue: 100, label: "≤100% Biden (D)", symbol: { type: "simple-fill", color: [13, 53, 87, 0.8], outline: null }},
                  ]
              });
              const precColRenderer = new ClassBreaksRenderer({
                valueExpression: `
                  var dem_votes = $feature.G20PREDBID;
                  var gop_votes = $feature.G20PRERTRU;
                  var total_votes = $feature.TotVote20;
                  var bidwon = $feature.PCTBID;
				  var truwon = $feature.PCTTRU20;
				  if (total_votes == 0) {
					return 100002;  // For no votes
				  } else if (dem_votes == gop_votes) {
					return -100002;  // For exact ties
				  } else if (dem_votes > gop_votes) {
					return bidwon;  // Biden won
				  } else {
					return -(truwon);  // Trump won
				  }
                `,
                classBreakInfos: [
                     { minValue: 100002, maxValue: 100002, label: "No Votes", symbol: { type: "simple-fill", color: [215, 219, 221, 0.8], outline: null }},
                     { minValue: -100, maxValue: -95, label: "≤100% Trump (R)", symbol: { type: "simple-fill", color: [213, 25, 25, 0.8], outline: null }},
                     { minValue: -95, maxValue: -90, label: "≤95% Trump (R)", symbol: { type: "simple-fill", color: [229, 33, 33, 0.8], outline: null }},
                     { minValue: -90, maxValue: -85, label: "≤90% Trump (R)", symbol: { type: "simple-fill", color: [232, 55, 55, 0.8], outline: null }},
                     { minValue: -85, maxValue: -80, label: "≤85% Trump (R)", symbol: { type: "simple-fill", color: [235, 77, 77, 0.8], outline: null }},
                     { minValue: -80, maxValue: -75, label: "≤80% Trump (R)", symbol: { type: "simple-fill", color: [237, 100, 100, 0.8], outline: null }},
                     { minValue: -75, maxValue: -70, label: "≤75% Trump (R)", symbol: { type: "simple-fill", color: [240, 122, 122, 0.8], outline: null }},
                     { minValue: -70, maxValue: -65, label: "≤70% Trump (R)", symbol: { type: "simple-fill", color: [242, 144, 144, 0.8], outline: null }},
                     { minValue: -65, maxValue: -60, label: "≤65% Trump (R)", symbol: { type: "simple-fill", color: [245, 166, 166, 0.8], outline: null }},
                     { minValue: -60, maxValue: -55, label: "≤60% Trump (R)", symbol: { type: "simple-fill", color: [247, 188, 188, 0.8], outline: null }},
                     { minValue: -55, maxValue: -50, label: "≤55% Trump (R)", symbol: { type: "simple-fill", color: [250, 211, 211, 0.8], outline: null }},
                     { minValue: -50, maxValue: 0, label: "≤50% Trump (R)", symbol: { type: "simple-fill", color: [252, 233, 233, 0.8], outline: null }},
                     { minValue: -100002, maxValue: -100002, label: "Tie", symbol: { type: "simple-fill", color: [255, 255, 255, 0.8], outline: null }},
                     { minValue: 0, maxValue: 50, label: "≤50% Biden (D)", symbol: { type: "simple-fill", color: [222, 238, 250, 0.8], outline: null }},
                     { minValue: 50, maxValue: 55, label: "≤55% Biden (D)", symbol: { type: "simple-fill", color: [190, 220, 245, 0.8], outline: null }},
                     { minValue: 55, maxValue: 60, label: "≤60% Biden (D)", symbol: { type: "simple-fill", color: [157, 203, 241, 0.8], outline: null }},
                     { minValue: 60, maxValue: 65, label: "≤65% Biden (D)", symbol: { type: "simple-fill", color: [125, 185, 236, 0.8], outline: null }},
                     { minValue: 65, maxValue: 70, label: "≤70% Biden (D)", symbol: { type: "simple-fill", color: [92, 168, 231, 0.8], outline: null }},
                     { minValue: 70, maxValue: 75, label: "≤75% Biden (D)", symbol: { type: "simple-fill", color: [60, 150, 226, 0.8], outline: null }},
                     { minValue: 75, maxValue: 80, label: "≤80% Biden (D)", symbol: { type: "simple-fill", color: [32, 132, 217, 0.8], outline: null }},
                     { minValue: 80, maxValue: 85, label: "≤85% Biden (D)", symbol: { type: "simple-fill", color: [27, 112, 184, 0.8], outline: null }},
                     { minValue: 85, maxValue: 90, label: "≤90% Biden (D)", symbol: { type: "simple-fill", color: [22, 93, 152, 0.8], outline: null }},
                     { minValue: 90, maxValue: 95, label: "≤95% Biden (D)", symbol: { type: "simple-fill", color: [18, 73, 119, 0.8], outline: null }},
                     { minValue: 95, maxValue: 100, label: "≤100% Biden (D)", symbol: { type: "simple-fill", color: [13, 53, 87, 0.8], outline: null }},
                  ]
              });

          stateLayer16.renderer = stateRenderer16;
	  countyLayer16.renderer = countRenderer16;
	  precinctLayer16.renderer = precRenderer16;
          bubbleStateLayer16.renderer = stateBubbleRenderer16;  
	  bubblePrecinctLayer16.renderer = precinctBubbleRenderer16;
	  bubbleCountyLayer16.renderer = countyBubbleRenderer16;
	  bubbleStateLayer162.renderer = stateBubbleRenderer16;
	  bubblePrecinctLayer162.renderer = precinctBubbleRenderer16;
	  bubbleCountyLayer162.renderer = countyBubbleRenderer16;
	  dotLayer16.renderer = dotDensityRenderer16;
	  dotLayer162.renderer = dotDensityRenderer16;
          stateColLayer16.renderer = stateColRenderer16;
	  countColLayer16.renderer = countColRenderer16;
	  precColLayer16.renderer = precColRenderer16;
	  stateColLayer162.renderer = stateColRenderer162;
	  countColLayer162.renderer = countColRenderer162;
	  precColLayer162.renderer = precColRenderer162;
	  stateColLayer163.renderer = stateColRenderer162;
	  countColLayer163.renderer = countColRenderer162;
	  precColLayer163.renderer = precColRenderer162;
	  stateLayer.renderer = stateRenderer;
	  countyLayer.renderer = countRenderer;
	  precinctLayer.renderer = precRenderer;
	  bubblePrecinctLayer.renderer = precinctBubbleRenderer;
	  bubbleCountyLayer.renderer = countyBubbleRenderer;         
	  bubbleStateLayer.renderer = stateBubbleRenderer;
	  bubblePrecinctLayer2.renderer = precinctBubbleRenderer;
	  bubbleCountyLayer2.renderer = countyBubbleRenderer;         
	  bubbleStateLayer2.renderer = stateBubbleRenderer;
	  dotLayer.renderer = dotDensityRenderer;
	  dotLayer2.renderer = dotDensityRenderer;
	  stateColLayer.renderer = stateColRenderer;
	  countColLayer.renderer = countColRenderer;
	  precColLayer.renderer = precColRenderer;
	  stateColLayer2.renderer = stateColRenderer2;
	  countColLayer2.renderer = countColRenderer2;
	  precColLayer2.renderer = precColRenderer2;
	  stateColLayer3.renderer = stateColRenderer2;
	  countColLayer3.renderer = countColRenderer2;
	  precColLayer3.renderer = precColRenderer2;
	  stateSwingLayer.renderer = stateSwingRenderer;
	  countySwingLayer.renderer = countSwingRenderer;
	  precinctSwingLayer.renderer = precSwingRenderer;
	  stateSwingPCT.renderer = stateSwingPCTRenderer;
	  countSwingPCT.renderer = countSwingPCTRenderer;
	  precSwingPCT.renderer = precSwingPCTRenderer;
	  stateSwing.renderer = stateSwingVoteRenderer;
	  countSwing.renderer = countSwingVoteRenderer;
	  precSwing.renderer = precSwingVoteRenderer;
        
          const debouncedEventHandler = promiseUtils.debounce(eventHandler);

          view.on("pointer-move", debouncedEventHandler);
          view.on("pointer-down", debouncedEventHandler);

          let highlight;
          const infoDiv = document.getElementById('infoDiv');  
	  
	  function eventHandler(event) {
            const screenPoint = {
              include: [stateLayer16, countyLayer16, precinctLayer16, stateLayer, countyLayer, precinctLayer, stateSwingLayer, countySwingLayer, precinctSwingLayer]
            };

            view.hitTest(event, screenPoint).then(function(response) {
              if (response.results.length > 0) {
                const graphic = response.results[0].graphic;

                let featureID;
                if (graphic.layer === precinctLayer) {
                  featureID = graphic.attributes.BGID;  // Use the BGID attribute for precincts
                } else if (graphic.layer === countyLayer) {
                  featureID = graphic.attributes.FID;  // Use the FID attribute for counties
                } else if (graphic.layer === stateLayer) {
                  featureID = graphic.attributes.SNID;  // Use the SNID attribute for states
                } else if (graphic.layer === precinctLayer16) {
                  featureID = graphic.attributes.BGID;  // Use the BGID attribute for precincts
                } else if (graphic.layer === countyLayer16) {
                  featureID = graphic.attributes.FID;  // Use the FID attribute for counties
                } else if (graphic.layer === stateLayer16) {
                  featureID = graphic.attributes.SNID;  // Use the SNID attribute for states
				} else if (graphic.layer === precinctSwingLayer) {
                  featureID = graphic.attributes.BGID;  // Use the BGID attribute for precincts
                } else if (graphic.layer === countySwingLayer) {
                  featureID = graphic.attributes.FID;  // Use the FID attribute for counties
                } else if (graphic.layer === stateSwingLayer) {
                  featureID = graphic.attributes.SNID;  // Use the SNID attribute for states
                } 

                if (graphic.layer === precinctLayer && featureID !== currentPrecinctID) {
				  currentPrecinctID = featureID;
      		    } else if (graphic.layer === countyLayer && featureID !== currentCountyID) {
        	      currentCountyID = featureID;
                } else if (graphic.layer === stateLayer && featureID !== currentStateID) {
        	      currentStateID = featureID;
	            } else if (graphic.layer === precinctLayer16 && featureID !== currentPrecinctID16) {
        	      currentPrecinctID16 = featureID;
      		    } else if (graphic.layer === countyLayer16 && featureID !== currentCountyID16) {
        	      currentCountyID16 = featureID;
                } else if (graphic.layer === stateLayer16 && featureID !== currentStateID16) {
        	      currentStateID16 = featureID;
			    } else if (graphic.layer === precinctSwingLayer && featureID !== currentPrecinctSwingID) {
        	      currentPrecinctSwingID = featureID;
      		    } else if (graphic.layer === countySwingLayer && featureID !== currentCountySwingID) {
        	      currentCountySwingID = featureID;
                } else if (graphic.layer === stateSwingLayer && featureID !== currentStateSwingID) {
        	      currentStateSwingID = featureID;
      		    } else {
                  // The feature under the mouse is the same as the last highlighted feature, so return
                  return;
                }

                  if (highlight) {
                    highlight.remove();
                    highlight = null;
                  }

                  let layerView;
						if (graphic.layer === precinctLayer) {
							layerView = PrecinctLayerView;
							currentPrecinctID = featureID;
							highlight = layerView.highlight(graphic);
							
							var demVotes = graphic.attributes.G20PREDBID;
							var trumpVotes = graphic.attributes.G20PRERTRU;
							var otherVotes = graphic.attributes.TotOth20;
							var totalVote = graphic.attributes.TotVote20;
							
							// Use precalculated fields
							winPerc = graphic.attributes.WIN_MARGIN_PERC_2020;
							winVote = graphic.attributes.WIN_MARGIN_VOTES_2020;
							var winCandidate = graphic.attributes.WINNER_2020;
							
							var winColor, demHighlight = "", trumpHighlight = "", otherHighlight = "";
							
							if (totalVote === 0) {
								demHighlight = "background-color: #e0ecf8;";
								trumpHighlight = "background-color: #f8e0e0;";
								otherHighlight = "background-color: #e6e6e6;";
							} else if (winCandidate === "Biden") {
								winColor = "blue";
								demHighlight = "background-color: #e0ecf8;";
							} else if (winCandidate === "Trump") {
								winColor = "red";
								trumpHighlight = "background-color: #f8e0e0;";
							} else if (winCandidate === "Other") {
								winColor = "dimgrey";
								otherHighlight = "background-color: #e6e6e6;";
							} else if (winCandidate.startsWith("Tie")) {
								if (winCandidate.includes("Biden")) demHighlight = "background-color: #e0ecf8;";
								if (winCandidate.includes("Trump")) trumpHighlight = "background-color: #f8e0e0;";
								if (winCandidate.includes("Other")) otherHighlight = "background-color: #e6e6e6;";
							}
							
							updateInfoDiv(
								"<b style='font-size: 1.1em; text-align: center; display: block;'>Block Group Results 2020</b>" +
								"<div style='color: black; font-weight: 500; text-align: center;" + demHighlight + "'>Biden: <b style='color: blue;'>" + graphic.attributes.PCTBID_S + "</b> (" + demVotes.toLocaleString() + " votes)</div>" +
								"<div style='color: black; font-weight: 500; text-align: center;" + trumpHighlight + "'>Trump: <b style='color: red;'>" + graphic.attributes.TRU20_S + "</b> (" + trumpVotes.toLocaleString() + " votes)</div>" +
								"<div style='color: black; font-weight: 500; text-align: center;" + otherHighlight + "'>Other: <b style='color: dimgrey;'>" + graphic.attributes.OTH20_S + "</b> (" + otherVotes.toLocaleString() + " votes)</div>" +
								"<div style='color: black; font-weight: 500; text-align: center;'>Winner: <b style='color: " + winColor + ";'>" + winCandidate + " +" + winPerc + "%</b> (+" + winVote.toLocaleString() + " votes)</div>"
							);
						
						} else if (graphic.layer === countyLayer) {
							layerView = CountyLayerView;
							currentCountyID = featureID;
							highlight = layerView.highlight(graphic);
							
							var demVotes = graphic.attributes.votes_dem;
							var trumpVotes = graphic.attributes.votes_gop;
							var otherVotes = graphic.attributes.Total_Othe;
							var totalVote = graphic.attributes.total_vote;
							
							// Use precalculated fields
							winPerc = graphic.attributes.WIN_MARGIN_PERC_2020;
							winVote = graphic.attributes.WIN_MARGIN_VOTES_2020;
							var winCandidate = graphic.attributes.WINNER_2020;
							
							var winColor, demHighlight = "", trumpHighlight = "", otherHighlight = "";
							
							if (totalVote === 0) {
								demHighlight = "background-color: #e0ecf8;";
								trumpHighlight = "background-color: #f8e0e0;";
								otherHighlight = "background-color: #e6e6e6;";
							} else if (winCandidate === "Biden") {
								winColor = "blue";
								demHighlight = "background-color: #e0ecf8;";
							} else if (winCandidate === "Trump") {
								winColor = "red";
								trumpHighlight = "background-color: #f8e0e0;";
							} else if (winCandidate === "Other") {
								winColor = "dimgrey";
								otherHighlight = "background-color: #e6e6e6;";
							} else if (winCandidate.startsWith("Tie")) {
								if (winCandidate.includes("Biden")) demHighlight = "background-color: #e0ecf8;";
								if (winCandidate.includes("Trump")) trumpHighlight = "background-color: #f8e0e0;";
								if (winCandidate.includes("Other")) otherHighlight = "background-color: #e6e6e6;";
							}
							
							updateInfoDiv(
							  "<b style='font-size: 1.1em; text-align: center; display: block;'>" + graphic.attributes.county_nam + ", " + graphic.attributes.state_name + " 2020</b>" +
							  "<div style='color: black; font-weight: 500; text-align: center;" + demHighlight + "'>Biden: <b style='color: blue;'>" + graphic.attributes.PCTBID + "</b> (" + demVotes.toLocaleString() + " votes)</div>" +
							  "<div style='color: black; font-weight: 500; text-align: center;" + trumpHighlight + "'>Trump: <b style='color: red;'>" + graphic.attributes.PCTTRU + "</b> (" + trumpVotes.toLocaleString() + " votes)</div>" +
							  "<div style='color: black; font-weight: 500; text-align: center;" + otherHighlight + "'>Other: <b style='color: dimgrey;'>" + graphic.attributes.PCTOTH + "</b> (" + otherVotes.toLocaleString() + " votes)</div>" +
							  "<div style='color: black; font-weight: 500; text-align: center;'>Winner: <b style='color: " + winColor + ";'>" + winCandidate + " +" + winPerc + "%</b> (+" + winVote.toLocaleString() + " votes)</div>"
							);
						
						} else if (graphic.layer === stateLayer) {
							layerView = StateLayerView;
							currentStateID = featureID;
							highlight = layerView.highlight(graphic);
								
							var demVotes = graphic.attributes.Biden;
							var trumpVotes = graphic.attributes.Trump_20;
							var otherVotes = graphic.attributes.Other_20;
							var totalVote = graphic.attributes.Tot_20;
								
							// Use precalculated fields
							winPerc = graphic.attributes.WIN_MARGIN_PERC_2020;
							winVote = graphic.attributes.WIN_MARGIN_VOTES_2020;
							var winCandidate = graphic.attributes.WINNER_2020;
								
							var winColor, demHighlight = "", trumpHighlight = "", otherHighlight = "";
							if (totalVote === 0) {
								demHighlight = "background-color: #e0ecf8;";
								trumpHighlight = "background-color: #f8e0e0;";
								otherHighlight = "background-color: #e6e6e6;";
							} else if (winCandidate === "Biden") {
								winColor = "blue";
								demHighlight = "background-color: #e0ecf8;";
							} else if (winCandidate === "Trump") {
								winColor = "red";
								trumpHighlight = "background-color: #f8e0e0;";
							} else if (winCandidate === "Other") {
								winColor = "dimgrey";
								otherHighlight = "background-color: #e6e6e6;";
							} else if (winCandidate.startsWith("Tie")) {
								if (winCandidate.includes("Biden")) demHighlight = "background-color: #e0ecf8;";
								if (winCandidate.includes("Trump")) trumpHighlight = "background-color: #f8e0e0;";
								if (winCandidate.includes("Other")) otherHighlight = "background-color: #e6e6e6;";
							}
                        
							updateInfoDiv(
							  "<b style='font-size: 1.1em; text-align: center; display: block;'>" + graphic.attributes.STATE_NAME + " 2020</b>" +
							  "<div style='color: black; font-weight: 500; text-align: center;" + demHighlight + "'>Biden: <b style='color: blue;'>" + graphic.attributes.PCT_BID_S + "</b> (" + demVotes.toLocaleString() + " votes)</div>" +
							  "<div style='color: black; font-weight: 500; text-align: center;" + trumpHighlight + "'>Trump: <b style='color: red;'>" + graphic.attributes.PCT_T_20_S + "</b> (" + trumpVotes.toLocaleString() + " votes)</div>" +
							  "<div style='color: black; font-weight: 500; text-align: center;" + otherHighlight + "'>Other: <b style='color: dimgrey;'>" + graphic.attributes.PCT_O_20_S + "</b> (" + otherVotes.toLocaleString() + " votes)</div>" +
							  "<div style='color: black; font-weight: 500; text-align: center;'>Winner: <b style='color: " + winColor + ";'>" + winCandidate + " +" + winPerc + "%</b> (+" + winVote.toLocaleString() + " votes)</div>"
							);
						
						} else if (graphic.layer === precinctLayer16) {
							layerView = PrecinctLayerView16;
							currentPrecinctID16 = featureID;
							highlight = layerView.highlight(graphic);
							
							var demVotes = graphic.attributes.G16PREDCLI;
							var trumpVotes = graphic.attributes.G16PRERTRU;
							var otherVotes = graphic.attributes.TotOth16;
							var totalVote = graphic.attributes.TotVote16;
							
							// Use precalculated fields
							winPerc = graphic.attributes.WIN_MARGIN_PERC_2016;
							winVote = graphic.attributes.WIN_MARGIN_VOTES_2016;
							var winCandidate = graphic.attributes.WINNER_2016;
							
							var winColor, demHighlight = "", trumpHighlight = "", otherHighlight = "";
							
							if (totalVote === 0) {
								winCandidate = "No Votes";
								demHighlight = "background-color: #e0ecf8;";
								trumpHighlight = "background-color: #f8e0e0;";
								otherHighlight = "background-color: #e6e6e6;";
							} else if (winCandidate === "Clinton") {
								winColor = "blue";
								demHighlight = "background-color: #e0ecf8;";
							} else if (winCandidate === "Trump") {
								winColor = "red";
								trumpHighlight = "background-color: #f8e0e0;";
							} else if (winCandidate === "Other") {
								winColor = "dimgrey";
								otherHighlight = "background-color: #e6e6e6;";
							} else if (winCandidate.startsWith("Tie")) {
								if (winCandidate.includes("Clinton")) demHighlight = "background-color: #e0ecf8;";
								if (winCandidate.includes("Trump")) trumpHighlight = "background-color: #f8e0e0;";
								if (winCandidate.includes("Other")) otherHighlight = "background-color: #e6e6e6;";
							}
							
							updateInfoDiv(
								"<b style='font-size: 1.1em; text-align: center; display: block;'>Block Group Results 2016</b>" +
								"<div style='color: black; font-weight: 500; text-align: center;" + demHighlight + "'>Clinton: <b style='color: blue;'>" + graphic.attributes.PCTCLI_S + "</b> (" + demVotes.toLocaleString() + " votes)</div>" +
								"<div style='color: black; font-weight: 500; text-align: center;" + trumpHighlight + "'>Trump: <b style='color: red;'>" + graphic.attributes.TRU16_S + "</b> (" + trumpVotes.toLocaleString() + " votes)</div>" +
								"<div style='color: black; font-weight: 500; text-align: center;" + otherHighlight + "'>Other: <b style='color: dimgrey;'>" + graphic.attributes.OTH16_S + "</b> (" + otherVotes.toLocaleString() + " votes)</div>" +
								"<div style='color: black; font-weight: 500; text-align: center;'>Winner: <b style='color: " + winColor + ";'>" + winCandidate + " +" + winPerc + "%</b> (+" + winVote.toLocaleString() + " votes)</div>"
							);
						
							// County Layer 2016
						} else if (graphic.layer === countyLayer16) {
							layerView = CountyLayerView16;
							currentCountyID16 = featureID;
							highlight = layerView.highlight(graphic);
							
							var demVotes = graphic.attributes.votes_dem_;
							var trumpVotes = graphic.attributes.votes_gop_;
							var otherVotes = graphic.attributes.Total_Ot_1;
							var totalVote = graphic.attributes.tot_vo_1;
							
							// Use precalculated fields
							winPerc = graphic.attributes.WIN_MARGIN_PERC_2016;
							winVote = graphic.attributes.WIN_MARGIN_VOTES_2016;
							var winCandidate = graphic.attributes.WINNER_2016;
							
							var winColor, demHighlight = "", trumpHighlight = "", otherHighlight = "";
							
							if (totalVote === 0) {
								winCandidate = "No Votes";
								demHighlight = "background-color: #e0ecf8;";
								trumpHighlight = "background-color: #f8e0e0;";
								otherHighlight = "background-color: #e6e6e6;";
							} else if (winCandidate === "Clinton") {
								winColor = "blue";
								demHighlight = "background-color: #e0ecf8;";
							} else if (winCandidate === "Trump") {
								winColor = "red";
								trumpHighlight = "background-color: #f8e0e0;";
							} else if (winCandidate === "Other") {
								winColor = "dimgrey";
								otherHighlight = "background-color: #e6e6e6;";
							} else if (winCandidate.startsWith("Tie")) {
								if (winCandidate.includes("Clinton")) demHighlight = "background-color: #e0ecf8;";
								if (winCandidate.includes("Trump")) trumpHighlight = "background-color: #f8e0e0;";
								if (winCandidate.includes("Other")) otherHighlight = "background-color: #e6e6e6;";
							}
							
							updateInfoDiv(
								"<b style='font-size: 1.1em; text-align: center; display: block;'>" + graphic.attributes.county_nam + ", " + graphic.attributes.state_name + " 2016</b>" +
								"<div style='color: black; font-weight: 500; text-align: center;" + demHighlight + "'>Clinton: <b style='color: blue;'>" + graphic.attributes.PCTCLI + "</b> (" + demVotes.toLocaleString() + " votes)</div>" +
								"<div style='color: black; font-weight: 500; text-align: center;" + trumpHighlight + "'>Trump: <b style='color: red;'>" + graphic.attributes.PCTTRU16 + "</b> (" + trumpVotes.toLocaleString() + " votes)</div>" +
								"<div style='color: black; font-weight: 500; text-align: center;" + otherHighlight + "'>Other: <b style='color: dimgrey;'>" + graphic.attributes.PCTOTH16 + "</b> (" + otherVotes.toLocaleString() + " votes)</div>" +
								"<div style='color: black; font-weight: 500; text-align: center;'>Winner: <b style='color: " + winColor + ";'>" + winCandidate + " +" + winPerc + "%</b> (+" + winVote.toLocaleString() + " votes)</div>"
							);
						
							// State Layer 2016
						} else if (graphic.layer === stateLayer16) {
							layerView = StateLayerView16;
							currentStateID16 = featureID;
							highlight = layerView.highlight(graphic);
							
							var demVotes = graphic.attributes.Clinton;
							var trumpVotes = graphic.attributes.Trump_16;
							var otherVotes = graphic.attributes.Other_16;
							var totalVote = graphic.attributes.Tot_16;
							
							// Use precalculated fields
							winPerc = graphic.attributes.WIN_MARGIN_PERC_2016;
							winVote = graphic.attributes.WIN_MARGIN_VOTES_2016;
							var winCandidate = graphic.attributes.WINNER_2016;
							
							var winColor, demHighlight = "", trumpHighlight = "", otherHighlight = "";
							
							if (totalVote === 0) {
								winCandidate = "No Votes";
								demHighlight = "background-color: #e0ecf8;";
								trumpHighlight = "background-color: #f8e0e0;";
								otherHighlight = "background-color: #e6e6e6;";
							} else if (winCandidate === "Clinton") {
								winColor = "blue";
								demHighlight = "background-color: #e0ecf8;";
							} else if (winCandidate === "Trump") {
								winColor = "red";
								trumpHighlight = "background-color: #f8e0e0;";
							} else if (winCandidate === "Other") {
								winColor = "dimgrey";
								otherHighlight = "background-color: #e6e6e6;";
							} else if (winCandidate.startsWith("Tie")) {
								if (winCandidate.includes("Clinton")) demHighlight = "background-color: #e0ecf8;";
								if (winCandidate.includes("Trump")) trumpHighlight = "background-color: #f8e0e0;";
								if (winCandidate.includes("Other")) otherHighlight = "background-color: #e6e6e6;";
							}
							
							updateInfoDiv(
								"<b style='font-size: 1.1em; text-align: center; display: block;'>" + graphic.attributes.STATE_NAME + " 2016</b>" +
								"<div style='color: black; font-weight: 500; text-align: center;" + demHighlight + "'>Clinton: <b style='color: blue;'>" + graphic.attributes.PCT_CLI_S + "</b> (" + demVotes.toLocaleString() + " votes)</div>" +
								"<div style='color: black; font-weight: 500; text-align: center;" + trumpHighlight + "'>Trump: <b style='color: red;'>" + graphic.attributes.PCT_T_16_S + "</b> (" + trumpVotes.toLocaleString() + " votes)</div>" +
								"<div style='color: black; font-weight: 500; text-align: center;" + otherHighlight + "'>Other: <b style='color: dimgrey;'>" + graphic.attributes.PCT_O_16_S + "</b> (" + otherVotes.toLocaleString() + " votes)</div>" +
								"<div style='color: black; font-weight: 500; text-align: center;'>Winner: <b style='color: " + winColor + ";'>" + winCandidate + " +" + winPerc + "%</b> (+" + winVote.toLocaleString() + " votes)</div>"
							);
						} else if (graphic.layer === precinctSwingLayer) {
								layerView = PrecinctSwingLayerView;
								currentPrecinctSwingID = featureID;
								highlight = layerView.highlight(graphic);
								var clintonVotes = graphic.attributes.G16PREDCLI;
								var bidenVotes = graphic.attributes.G20PREDBID;
								var trumpVotes16 = graphic.attributes.G16PRERTRU;
								var trumpVotes20 = graphic.attributes.G20PRERTRU;
								var totdif = graphic.attributes.TOTDIF;
								var shiftValue = graphic.attributes.PCTDIF;
								var shiftText, shiftColor, shiftBackgroundColor;
								if (shiftValue > 0) {
									shiftText = '+' + shiftValue.toFixed(1) + '% More Democratic';
									shiftColor = 'blue';
									shiftBackgroundColor = '#e0ecf8';
								} else if (shiftValue < 0) {
									shiftText = '+' + (-shiftValue.toFixed(1)) + '% More Republican';
									shiftColor = 'red';
									shiftBackgroundColor = '#f8e0e0';
								} else {
									shiftText = 'No % Change';
									shiftColor = 'dimgrey';
									shiftBackgroundColor = '#e6e6e6';
								}
								var totdifText, totdifColor;
								if (totdif > 0) {
									totdifText = totdif.toLocaleString() + " Net Democratic Votes";
									totdifColor = 'blue';
								} else if (totdif < 0) {
									totdifText = Math.abs(totdif).toLocaleString() + " Net Republican Votes";
									totdifColor = 'red';
								} else {
									totdifText = "No Net Vote Change";
									totdifColor = 'dimgrey';
								}
								var winner2016, winner2020;
								if (clintonVotes > trumpVotes16) {
								  winner2016 = 'clinton';
								} else {
								  winner2016 = 'trump16';
								}
								if (bidenVotes > trumpVotes20) {
								  winner2020 = 'biden';
								} else {
								  winner2020 = 'trump20';
								}
								var clintonBackground = winner2016 === 'clinton' ? '#e0ecf8' : 'transparent';
								var trump16Background = winner2016 === 'trump16' ? '#f8e0e0' : 'transparent';
								var bidenBackground = winner2020 === 'biden' ? '#e0ecf8' : 'transparent';
								var trump20Background = winner2020 === 'trump20' ? '#f8e0e0' : 'transparent';
								updateInfoDiv(
									"<div style='font-weight: bold; font-size: 1.1em; margin-bottom: 2px; text-align: center;'>Block Group Shift 2016-2020</div>" +
									"<table style='width: 100%;'>" +
									"    <thead>" +
									"        <tr>" +
									"            <th style='text-align: left; color: black; width: 45%;'>2016</th>" +
									"            <th style='text-align: center; color: black; width: 10%;'></th>" +
									"            <th style='text-align: left; color: black; width: 45%;'>2020</th>" +
									"        </tr>" +
									"    </thead>" +
									"    <tbody>" +
									"        <tr>" +
									"            <td style='font-weight: 500; background-color: " + clintonBackground + "; padding: 2px;'><span style='font-weight: bold; color: black;'>Clinton:</span> <span style='color: blue;'> " + graphic.attributes.PCTCLI_S + "</span> <span style='color: black;'>(" + clintonVotes.toLocaleString() + " votes)</span></td>" +
									"            <td rowspan='2' style='text-align: center; font-size: 2.4em; font-weight: bold; transform: scaleX(0.8) scaleY(1); vertical-align: middle;'>&rarr;</td>" +
									"            <td style='font-weight: 500; background-color: " + bidenBackground + "; padding: 2px;'><span style='font-weight: bold; color: black;'>Biden:</span> <span style='color: blue;'> " + graphic.attributes.PCTBID_S + "</span> <span style='color: black;'>(" + bidenVotes.toLocaleString() + " votes)</span></td>" +
									"        </tr>" +
									"        <tr>" +
									"            <td style='font-weight: 500; background-color: " + trump16Background + "; padding: 2px;'><span style='font-weight: bold; color: black;'>Trump:</span> <span style='color: red;'> " + graphic.attributes.TRU16_S + "</span> <span style='color: black;'>(" + trumpVotes16.toLocaleString() + " votes)</span></td>" +
									"            <td style='font-weight: 500; background-color: " + trump20Background + "; padding: 2px;'><span style='font-weight: bold; color: black;'>Trump:</span> <span style='color: red;'> " + graphic.attributes.TRU20_S + "</span> <span style='color: black;'>(" + trumpVotes20.toLocaleString() + " votes)</span></td>" +
									"        </tr>" +
									"    </tbody>" +
									"</table>" +
									"<div style='background-color: " + shiftBackgroundColor + "; padding: 2px; text-align: center;'>" +
									"    <span style='color: black; font-weight: bold;'>Shift: <span style='color: " + shiftColor + "; font-weight: bold;'>" + shiftText + " <span style='color: black; font-weight: bold;'>(<span style='color: " + totdifColor + "; font-weight: bold;'>" + totdifText + "<span style='color: black; font-weight: bold;'>)</span></span></span>" +
									"</div>");
						} else if (graphic.layer === countySwingLayer) {
								layerView = CountySwingLayerView;
								currentCountySwingID = featureID;
								highlight = layerView.highlight(graphic);
								var clintonVotes = graphic.attributes.votes_dem_;
								var bidenVotes = graphic.attributes.votes_dem;
								var trumpVotes16 = graphic.attributes.votes_gop_;
								var trumpVotes20 = graphic.attributes.votes_gop;
								var totdif = graphic.attributes.TOTDIF;
								var shiftValue = graphic.attributes.PCTDIF;
								var shiftText, shiftColor, shiftBackgroundColor;
								if (shiftValue > 0) {
									shiftText = '+' + shiftValue.toFixed(1) + '% More Democratic';
									shiftColor = 'blue';
									shiftBackgroundColor = '#e0ecf8';
								} else if (shiftValue < 0) {
									shiftText = '+' + (-shiftValue.toFixed(1)) + '% More Republican';
									shiftColor = 'red';
									shiftBackgroundColor = '#f8e0e0';
								} else {
									shiftText = 'No % Change';
									shiftColor = 'dimgrey';
									shiftBackgroundColor = '#e6e6e6';
								}
								var totdifText, totdifColor;
								if (totdif > 0) {
									totdifText = totdif.toLocaleString() + " Net Democratic Votes";
									totdifColor = 'blue';
								} else if (totdif < 0) {
									totdifText = Math.abs(totdif).toLocaleString() + " Net Republican Votes";
									totdifColor = 'red';
								} else {
									totdifText = "No Net Vote Change";
									totdifColor = 'dimgrey';
								}
								var winner2016, winner2020;
								if (clintonVotes > trumpVotes16) {
								  winner2016 = 'clinton';
								} else {
								  winner2016 = 'trump16';
								}
								if (bidenVotes > trumpVotes20) {
								  winner2020 = 'biden';
								} else {
								  winner2020 = 'trump20';
								}
								var clintonBackground = winner2016 === 'clinton' ? '#e0ecf8' : 'transparent';
								var trump16Background = winner2016 === 'trump16' ? '#f8e0e0' : 'transparent';
								var bidenBackground = winner2020 === 'biden' ? '#e0ecf8' : 'transparent';
								var trump20Background = winner2020 === 'trump20' ? '#f8e0e0' : 'transparent';
								updateInfoDiv(
									"<div style='font-weight: bold; font-size: 1.1em; margin-bottom: 2px; text-align: center;'>" + graphic.attributes.county_nam + ", " + graphic.attributes.state_name + " Shift 2016-2020</div>" +
									"<table style='width: 100%;'>" +
									"    <thead>" +
									"        <tr>" +
									"            <th style='text-align: left; color: black; width: 45%;'>2016</th>" +
									"            <th style='text-align: center; color: black; width: 10%;'></th>" +
									"            <th style='text-align: left; color: black; width: 45%;'>2020</th>" +
									"        </tr>" +
									"    </thead>" +
									"    <tbody>" +
									"        <tr>" +
									"            <td style='font-weight: 500; background-color: " + clintonBackground + "; padding: 2px;'><span style='font-weight: bold; color: black;'>Clinton:</span> <span style='color: blue;'> " + graphic.attributes.PCTCLI + "</span> <span style='color: black;'>(" + clintonVotes.toLocaleString() + " votes)</span></td>" +
									"            <td rowspan='2' style='text-align: center; font-size: 2.4em; font-weight: bold; transform: scaleX(0.8) scaleY(1); vertical-align: middle;'>&rarr;</td>" +
									"            <td style='font-weight: 500; background-color: " + bidenBackground + "; padding: 2px;'><span style='font-weight: bold; color: black;'>Biden:</span> <span style='color: blue;'> " + graphic.attributes.PCTBID + "</span> <span style='color: black;'>(" + bidenVotes.toLocaleString() + " votes)</span></td>" +
									"        </tr>" +
									"        <tr>" +
									"            <td style='font-weight: 500; background-color: " + trump16Background + "; padding: 2px;'><span style='font-weight: bold; color: black;'>Trump:</span> <span style='color: red;'> " + graphic.attributes.PCTTRU16 + "</span> <span style='color: black;'>(" + trumpVotes16.toLocaleString() + " votes)</span></td>" +
									"            <td style='font-weight: 500; background-color: " + trump20Background + "; padding: 2px;'><span style='font-weight: bold; color: black;'>Trump:</span> <span style='color: red;'> " + graphic.attributes.PCTTRU + "</span> <span style='color: black;'>(" + trumpVotes20.toLocaleString() + " votes)</span></td>" +
									"        </tr>" +
									"    </tbody>" +
									"</table>" +
									"<div style='background-color: " + shiftBackgroundColor + "; padding: 2px; text-align: center;'>" +
									"    <span style='color: black; font-weight: bold;'>Shift: <span style='color: " + shiftColor + "; font-weight: bold;'>" + shiftText + " <span style='color: black; font-weight: bold;'>(<span style='color: " + totdifColor + "; font-weight: bold;'>" + totdifText + "<span style='color: black; font-weight: bold;'>)</span></span></span>" +
									"</div>");
						} else if (graphic.layer === stateSwingLayer) {
								layerView = StateSwingLayerView;
								currentStateSwingID = featureID;
								highlight = layerView.highlight(graphic);
								var clintonVotes = graphic.attributes.Clinton;
								var bidenVotes = graphic.attributes.Biden;
								var trumpVotes16 = graphic.attributes.Trump_16;
								var trumpVotes20 = graphic.attributes.Trump_20;
								var totdif = graphic.attributes.TOTDIF;
								var shiftValue = graphic.attributes.PCTDIF;
								var shiftText, shiftColor, shiftBackgroundColor;
								if (shiftValue > 0) {
									shiftText = '+' + shiftValue.toFixed(1) + '% More Democratic';
									shiftColor = 'blue';
									shiftBackgroundColor = '#e0ecf8';
								} else if (shiftValue < 0) {
									shiftText = '+' + (-shiftValue.toFixed(1)) + '% More Republican';
									shiftColor = 'red';
									shiftBackgroundColor = '#f8e0e0';
								} else {
									shiftText = 'No % Change';
									shiftColor = 'dimgrey';
									shiftBackgroundColor = '#e6e6e6';
								}
								var totdifText, totdifColor;
								if (totdif > 0) {
									totdifText = totdif.toLocaleString() + " Net Democratic Votes";
									totdifColor = 'blue';
								} else if (totdif < 0) {
									totdifText = Math.abs(totdif).toLocaleString() + " Net Republican Votes";
									totdifColor = 'red';
								} else {
									totdifText = "No Net Vote Change";
									totdifColor = 'dimgrey';
								}
								var winner2016, winner2020;
								if (clintonVotes > trumpVotes16) {
								  winner2016 = 'clinton';
								} else {
								  winner2016 = 'trump16';
								}
								if (bidenVotes > trumpVotes20) {
								  winner2020 = 'biden';
								} else {
								  winner2020 = 'trump20';
								}
								var clintonBackground = winner2016 === 'clinton' ? '#e0ecf8' : 'transparent';
								var trump16Background = winner2016 === 'trump16' ? '#f8e0e0' : 'transparent';
								var bidenBackground = winner2020 === 'biden' ? '#e0ecf8' : 'transparent';
								var trump20Background = winner2020 === 'trump20' ? '#f8e0e0' : 'transparent';
								updateInfoDiv(
									"<div style='font-weight: bold; font-size: 1.1em; margin-bottom: 2px; text-align: center;'>" + graphic.attributes.STATE_NAME + " Shift 2016-2020</div>" +
									"<table style='width: 100%;'>" +
									"    <thead>" +
									"        <tr>" +
									"            <th style='text-align: left; color: black; width: 45%;'>2016</th>" +
									"            <th style='text-align: center; color: black; width: 10%;'></th>" +
									"            <th style='text-align: left; color: black; width: 45%;'>2020</th>" +
									"        </tr>" +
									"    </thead>" +
									"    <tbody>" +
									"        <tr>" +
									"            <td style='font-weight: 500; background-color: " + clintonBackground + "; padding: 2px;'><span style='font-weight: bold; color: black;'>Clinton:</span> <span style='color: blue;'> " + graphic.attributes.PCT_CLI_S + "</span> <span style='color: black;'>(" + clintonVotes.toLocaleString() + " votes)</span></td>" +
									"            <td rowspan='2' style='text-align: center; font-size: 2.4em; font-weight: bold; transform: scaleX(0.8) scaleY(1); vertical-align: middle;'>&rarr;</td>" +
									"            <td style='font-weight: 500; background-color: " + bidenBackground + "; padding: 2px;'><span style='font-weight: bold; color: black;'>Biden:</span> <span style='color: blue;'> " + graphic.attributes.PCT_BID_S + "</span> <span style='color: black;'>(" + bidenVotes.toLocaleString() + " votes)</span></td>" +
									"        </tr>" +
									"        <tr>" +
									"            <td style='font-weight: 500; background-color: " + trump16Background + "; padding: 2px;'><span style='font-weight: bold; color: black;'>Trump:</span> <span style='color: red;'> " + graphic.attributes.PCT_T_16_S + "</span> <span style='color: black;'>(" + trumpVotes16.toLocaleString() + " votes)</span></td>" +
									"            <td style='font-weight: 500; background-color: " + trump20Background + "; padding: 2px;'><span style='font-weight: bold; color: black;'>Trump:</span> <span style='color: red;'> " + graphic.attributes.PCT_T_20_S + "</span> <span style='color: black;'>(" + trumpVotes20.toLocaleString() + " votes)</span></td>" +
									"        </tr>" +
									"    </tbody>" +
									"</table>" +
									"<div style='background-color: " + shiftBackgroundColor + "; padding: 2px; text-align: center;'>" +
									"    <span style='color: black; font-weight: bold;'>Shift: <span style='color: " + shiftColor + "; font-weight: bold;'>" + shiftText + " <span style='color: black; font-weight: bold;'>(<span style='color: " + totdifColor + "; font-weight: bold;'>" + totdifText + "<span style='color: black; font-weight: bold;'>)</span></span></span>" +
									"</div>");
                        }

                      if (layerView) {
                        infoDiv.style.display = 'block';
                      }
                      } else {
                      if (highlight) {
                        highlight.remove();
                        highlight = null;
                      }
                      currentPrecinctID = null;
                      currentCountyID = null;
                      currentStateID = null;
                      currentPrecinctID16 = null;
                      currentCountyID16 = null;
                      currentStateID16 = null;
					  currentPrecinctSwingID = null;
                      currentCountySwingID = null;
                      currentStateSwingID = null;

                      infoDiv.style.display = 'none';

                    }
                });
				function updateInfoDiv(content) {
					infoDivContent.innerHTML = content;
					infoDiv.style.display = 'block';
				}

				document.getElementById('closeInfoDiv').addEventListener('click', function() {
					infoDiv.style.display = 'none';
				});
              }
            });

            function createDarkModeToggle() {
              function toggleDarkMode() {
                document.body.classList.toggle('dark-mode');
                document.getElementById('infoDiv').classList.toggle('infoDiv-dark-mode');
                const button = document.querySelector('.dark-mode-button');
                if (document.body.classList.contains('dark-mode')) {
                  button.setAttribute("icon-start", "brightness");
                  button.setAttribute("title", "Light Mode");
                } else {
                  button.setAttribute("icon-start", "moon");
                  button.setAttribute("title", "Dark Mode");
                }
              }
              const darkModeAction = new ActionButton({
                id: "dark-mode-toggle"
              });
              darkModeAction.visible = true;
              darkModeAction.execute = toggleDarkMode;
              // Create a button element to trigger the action
              const actionButton = document.createElement("calcite-button");
              actionButton.iconStart = "moon";
              actionButton.scale = "m";
              actionButton.label = "Dark/Light Mode Toggle";
              actionButton.title = "Dark Mode";
              actionButton.appearance = "solid";
              actionButton.kind = "brand";
              actionButton.classList.add("dark-mode-button");
              actionButton.addEventListener("click", function() {
                darkModeAction.execute();
              });
              view.when(() => {
                view.ui.add(
                [
                  actionButton,
                  new Expand({
                    view: view,
					mode: "floating",
					expandTooltip: "Location Search",
                    content: new Search({ view: view }),
                    group: "top-left",
                    expanded: false
                  }),
                  new Expand({
                    view: view,
					mode: "floating",
					expandTooltip: "Legend",
                    content: new Legend({ view: view }),
                    group: "top-left",
                    expanded: false
                  })
                ],
                "top-left"
                );
              });
            }
            // Call the function to create and add the dark mode toggle
            view.when(createDarkModeToggle);
        });
    </script>
</head>
<body>
  <div id="viewDiv"></div>
  <div id="infoDiv">
    <button id="closeInfoDiv" aria-label="Close" style="color:black;">&times;</button>
    <div id="infoDivContent"></div>
  </div>
</body>
</html>
